<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>尚庭公寓学习笔记 | 捞月亮の小北</title><meta name="author" content="捞月亮の小北"><meta name="copyright" content="捞月亮の小北"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 项目概述1.1 项目业务概述尚庭公寓是一个公寓租赁平台项目，包含移动端和后台管理系统，其中移动端面向广大用户，提供找房、看房预约、租约管理等功能，后台管理系统面向管理员，提供公寓（房源）管理、租赁管理、用户管理等功能。下面分别介绍两端的具体业务功能。  1.1.1 移动端移动端的线上体验地址为：http:&#x2F;&#x2F;139.198.127.41:8002，其主要业务功能如下图所示  各功能模块具">
<meta property="og:type" content="article">
<meta property="og:title" content="尚庭公寓学习笔记">
<meta property="og:url" content="https://lunanorth.github.io/posts/12915.html">
<meta property="og:site_name" content="捞月亮の小北">
<meta property="og:description" content="1. 项目概述1.1 项目业务概述尚庭公寓是一个公寓租赁平台项目，包含移动端和后台管理系统，其中移动端面向广大用户，提供找房、看房预约、租约管理等功能，后台管理系统面向管理员，提供公寓（房源）管理、租赁管理、用户管理等功能。下面分别介绍两端的具体业务功能。  1.1.1 移动端移动端的线上体验地址为：http:&#x2F;&#x2F;139.198.127.41:8002，其主要业务功能如下图所示  各功能模块具">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s21.ax1x.com/2024/12/02/pAIY7qg.jpg">
<meta property="article:published_time" content="2024-12-02T02:34:42.000Z">
<meta property="article:modified_time" content="2024-12-02T02:39:21.689Z">
<meta property="article:author" content="捞月亮の小北">
<meta property="article:tag" content="项目相关笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s21.ax1x.com/2024/12/02/pAIY7qg.jpg"><link rel="shortcut icon" href="/img/moon.png"><link rel="canonical" href="https://lunanorth.github.io/posts/12915.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '尚庭公寓学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-02 10:39:21'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/navigation.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw far fa-paper-plane"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/essay/"><i class="fa-fw fas fa-comments"></i><span> 碎碎念</span></a></div><div class="menus_item"><a class="site-page" href="/collect/"><i class="fa-fw fa fa-book"></i><span> 藏宝阁</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s21.ax1x.com/2024/12/02/pAIY7qg.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="捞月亮の小北"><img class="site-icon" src="/img/moon.png"/><span class="site-name">捞月亮の小北</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw far fa-paper-plane"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/essay/"><i class="fa-fw fas fa-comments"></i><span> 碎碎念</span></a></div><div class="menus_item"><a class="site-page" href="/collect/"><i class="fa-fw fa fa-book"></i><span> 藏宝阁</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">尚庭公寓学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-02T02:34:42.000Z" title="发表于 2024-12-02 10:34:42">2024-12-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-02T02:39:21.689Z" title="更新于 2024-12-02 10:39:21">2024-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%90%8E%E7%AB%AF/">Java后端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">56.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>245分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="尚庭公寓学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer">

<h1 id="1-项目概述"><a href="#1-项目概述" class="headerlink" title="1. 项目概述"></a>1. 项目概述</h1><h2 id="1-1-项目业务概述"><a href="#1-1-项目业务概述" class="headerlink" title="1.1 项目业务概述"></a>1.1 项目业务概述</h2><p>尚庭公寓是一个公寓租赁平台项目，包含<strong>移动端</strong>和<strong>后台管理系统</strong>，其中移动端面向广大用户，提供找房、看房预约、租约管理等功能，后台管理系统面向管理员，提供公寓（房源）管理、租赁管理、用户管理等功能。下面分别介绍两端的具体业务功能。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019713.png" alt=""></p>
<h3 id="1-1-1-移动端"><a href="#1-1-1-移动端" class="headerlink" title="1.1.1 移动端"></a>1.1.1 移动端</h3><p>移动端的线上体验地址为：<a href="http://139.198.127.41:8002，其主要业务功能如下图所示">http://139.198.127.41:8002，其主要业务功能如下图所示</a></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019714.svg" alt=""></p>
<p>各功能模块具体内容如下</p>
<ul>
<li><p><strong>房源检索</strong></p>
<p>用户可以使用这个功能来搜索和检索符合其需求的房源。他们可以根据不同的条件，如地理位置、租金范围、支付方式等，快速找到适合的房源。</p>
</li>
<li><p><strong>看房预约管理</strong></p>
<p>用户可以通过这个功能预约看房。他们可以选择合适的时间，预约在特定的公寓进行实地看房，以便更好地了解房源的情况和环境。</p>
</li>
<li><p><strong>租约管理</strong></p>
<p>这个功能允许用户查看和管理他们的租约信息。他们可以在移动端查看租约合同，以及提交租约终止或延长的请求。</p>
</li>
<li><p><strong>房源浏览历史</strong></p>
<p>用户可以在这里查看他们曾经浏览过的房源历史记录。这个功能可以帮助用户追踪之前感兴趣的房源，方便他们重新查看或做出决策。</p>
</li>
</ul>
<h3 id="1-1-2-后台管理系统"><a href="#1-1-2-后台管理系统" class="headerlink" title="1.1.2 后台管理系统"></a>1.1.2 后台管理系统</h3><p>后台管理系统的线上体验地址为：<a href="http://139.198.127.41:8001，主要业务功能如下图所示">http://139.198.127.41:8001，主要业务功能如下图所示</a></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019715.svg" alt=""></p>
<p>各功能模块具体内容如下</p>
<ul>
<li><p><strong>公寓信息管理</strong></p>
<p>这个模块负责管理所有公寓的基本信息，包括公寓名称、地址、联系方式等。管理员可以在这里添加、编辑、删除公寓信息。</p>
</li>
<li><p><strong>房间信息管理</strong></p>
<p>该模块负责管理每个公寓内各个房间的详细信息，包括房间号、户型、面积、租金等。管理员可以在这里进行房间信息的添加、编辑和删除。</p>
</li>
<li><p><strong>公寓/房间属性管理</strong></p>
<p>这个模块允许管理员定义公寓和房间的各种属性，比如公寓和房间的配套设施，方便管理员在维护公寓信息和房间信息时进行选择。</p>
</li>
<li><p><strong>看房预约管理</strong></p>
<p>该模块用于管理用户的看房预约请求。用户可以在移动端提交看房预约，管理员可以在后台管理系统中查看和处理这些请求，以方便安排人员接待用户。</p>
</li>
<li><p><strong>租约管理</strong></p>
<p>这个模块用于管理租约的创建、修改和终止。管理员可以在这里生成租约合同，并发送给用户签约。</p>
</li>
<li><p><strong>后台系统用户管理</strong></p>
<p>该模块用于管理后台系统的用户账户信息，管理员可以创建、编辑、删除、禁用账户信息。</p>
</li>
<li><p><strong>移动端用户管理</strong></p>
<p>这个模块负责管理移动端用户的信息。管理员可以查看用户信息，处理账户相关问题。</p>
</li>
</ul>
<h3 id="1-1-3-核心业务流程"><a href="#1-1-3-核心业务流程" class="headerlink" title="1.1.3 核心业务流程"></a>1.1.3 核心业务流程</h3><p>本项目的核心业务流程为签约、续约、退租，具体流程如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019716.svg" style="zoom:40%;" /></p>
<p>在上述的业务流程中，会涉及到租约状态的多次变化，下面详细介绍一下租约状态。租约共有7个状态，分别是<code>签约待确认</code>、<code>已签约</code>、<code>已取消</code>、<code>已到期</code>、<code>退租待确认</code>、<code>已退租</code>、<code>续约待确认</code>，以下是这些状态的变化流程。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019717.svg" alt="租约状态变化流程.drawio"></p>
<h2 id="1-2-项目技术概述"><a href="#1-2-项目技术概述" class="headerlink" title="1.2 项目技术概述"></a>1.2 项目技术概述</h2><p>本项目的技术架构如下图所示。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019718.svg" style="zoom:50%;" /></p>
<p>项目采用前后端分离的模式，下面介绍各模块用到的技术。</p>
<ul>
<li><p><strong>前端</strong></p>
<ul>
<li>框架：VUE3</li>
</ul>
</li>
<li><p><strong>后端</strong></p>
<ul>
<li><p>框架：Spring Boot</p>
</li>
<li><p>数据库访问：MyBatis、MyBatis Plus</p>
<blockquote>
<p>MyBatis-Plus（简称 MP）是一个MyBatis的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
</blockquote>
</li>
<li><p>Web：Spring MVC</p>
</li>
</ul>
</li>
<li><p><strong>数据存储</strong></p>
<ul>
<li><p>关系型数据库：MySQL</p>
</li>
<li><p>缓存：Redis</p>
</li>
<li><p>对象存储：MinIO</p>
<blockquote>
<p><strong>对象存储</strong>是用于存储非结构化数据的数据存储架构，它将一个数据单元称为一个对象，每个对象都包含数据本身、元数据（描述数据的信息）和一个唯一标识符（通常是一个URL地址）。</p>
<p>在2001年，亚马逊推出了Simple Storage Service（简称S3），这是第一个商业化的、面向互联网的对象存储服务。随后国内众多云服务厂商也都推出了自己的对象存储服务，例如阿里云的OSS，华为云的OBS，百度云的BOS等等。</p>
<p><strong>MinIO</strong>是一个开源的对象存储方案，兼容亚马逊S3协议。</p>
<p>对于对象存储，我们可以选择直接购买各大云厂商提供的服务，也可以选择使用开源的服务，自行安装和维护。本项目采用开源的对象存储Minio来存储图片信息。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>部署</strong></p>
<ul>
<li>前端服务器：Nginx</li>
</ul>
</li>
</ul>
<h1 id="2-项目开发流程"><a href="#2-项目开发流程" class="headerlink" title="2. 项目开发流程"></a>2. 项目开发流程</h1><p>前后端分离项目的完整开发流程如下</p>
<p><strong>第一步</strong></p>
<p>由产品经理负责分析市场、用户需求，并将其转化为详细的产品需求。然后创建初步的产品原型，以便更好地理解和传达产品的设计和功能。</p>
<blockquote>
<p>原型通常指的是产品、系统或概念的初步版本或样品，旨在展示设计概念、功能、外观或其他关键特征。</p>
</blockquote>
<p><strong>第二步</strong></p>
<p>由UI设计师基于产品需求和初步原型，设计用户界面的外观和交互，得到高保真的原型。高保真原型可能包含更具体的设计元素，如颜色、字体、布局等。</p>
<p><strong>第三步</strong></p>
<p>由架构师根据高保真原型，规划软件系统的整体结构和组件。他们会设计数据库架构和定义接口，输出API文档，以便开发团队进行后续工作。</p>
<blockquote>
<p>API文档是关于接口的详细说明文档，其会包含接口所提供的功能，所需参数、返回值、错误处理等细节。接口文档的目的是为开发人员、集成人员以及其他利益相关者提供清晰的指导，以便他们能够正确地使用和集成接口。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019719.png" alt=""></p>
</blockquote>
<p><strong>第四步</strong></p>
<p>前后端开发工程师根据API文档，分别开发前端和后端的业务逻辑和功能。前端工程师负责构建用户交互界面，而后端工程师负责数据处理逻辑和数据存储。</p>
<p><strong>第五步</strong></p>
<p>测试工程师进行各种测试，以确保软件的质量和稳定性。</p>
<p><strong>第六步</strong></p>
<p>运维工程师负责配置、部署和维护应用程序的生产环境，确保应用程序能够正常运行并具备良好的性能和可用性。</p>
<h1 id="3-项目原型"><a href="#3-项目原型" class="headerlink" title="3. 项目原型"></a>3. 项目原型</h1><p>目前市面上有很多功能强大的原型设计工具，常用的有<a target="_blank" rel="noopener" href="https://modao.cc/">墨刀</a>，<a target="_blank" rel="noopener" href="https://www.figma.com/">Figma</a>等，这些工具设计出的原型美观且具备交互逻辑。以下是本项目的原型（当做原型看吧\^_\^）。</p>
<p><strong>移动端</strong>地址：<a target="_blank" rel="noopener" href="https://modao.cc/proto/yaPxwdkwrvtlaepAbqZzO/sharing?view_mode=device&amp;screen=rbpTgNkz0plpyCNJi&amp;canvasId=rcTgNntk14ENgkLr #租赁平台APP-分享">点击访问</a></p>
<p><strong>后台管理系统</strong>地址：<a target="_blank" rel="noopener" href="https://modao.cc/proto/jyri5tlrvvh6dn3SWyLBQ/sharing?view_mode=device&amp;screen=rbpTgTi9axnREyQVW&amp;canvasId=rcTgTi9ay8uTGyt0 #租赁平台后台管理-分享">点击访问</a></p>
<h1 id="4-数据库设计"><a href="#4-数据库设计" class="headerlink" title="4. 数据库设计"></a>4. 数据库设计</h1><h2 id="4-1-数据库设计理论"><a href="#4-1-数据库设计理论" class="headerlink" title="4.1 数据库设计理论"></a>4.1 数据库设计理论</h2><h3 id="4-1-1-数据库模型"><a href="#4-1-1-数据库模型" class="headerlink" title="4.1.1 数据库模型"></a>4.1.1 数据库模型</h3><p>数据库设计中最常采用的模型为<strong>实体（Entity）关系（Relationship）模型</strong>，简称ER模型。其核心思想是将现实世界中的复杂数据表示为一组实体，并描述这些实体之间的关系。</p>
<ul>
<li><p><strong>实体</strong>通常对应现实世界中的一个<strong>对象</strong>，例如：学生、班级、教师、课程。</p>
</li>
<li><p>每个实体都包含一组<strong>属性</strong>，这些属性用于描述实体，例如学生实体包含姓名、年龄、性别等属性。</p>
</li>
<li><strong>关系</strong>用于描述各实体之间的联系，例如学生和班级之间存在从属关系。</li>
</ul>
<p>其中<strong>关系</strong>可分为<strong>一对一</strong>、<strong>一对多</strong>、<strong>多对多</strong>三种，例如学生和班级之间的关系为<strong>一对多</strong>、学生和课程之间的关系为<strong>多对多</strong>。</p>
<p>实体关系模型通常使用实体关系图（ER diagram）进行表示。下图是一个简易的选课系统的实体关系图，其中方框代表实体，方框之间的连线则代表实体间的关系，连线两端的不同符号用于表示一对一、一对多、多对多的关系。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019720.svg" alt="ER图示例.drawio" style="zoom:85%;" /></p>
<p>符号说明如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019721.svg" alt=""></td>
<td style="text-align:center">表示0个</td>
</tr>
<tr>
<td style="text-align:center"><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019722.svg" alt=""></td>
<td style="text-align:center">表示1个</td>
</tr>
<tr>
<td style="text-align:center"><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019723.svg" alt=""></td>
<td style="text-align:center">表示多个</td>
</tr>
</tbody>
</table>
</div>
<p>上述符号通常是两个<strong>成对</strong>使用，其分别表示<strong>最小值</strong>和<strong>最大值</strong>。例如上述ER图中的<strong>班级</strong>和<strong>学生</strong>之间的连线，<strong>班级</strong>一侧的符号表示<strong>一</strong>（最小值和最大值都是一），<strong>学生</strong>一侧的符号表示<strong>多</strong>（最小值是一，最大值是多），其表达的含义就是班级和学生之间的关系为<strong>一对多</strong>，一个学生只对应一个班级，而一个班级会对应多个学生（且至少对应一个学生）。</p>
<h3 id="4-1-2-数据库设计流程"><a href="#4-1-2-数据库设计流程" class="headerlink" title="4.1.2 数据库设计流程"></a>4.1.2 数据库设计流程</h3><p>传统的数据库设计流程分为三个阶段，分别是概念模型设计阶段、逻辑模型设计阶段和物理模型设计阶段。三个阶段由粗略到详细，由抽象到具体。</p>
<h4 id="4-1-2-1-概念模型设计"><a href="#4-1-2-1-概念模型设计" class="headerlink" title="4.1.2.1 概念模型设计"></a>4.1.2.1 概念模型设计</h4><p>概念模型是一个粗略的初步设计，其只关注实体和关系，不体现最终建表所需的各种细节信息（例如实体的属性）。下图便是一个典型的简易<strong>选课系统</strong>数据库的概念模型。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019720.svg" style="zoom:85%;" /></p>
<h4 id="4-1-2-2-逻辑模型设计"><a href="#4-1-2-2-逻辑模型设计" class="headerlink" title="4.1.2.2 逻辑模型设计"></a>4.1.2.2 逻辑模型设计</h4><p>相较于概念模型，逻辑模型会包含更多的细节信息，例如实体的属性、用于关联两个实体的字段等等。需要注意的是，逻辑模型并不关注具体的数据库实现（例如MySQL或者Oracle）。下图是上述选课系统数据库的逻辑模型。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019725.svg" style="zoom: 50%;" /></p>
<h4 id="4-1-2-3-物理模型设计"><a href="#4-1-2-3-物理模型设计" class="headerlink" title="4.1.2.3 物理模型设计"></a>4.1.2.3 物理模型设计</h4><p>相较于逻辑模型，物理模型会包含更多的与所选数据库相关的具体信息，例如存储引擎、字段类型、索引等信息。一般而言，物理模型会包含最终建表所需的所有信息，下图是上述选课系统数据库的物理模型。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019726.svg" style="zoom:50%;" /></p>
<h2 id="4-2-数据库设计实操"><a href="#4-2-数据库设计实操" class="headerlink" title="4.2 数据库设计实操"></a>4.2 数据库设计实操</h2><h3 id="4-2-1-概念模型设计"><a href="#4-2-1-概念模型设计" class="headerlink" title="4.2.1 概念模型设计"></a>4.2.1 概念模型设计</h3><p>根据原型可得，本项目包含的实体有<strong>公寓</strong>、<strong>房间</strong>、<strong>用户(租客)</strong>、<strong>租约(合同)</strong>、<strong>看房预约</strong>、<strong>浏览历史</strong>和<strong>后台管理系统用户</strong>，各实体间的关系如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019727.svg" style="zoom:50%;" /></p>
<h3 id="4-2-2-逻辑模型设计"><a href="#4-2-2-逻辑模型设计" class="headerlink" title="4.2.2 逻辑模型设计"></a>4.2.2 逻辑模型设计</h3><p>根据原型明确各实体所需属性并明确各表关联字段，得到的完整的逻辑模型如下图所示。下面逐一分析。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019728.svg" alt=""></p>
<h4 id="4-2-2-1-公寓信息"><a href="#4-2-2-1-公寓信息" class="headerlink" title="4.2.2.1 公寓信息"></a>4.2.2.1 公寓信息</h4><p>公寓信息包含的属性有<code>公寓名称</code>、<code>公寓简介</code>、<code>公寓地址</code>、<code>公寓联系方式</code>、<code>公寓图片</code>、<code>公寓标签</code>、<code>公寓杂费</code>、<code>公寓发布状态</code>，这部分的逻辑模型如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019729.svg" style="zoom: 33%;" /></p>
<h4 id="4-2-2-2-房间信息"><a href="#4-2-2-2-房间信息" class="headerlink" title="4.2.2.2 房间信息"></a>4.2.2.2 房间信息</h4><p>房间信息包含的属性有<code>房间号</code>、<code>房间租金</code>、<code>房间所属公寓</code>、<code>房间可选租期</code>、<code>房间可选支付方式</code>、<code>房间属性</code>、<code>房间标签</code>、<code>房间配套</code>、<code>房间图片</code>、<code>房间发布状态</code>，这部分的逻辑模型如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019730.svg" style="zoom:33%;" /></p>
<h4 id="4-2-2-3-用户信息"><a href="#4-2-2-3-用户信息" class="headerlink" title="4.2.2.3 用户信息"></a>4.2.2.3 用户信息</h4><p>用户信息包含的属性有<code>手机号码</code>、<code>密码</code>、<code>头像</code>、<code>昵称</code>、<code>账号状态</code>，这部分的逻辑模型如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019731.svg" alt="项目模型-逻辑模型-用户信息.drawio" style="zoom:33%;" /></p>
<h4 id="4-2-2-4-看房预约信息"><a href="#4-2-2-4-看房预约信息" class="headerlink" title="4.2.2.4 看房预约信息"></a>4.2.2.4 看房预约信息</h4><p>看房预约包含的属性有<code>预约用户信息</code>、<code>预约公寓信息</code>、<code>预约时间</code>、<code>备注信息</code>、<code>预约状态</code>，这部分的逻辑模型如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019732.svg" style="zoom:33%;" /></p>
<h4 id="4-2-2-5-租约信息"><a href="#4-2-2-5-租约信息" class="headerlink" title="4.2.2.5 租约信息"></a>4.2.2.5 租约信息</h4><p>租约信息包含<code>签约用户信息</code>，<code>签约房间信息</code>、<code>租期</code>、<code>支付方式</code>、<code>租约来源</code>、<code>租金</code>、<code>押金</code>，这部分的逻辑模型如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019733.svg" style="zoom:33%;" /></p>
<h4 id="4-2-2-6-浏览历史信息"><a href="#4-2-2-6-浏览历史信息" class="headerlink" title="4.2.2.6 浏览历史信息"></a>4.2.2.6 浏览历史信息</h4><p>浏览历史指的是用户浏览房间详情的历史，包含的属性有<code>用户信息</code>、<code>房间信息</code>、<code>浏览时间</code>，这部分的逻辑模型如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019734.svg" alt="项目模型-逻辑模型-浏览历史.drawio" style="zoom:33%;" /></p>
<h4 id="4-2-2-7-后台管理用户信息"><a href="#4-2-2-7-后台管理用户信息" class="headerlink" title="4.2.2.7 后台管理用户信息"></a>4.2.2.7 后台管理用户信息</h4><p>后台管理系统用户包含的属性有，这部分的逻辑模型如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019735.svg" style="zoom:33%;" /></p>
<h3 id="4-2-3-物理模型设计"><a href="#4-2-3-物理模型设计" class="headerlink" title="4.2.3 物理模型设计"></a>4.2.3 物理模型设计</h3><p>本项目采用MySQL数据库，所有表均使用InnoDB存储引擎，完整的物理模型如下图，详细信息可参考资料中的数据库初始化文件<code>lease.sql</code>。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019736.svg" alt=""></p>
<p><strong>注意</strong>：</p>
<ul>
<li>所有表均省略了<code>create_time</code>、<code>update_time</code>、<code>is_deleted</code>三个字段。</li>
<li>所有的状态或类型字段（例如租约状态），均使用数字表示。</li>
</ul>
<h1 id="5-接口定义"><a href="#5-接口定义" class="headerlink" title="5. 接口定义"></a>5. 接口定义</h1><h2 id="5-1-后台管理系统接口定义"><a href="#5-1-后台管理系统接口定义" class="headerlink" title="5.1 后台管理系统接口定义"></a>5.1 后台管理系统接口定义</h2><h3 id="5-1-1-公寓信息管理"><a href="#5-1-1-公寓信息管理" class="headerlink" title="5.1.1 公寓信息管理"></a>5.1.1 公寓信息管理</h3><h4 id="5-1-1-1-属性管理"><a href="#5-1-1-1-属性管理" class="headerlink" title="5.1.1.1 属性管理"></a>5.1.1.1 属性管理</h4><p>属性管理页面包含公寓和房间各种可选的属性信息，其中包括<strong>房间的可选支付方式</strong>、<strong>房间的可选租期</strong>、<strong>房间的配套</strong>、<strong>公寓的配套</strong>等等。其所需接口如下</p>
<ul>
<li><p><strong>房间支付方式管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019737.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>查询全部支付方式列表</code></li>
<li><code>保存或更新支付方式</code></li>
<li><code>根据ID删除支付方式</code></li>
</ul>
</li>
<li><p><strong>房间租期管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019738.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>查询全部租期列表</code></li>
<li><code>保存或更新租期</code></li>
<li><code>根据ID删除租期</code></li>
</ul>
</li>
<li><p><strong>标签管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019739.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>保存或更新标签</code></li>
<li><code>查询标签列表</code></li>
<li><code>根据ID删除标签</code></li>
</ul>
</li>
<li><p><strong>配套管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019740.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>保存或更新配套</code></li>
<li><code>查询配套列表</code></li>
<li><code>根据ID删除配套</code></li>
</ul>
</li>
<li><p><strong>房间基本属性管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019741.png" alt="接口定义-后台-属性管理-房间基本属性"></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>保存或更新属性名称</code></li>
<li><code>保存或更新属性值</code></li>
<li><code>查询全部属性名称和属性值列表</code></li>
<li><p><code>根据ID删除属性名称</code></p>
</li>
<li><p><code>根据ID删除属性值</code></p>
</li>
</ul>
</li>
<li><p><strong>公寓杂费管理</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019742.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>保存或更新杂费名称</code></li>
<li><code>保存或更新杂费值</code></li>
<li><code>查询全部杂费名称和杂费值列表</code></li>
<li><p><code>根据ID删除杂费名称</code></p>
</li>
<li><p><code>根据ID删除杂费值</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="5-1-1-2-公寓管理"><a href="#5-1-1-2-公寓管理" class="headerlink" title="5.1.1.2 公寓管理"></a>5.1.1.2 公寓管理</h4><ul>
<li><p><strong>公寓列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019743.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><p><code>根据条件分页查询公寓列表</code></p>
</li>
<li><p>查询条件所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
</ul>
</li>
<li><code>根据ID修改公寓发布状态</code></li>
<li><code>根据ID删除公寓信息</code></li>
</ul>
</li>
<li><p><strong>公寓详情页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019744.png" style="zoom: 33%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据ID查询公寓详细信息</code>（用作修改时的表单回显）</li>
<li><code>保存或更新公寓信息</code></li>
<li><p>表单所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>查询公寓配套列表</code></li>
<li><code>查询公寓标签列表</code></li>
<li><code>查询公寓杂费信息列表</code></li>
<li><code>上传图片</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-1-1-3-房间管理"><a href="#5-1-1-3-房间管理" class="headerlink" title="5.1.1.3 房间管理"></a>5.1.1.3 房间管理</h4><ul>
<li><p><strong>房间列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019745.png" alt="接口定义-后台-公寓管理-房间列表"></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><p><code>根据条件分页查询房间列表</code></p>
</li>
<li><p>查询条件所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>根据区县ID查询公寓列表</code></li>
</ul>
</li>
<li><code>根据ID修改房间发布状态</code></li>
<li><code>根据ID删除房间信息</code></li>
</ul>
</li>
<li><p><strong>房间详情页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019746.png" style="zoom:33%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据ID查询房间详细信息</code>（用作修改时的表单回显）</li>
<li><code>保存或更新房间信息</code></li>
<li>表单所需接口<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>根据区县ID查询公寓列表</code></li>
<li><code>查询房间属性列表</code></li>
<li><code>查询房间标签列表</code></li>
<li><code>查询全部支付方式列表</code></li>
<li><code>查询租期列表</code></li>
<li><code>上传图片</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-1-2-租赁管理"><a href="#5-1-2-租赁管理" class="headerlink" title="5.1.2 租赁管理"></a>5.1.2 租赁管理</h3><h4 id="5-1-2-1-预约看房管理"><a href="#5-1-2-1-预约看房管理" class="headerlink" title="5.1.2.1 预约看房管理"></a>5.1.2.1 预约看房管理</h4><ul>
<li><p><strong>看房预约列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019747.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><p><code>分页查询预约信息列表</code></p>
</li>
<li><p>查询条件所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>根据区县ID查询公寓列表</code></li>
</ul>
</li>
<li><code>根据ID更新预约状态</code></li>
</ul>
</li>
</ul>
<h4 id="5-1-2-2-租约管理"><a href="#5-1-2-2-租约管理" class="headerlink" title="5.1.2.2 租约管理"></a>5.1.2.2 租约管理</h4><ul>
<li><p><strong>租约列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019748.png" alt="接口定义-后台-看房预约管理-预约列表"></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据条件分页查询租约信息列表</code></li>
<li><p>查询条件所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>根据区县ID查询公寓列表</code></li>
</ul>
</li>
<li><code>根据ID更新租约状态</code></li>
<li><code>根据ID删除租约信息</code></li>
</ul>
</li>
<li><p><strong>租约详情页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019749.png" style="zoom:33%;" /></p>
<p><strong>所需接口</strong></p>
<ul>
<li><code>根据ID查询租约信息</code>（用作更新租约时的表单回显）</li>
<li><code>保存或修改租约信息</code></li>
<li><p>表单所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市列表</code></li>
<li><code>根据城市ID查询区县列表</code></li>
<li><code>根据区县ID查询公寓列表</code></li>
<li><code>根据公寓ID查询房间列表</code></li>
<li><code>查询可选支付方式列表</code></li>
<li><code>查询可选租期列表</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-1-3-用户管理"><a href="#5-1-3-用户管理" class="headerlink" title="5.1.3 用户管理"></a>5.1.3 用户管理</h3><h4 id="5-1-3-1-用户列表页面"><a href="#5-1-3-1-用户列表页面" class="headerlink" title="5.1.3.1 用户列表页面"></a>5.1.3.1 用户列表页面</h4><p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019750.png" style="zoom: 50%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>分页查询用户信息列表</code></li>
<li><code>根据用户ID更新账号状态</code></li>
</ul>
<h3 id="5-1-4-系统管理"><a href="#5-1-4-系统管理" class="headerlink" title="5.1.4 系统管理"></a>5.1.4 系统管理</h3><h4 id="5-1-4-1-系统用户岗位管理"><a href="#5-1-4-1-系统用户岗位管理" class="headerlink" title="5.1.4.1 系统用户岗位管理"></a>5.1.4.1 系统用户岗位管理</h4><ul>
<li><p><strong>岗位列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019751.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>分页查询岗位信息列表</code></li>
<li><code>根据ID修改岗位状态</code></li>
<li><code>根据ID删除岗位</code></li>
</ul>
</li>
<li><p><strong>岗位详情页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019752.png" style="zoom: 50%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据ID查询岗位详细信息</code>（用作修改时的表单回显）</li>
<li><code>保存或更新岗位信息</code></li>
</ul>
</li>
</ul>
<h4 id="5-1-4-2-系统用户信息管理"><a href="#5-1-4-2-系统用户信息管理" class="headerlink" title="5.1.4.2 系统用户信息管理"></a>5.1.4.2 系统用户信息管理</h4><ul>
<li><p><strong>系统用户列表页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019753.png" alt=""></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据条件分页查询系统用户列表</code></li>
<li><code>根据ID修改用户状态</code></li>
<li><code>根据ID删除系统用户信息</code></li>
</ul>
<p><strong>所需接口如下</strong></p>
</li>
<li><p><strong>系统用户详情页面</strong></p>
<p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019754.png" style="zoom: 50%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>根据ID查询系统用户详细信息</code></li>
<li><code>保存或更新系统用户信息</code></li>
<li><code>表单所需接口</code><ul>
<li>查询岗位列表</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-1-5-登录管理"><a href="#5-1-5-登录管理" class="headerlink" title="5.1.5 登录管理"></a>5.1.5 登录管理</h3><h4 id="5-1-5-1-登录页面"><a href="#5-1-5-1-登录页面" class="headerlink" title="5.1.5.1 登录页面"></a>5.1.5.1 登录页面</h4><p><strong>页面如下</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019755.png" style="zoom:40%;" /></p>
<p><strong>所需接口如下</strong></p>
<ul>
<li><code>获取图形验证码</code></li>
<li><code>请求登录</code></li>
<li><code>获取登录用户信息</code></li>
</ul>
<h2 id="5-2-移动端接口定义"><a href="#5-2-移动端接口定义" class="headerlink" title="5.2 移动端接口定义"></a>5.2 移动端接口定义</h2><h3 id="5-2-1-登录"><a href="#5-2-1-登录" class="headerlink" title="5.2.1 登录"></a>5.2.1 登录</h3><h4 id="5-2-1-1-登录页面"><a href="#5-2-1-1-登录页面" class="headerlink" title="5.2.1.1 登录页面"></a>5.2.1.1 登录页面</h4><p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019756.png" style="zoom: 50%; border: 1px solid rgb(0, 0, 0);" /></p>
<p>所需接口如下</p>
<ul>
<li><code>获取短信验证码</code></li>
<li><code>请求登录</code></li>
<li><code>获取登录用户基本信息</code></li>
</ul>
<h3 id="5-2-2-找房"><a href="#5-2-2-找房" class="headerlink" title="5.2.2 找房"></a>5.2.2 找房</h3><h4 id="5-2-2-1-房间列表页面"><a href="#5-2-2-1-房间列表页面" class="headerlink" title="5.2.2.1 房间列表页面"></a>5.2.2.1 房间列表页面</h4><p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019757.png" style="zoom:50%;border: 1px solid #000;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>根据查询条件分页查询房间列表</code></li>
<li><p>查询条件所需接口</p>
<ul>
<li><code>查询省份列表</code></li>
<li><code>根据省份ID查询城市信息</code></li>
<li><code>根据城市ID查询区县信息</code></li>
<li><code>查询支付方式列表</code></li>
</ul>
</li>
</ul>
<h4 id="5-2-2-2-房间详情页面"><a href="#5-2-2-2-房间详情页面" class="headerlink" title="5.2.2.2 房间详情页面"></a>5.2.2.2 房间详情页面</h4><p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019758.png" style="zoom:50%;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>根据ID查询房间详细信息</code></li>
</ul>
<h4 id="5-2-2-3-公寓详情页面"><a href="#5-2-2-3-公寓详情页面" class="headerlink" title="5.2.2.3 公寓详情页面"></a>5.2.2.3 公寓详情页面</h4><p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019759.png" style="zoom:50%;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>根据ID查询公寓详细信息</code></li>
<li><code>根据公寓ID查询房间列表</code></li>
</ul>
<h3 id="5-2-3-个人中心"><a href="#5-2-3-个人中心" class="headerlink" title="5.2.3 个人中心"></a>5.2.3 个人中心</h3><h4 id="5-2-3-1-浏览历史"><a href="#5-2-3-1-浏览历史" class="headerlink" title="5.2.3.1 浏览历史"></a>5.2.3.1 浏览历史</h4><p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019760.png" style="zoom:50%; border: 1px solid #000;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>查询登录用户的浏览历史列表</code></li>
</ul>
<h4 id="5-2-3-2-看房预约"><a href="#5-2-3-2-看房预约" class="headerlink" title="5.2.3.2 看房预约"></a>5.2.3.2 看房预约</h4><ul>
<li><p><strong>看房预约列表页面</strong></p>
<p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019761.png" style="zoom:50%;border: 1px solid #000;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>查询登录用户的看房预约列表</code></li>
</ul>
</li>
<li><p><strong>看房预约详情页面</strong></p>
<p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019762.png" style="zoom:50%;" /></p>
<p>所需接口如下</p>
<ul>
<li><code>根据ID查询看房预约详细信息</code></li>
<li><code>保存或更新看房间预约信息</code></li>
</ul>
</li>
</ul>
<h4 id="5-2-3-3-租约管理"><a href="#5-2-3-3-租约管理" class="headerlink" title="5.2.3.3 租约管理"></a>5.2.3.3 租约管理</h4><ul>
<li><p><strong>租约列表页面</strong></p>
<p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019763.png" style="zoom:50%;border: 1px solid #000" /></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019764.png" style="zoom:50%;border: 1px solid #000" /></p>
<p>所需接口如下</p>
<ul>
<li><code>查询登录用户的租约列表</code></li>
<li><code>根据ID修改租约状态</code></li>
</ul>
</li>
<li><p><strong>租约详情页面</strong></p>
<p>页面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019765.png" style="zoom:50%; " /></p>
<p>所需接口如下</p>
<ul>
<li><code>根据ID查询租约详细信息</code></li>
<li><code>保存或修改租约信息</code></li>
<li>表单所需接口<ul>
<li><code>根据房间ID查询可选支付方式列表</code></li>
<li><code>根据房间ID查询可选租期列表</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-2-4-我的房间"><a href="#5-2-4-我的房间" class="headerlink" title="5.2.4 我的房间"></a>5.2.4 我的房间</h3><p>略</p>
<h3 id="5-2-5-圈子"><a href="#5-2-5-圈子" class="headerlink" title="5.2.5 圈子"></a>5.2.5 圈子</h3><p>略</p>
<h3 id="5-2-6-消息通知"><a href="#5-2-6-消息通知" class="headerlink" title="5.2.6 消息通知"></a>5.2.6 消息通知</h3><p>略</p>
<h1 id="6-开发准备"><a href="#6-开发准备" class="headerlink" title="6. 开发准备"></a>6. 开发准备</h1><h2 id="6-1-准备开发环境"><a href="#6-1-准备开发环境" class="headerlink" title="6.1 准备开发环境"></a>6.1 准备开发环境</h2><p>项目开发会用到<strong>MySQL</strong>、<strong>Redis</strong>、<strong>MinIO</strong>，本章主要内容就是部署三者，部署环境为Linux虚拟机。</p>
<h3 id="6-1-1-准备Linux虚拟机"><a href="#6-1-1-准备Linux虚拟机" class="headerlink" title="6.1.1 准备Linux虚拟机"></a>6.1.1 准备Linux虚拟机</h3><h4 id="6-1-1-1-Linux快速入门"><a href="#6-1-1-1-Linux快速入门" class="headerlink" title="6.1.1.1 Linux快速入门"></a>6.1.1.1 Linux快速入门</h4><p>Linux入门相关内容可参考<a href="./尚硅谷Linux基础.md">尚硅谷Linux基础</a>。</p>
<h4 id="6-1-1-2-开发环境要求"><a href="#6-1-1-2-开发环境要求" class="headerlink" title="6.1.1.2 开发环境要求"></a>6.1.1.2 开发环境要求</h4><p>准备<strong>两台</strong>Linux虚拟机——<code>server01</code>和<code>server02</code>，具体要求如下</p>
<p><strong>提示</strong></p>
<p>开发阶段只需要一台虚拟机即可，另外一台留到后序的项目部署阶段使用。实际操作时，可先按要求准备一台，然后直接克隆得到第二台服务器。</p>
<ul>
<li><p><strong>操作系统为Centos7</strong></p>
<blockquote>
<p>由于下文的安装步骤都是基于Centos7系统的，所以建议统一使用Centos7系统。</p>
</blockquote>
</li>
<li><p><strong>网络设置</strong></p>
<blockquote>
<p>虚拟机网络使用NAT模式，且使用静态IP。</p>
</blockquote>
</li>
<li><p><strong>主机名设置</strong></p>
<p>为两台主机分别设置一个主机名，分别是<code>server01</code>和<code>server02</code>，设置主机名的命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname &lt;主机名&gt; --static</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置好SSH远程登录</strong></p>
<blockquote>
<p>ssh客户端不限，可使用Xshell、MobaXterm、finalshell等等</p>
</blockquote>
</li>
<li><p><strong>与网络时间保持同步</strong></p>
<p>安装时间同步工具<code>chrony</code>。</p>
<ul>
<li><p>执行以下命令安装<code>chrony</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install chrony</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行以下命令启动<code>chrony</code>，并设置为开机自启。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong></p>
<ul>
<li><p><strong>查看时间源</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>
<p>该命令显示结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">210 Number of sources = 4</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^? ntp8.flashdance.cx            2   6     3     0    +44ms[  +44ms] +/-   93ms</span><br><span class="line">^? electrode.felixc.at           2   6     5     0    +32ms[  +32ms] +/-  135ms</span><br><span class="line">^* 81.16.177.123                 2   6     7     1   +457us[+28800s] +/-  149ms</span><br><span class="line">^- dns2.synet.edu.cn             1   6     7     2    +55ms[+28800s] +/-   28ms</span><br></pre></td></tr></table></figure>
<ul>
<li>MS：当前事件源的状态</li>
<li>Name/IP：时间服务器地址</li>
</ul>
</li>
<li><p><strong>配置新的时间源</strong></p>
<p>可修改<code>vim /etc/chrony.conf</code>以增加新的时间源</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>关闭防火墙</strong></p>
<p>关闭命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭防火墙 </span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止防火墙开机自启</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>关闭SElinux</strong></p>
<p>SELinux，全称为Security-Enhanced Linux，是一种用于Linux操作系统的安全增强功能，为保证后序部署阶段的Nginx能够正常工作，此处关闭SELinux功能。</p>
<ul>
<li><p><strong>修改SELinux配置文件</strong></p>
<p>打开配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure>
<p>修改内容如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重启操作系统</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="6-1-2-部署MySQL"><a href="#6-1-2-部署MySQL" class="headerlink" title="6.1.2 部署MySQL"></a>6.1.2 部署MySQL</h3><p>在<code>server01</code>部署MySQL，具体步骤可<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/mysql-installation-excerpt/8.0/en/linux-installation-yum-repo.html">参考文档</a>。</p>
<ol>
<li><p><strong>安装MySQL yum库</strong></p>
<ul>
<li><p><strong>下载yum库</strong></p>
<p>下载地址为<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/。需要根据操作系统选择相应版本，Centos7需选择`mysql80-community-release-el7-9.noarch.rpm`。">https://dev.mysql.com/downloads/repo/yum/。需要根据操作系统选择相应版本，Centos7需选择`mysql80-community-release-el7-9.noarch.rpm`。</a></p>
<p>执行以下命令可直接下载到服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-9.noarch.rpm</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>安装yum库</strong></p>
<p>在上述<code>rpm</code>文件所在路径执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh mysql80-community-release-el7-9.noarch.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置国内镜像</strong></p>
<p>修改<code>/etc/yum.repo.d/mysql-community.repo</code>文件中的<code>[mysql80-community]</code>中的<code>baseUrl</code>参数，修改内容如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql80-community]</span></span><br><span class="line"><span class="attr">name</span>=MySQL <span class="number">8.0</span> Community Server</span><br><span class="line"><span class="attr">baseurl</span>=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-<span class="number">8.0</span>-community-el7-<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-<span class="number">2022</span></span><br><span class="line">       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol>
<li><p><strong>安装MySQL</strong></p>
<p>执行如下命令安装MySQL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-community-server</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动MySQL</strong></p>
<p>执行如下命令启动MySQL服务</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>
<p>  执行以下命令查看MySQL运行状态</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p><strong>root用户相关配置</strong></p>
<ul>
<li><p><strong>查看root用户初始密码</strong></p>
<p>MySQL启动后会将root用户的初始密码写入日志，通过以下命令可以获取密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log | grep password</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>使用初始密码登录</strong></p>
<p>执行以下命令登录MySQL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p<span class="string">&#x27;password&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>修改root用户密码</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Atguigu.123&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>注意</strong>：MySQL默认安装了<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/validate-password.html">validate_password</a> 插件，默认情况下，要求密码要包含大写字母、小写字母、数字和特殊符号，且密码长度最小为8。若需设置简单密码，可禁用该插件，或调整该插件的密码强度级别。</p>
</li>
<li><p><strong>授予root用户远程登录权限</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Atguigu.123&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="6-1-3-部署Redis"><a href="#6-1-3-部署Redis" class="headerlink" title="6.1.3 部署Redis"></a>6.1.3 部署Redis</h3><p>在<code>server01</code>部署Redis服务，安装方式采用yum在线安装，安装版本为<code>redis-7.0.13</code>，具体步骤如下</p>
<ol>
<li><p><strong>安装Redis yum仓库</strong></p>
<ul>
<li><p><strong>下载yum仓库</strong></p>
<p>Redis所在的仓库为<strong>remi-release</strong>，下载地址为：<a target="_blank" rel="noopener" href="http://rpms.famillecollet.com/enterprise/remi-release-7.rpm，可使用如下命令直接下载到服务器">http://rpms.famillecollet.com/enterprise/remi-release-7.rpm，可使用如下命令直接下载到服务器</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>安装yum仓库</strong></p>
<p>执行如下命令进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh remi-release-7.rpm</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>安装Reids</strong></p>
<p>执行以下命令安装Redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=remi -y install redis-7.0.13</span><br></pre></td></tr></table></figure>
<p>注：<code>--enablerepo</code>选项的作用为启用一个仓库</p>
</li>
<li><p><strong>配置Redis允许远程访问</strong></p>
<p>Redis服务默认只允许本地访问，若需要进行远程访问，需要做出以下配置。</p>
<p>修改Redis配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
<p>修改如下参数</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#监听所有网络接口，默认只监听localhost</span></span><br><span class="line">bind 0.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭保护模式，默认开启。开始保护模式后，远程访问必须进行认证后才能访问。</span></span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动Redis</strong></p>
<p>执行以下命令启动Redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start redis</span><br></pre></td></tr></table></figure>
<p>执行以下命令查看Redis的运行状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure>
<p>执行以下命令设置Redis开机自启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> redis</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="6-1-4-部署MinIO"><a href="#6-1-4-部署MinIO" class="headerlink" title="6.1.4 部署MinIO"></a>6.1.4 部署MinIO</h3><p>在<code>server01</code>部署MinIO，安装方式采用rpm离线安装，具体步骤可参考<a target="_blank" rel="noopener" href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#minio-snsd">官方文档</a>。</p>
<ol>
<li><p><strong>获取MinIO安装包</strong></p>
<p>下载地址如下：<a target="_blank" rel="noopener" href="https://dl.min.io/server/minio/release/linux-amd64/archive/minio-20230809233022.0.0.x86_64.rpm，通过以下命令可直接将安装包下载至服务器">https://dl.min.io/server/minio/release/linux-amd64/archive/minio-20230809233022.0.0.x86_64.rpm，通过以下命令可直接将安装包下载至服务器</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/server/minio/release/linux-amd64/archive/minio-20230809233022.0.0.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>注：若下载缓慢，大家可直接使用课程资料中附带的安装包</p>
</li>
<li><p><strong>安装MinIO</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh minio-20230809233022.0.0.x86_64.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>集成Systemd</strong></p>
<ul>
<li><p><strong>Systemd概述</strong></p>
<p><code>Systemd</code>是一个广泛应用于Linux系统的系统初始化和服务管理器，其可以管理系统中的各种服务和进程，包括启动、停止和重启服务，除此之外，其还可以监测各服务的运行状态，并在服务异常退出时，自动拉起服务，以保证服务的稳定性。系统自带的防火墙服务<code>firewalld</code>，我们自己安装的<code>mysqld</code>和<code>redis</code>均是由<code>Systemd</code>进行管理的，此处将MinIO服务也交给Systemd管理。</p>
</li>
<li><p><strong>编写MinIO服务配置文件</strong></p>
<p>Systemd所管理的服务需要由一个配置文件进行描述，这些配置文件均位于<code>/etc/systemd/system/</code>或者<code>/usr/lib/systemd/system/</code>目录下，下面创建MinIO服务的配置文件。</p>
<p>执行以下命令创建并打开<code>minio.service</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/minio.service</span><br></pre></td></tr></table></figure>
<p>内容如下，具体可参考MinIO<a target="_blank" rel="noopener" href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#create-the-systemd-service-file">官方文档</a>。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=MinIO</span><br><span class="line"><span class="attr">Documentation</span>=https://min.io/docs/minio/linux/index.html</span><br><span class="line"><span class="attr">Wants</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">After</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">AssertFileIsExecutable</span>=/usr/local/bin/minio</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">WorkingDirectory</span>=/usr/local</span><br><span class="line"><span class="attr">ProtectProc</span>=invisible</span><br><span class="line"><span class="attr">EnvironmentFile</span>=-/etc/default/minio</span><br><span class="line"><span class="attr">ExecStartPre</span>=/bin/bash -c <span class="string">&quot;if [ -z \&quot;$&#123;MINIO_VOLUMES&#125;\&quot; ]; then echo \&quot;Variable MINIO_VOLUMES not set in /etc/default/minio\&quot;; exit 1; fi&quot;</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/minio server <span class="variable">$MINIO_OPTS</span> <span class="variable">$MINIO_VOLUMES</span></span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">65536</span></span><br><span class="line"><span class="attr">TasksMax</span>=infinity</span><br><span class="line"><span class="attr">TimeoutStopSec</span>=infinity</span><br><span class="line"><span class="attr">SendSIGKILL</span>=<span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>重点关注上述文件中的以下内容即可</p>
<ul>
<li><code>EnvironmentFile</code>，该文件中可配置MinIO服务所需的各项参数</li>
<li><code>ExecStart</code>，该参数用于配置MinIO服务的启动命令，其中<code>$MINIO_OPTS</code>、<code>$MINIO_VOLUMES</code>，均引用于<code>EnvironmentFile</code>中的变量。<ul>
<li><code>MINIO_OPTS</code>用于配置MinIO服务的启动选项，可省略不配置。</li>
<li><code>MINIO_VOLUMES</code>用于配置MinIO服务的数据存储路径。</li>
</ul>
</li>
<li><code>Restart</code>，表示自动重启</li>
</ul>
</li>
<li><p><strong>编写<code>EnvironmentFile</code>文件</strong></p>
<p>执行以下命令创建并打开<code>/etc/default/minio</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/minio</span><br></pre></td></tr></table></figure>
<p>内容如下，具体可参考<a target="_blank" rel="noopener" href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#create-the-environment-variable-file">官方文档</a>。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MINIO_ROOT_USER</span>=minioadmin</span><br><span class="line"><span class="attr">MINIO_ROOT_PASSWORD</span>=minioadmin</span><br><span class="line"><span class="attr">MINIO_VOLUMES</span>=/data</span><br><span class="line"><span class="attr">MINIO_OPTS</span>=<span class="string">&quot;--console-address :9001&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ul>
<li><p><code>MINIO_ROOT_USER</code>和<code>MINIO_ROOT_PASSWORD</code>为用于访问MinIO的用户名和密码，<strong>密码长度至少8位</strong>。</p>
</li>
<li><p><code>MINIO_VOLUMES</code>用于指定数据存储路径，需确保指定的路径是存在的，可执行以下命令创建该路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>MINIO_OPTS</code>中的<code>console-address</code>,用于指定管理页面的地址。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>启动MinIO</strong></p>
<p>执行以下命令启动MinIO</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start minio</span><br></pre></td></tr></table></figure>
<p>执行以下命令查询运行状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status minio</span><br></pre></td></tr></table></figure>
<p>设置MinIO开机自启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> minio</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问MinIO管理页面</strong></p>
<p>管理页面的访问地址为：<code>http://192.168.10.101:9001</code></p>
<p><strong>注意</strong>：</p>
<p><code>ip</code>需要根据实际情况做出修改</p>
</li>
</ol>
<h2 id="6-2-技术储备"><a href="#6-2-技术储备" class="headerlink" title="6.2 技术储备"></a>6.2 技术储备</h2><h3 id="6-2-1-MyBatis-Plus快速入门"><a href="#6-2-1-MyBatis-Plus快速入门" class="headerlink" title="6.2.1 MyBatis Plus快速入门"></a>6.2.1 MyBatis Plus快速入门</h3><h4 id="6-2-2-1-概述"><a href="#6-2-2-1-概述" class="headerlink" title="6.2.2.1 概述"></a>6.2.2.1 概述</h4><p>MyBatis-Plus（简称 MP）是一个MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。其突出的特性如下：</p>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，提供了大量的通用的CRUD方法，因此可以省去大量手写sql的语句的工作。</li>
<li><strong>条件构造器</strong>：提供了强大的条件构造器，可以构造各种复杂的查询条件，以应对各种复杂查询。</li>
<li><strong>内置分页插件</strong>：配置好插件之后，写分页等同于普通 List 查询，无需关注分页逻辑。</li>
</ul>
<p>下面通过一个简单案例快速熟悉MyBatis Plus的基本使用</p>
<h4 id="6-2-2-2-数据库准备"><a href="#6-2-2-2-数据库准备" class="headerlink" title="6.2.2.2 数据库准备"></a>6.2.2.2 数据库准备</h4><p>首先在数据库中准备一张表，为后序的学习做准备。</p>
<ol>
<li><p><strong>创建数据库</strong></p>
<p>在MySQL中创建一个数据库<code>hello_mp</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE hello_mp <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建表</strong></p>
<p>在<code>hello-mp</code>库中创建一个表<code>user</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>插入数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user (<span class="built_in">id</span>, name, age, email) VALUES</span><br><span class="line">(1, <span class="string">&#x27;Jone&#x27;</span>, 18, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(2, <span class="string">&#x27;Jack&#x27;</span>, 20, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(3, <span class="string">&#x27;Tom&#x27;</span>, 28, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(4, <span class="string">&#x27;Sandy&#x27;</span>, 21, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(5, <span class="string">&#x27;Billie&#x27;</span>, 24, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="6-2-2-3-与SpringBoot集成"><a href="#6-2-2-3-与SpringBoot集成" class="headerlink" title="6.2.2.3 与SpringBoot集成"></a>6.2.2.3 与SpringBoot集成</h4><p>Mybatis Plus与SpringBoot的集成十分简单，具体操作如下</p>
<ol>
<li><p><strong>引入Maven 依赖</strong></p>
<p>提前创建好一个SpringBoot项目，然后在项目中引入MyBatis Plus依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>本案例完整的<code>pom.xml</code>文件如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-mp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello-mp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>hello-mp<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置<code>application.yml</code>文件</strong></p>
<p>配置数据库相关内容如下</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   <span class="attr">spring:</span></span><br><span class="line">     <span class="attr">datasource:</span></span><br><span class="line">       <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">       <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">       <span class="attr">password:</span> <span class="string">Atguigu.123</span></span><br><span class="line">       <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.10.101:3306/hello_mp?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2b8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 6.2.2.4 创建实体类</span></span><br><span class="line"></span><br><span class="line"><span class="string">创建与`user`表相对应的实体类，如下</span></span><br><span class="line"></span><br><span class="line"><span class="string">```java</span></span><br><span class="line"><span class="string">@Data</span></span><br><span class="line"><span class="string">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="string">public</span> <span class="string">class</span> <span class="string">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">@TableId(value</span> <span class="string">=</span> <span class="string">&quot;id&quot;</span>, <span class="string">type</span> <span class="string">=</span> <span class="string">IdType.AUTO)</span></span><br><span class="line">    <span class="string">private</span> <span class="string">Long</span> <span class="string">id;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">@TableField(&quot;name&quot;)</span></span><br><span class="line">    <span class="string">private</span> <span class="string">String</span> <span class="string">name;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">@TableField(&quot;age&quot;)</span></span><br><span class="line">    <span class="string">private</span> <span class="string">Integer</span> <span class="string">age;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">@TableField(&quot;email&quot;)</span></span><br><span class="line">    <span class="string">private</span> <span class="string">String</span> <span class="string">email;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>知识点</strong>：</p>
<p>实体类中的三个注解的含义如下</p>
<ul>
<li><p><code>@TableName</code>：表名注解，用于标识实体类所对应的表</p>
<ul>
<li><code>value</code>：用于声明表名</li>
</ul>
</li>
<li><p><code>@TableId</code>：主键注解，用于标识主键字段</p>
<ul>
<li><code>value</code>：用于声明主键的字段名</li>
<li><code>type</code>：用于声明主键的生成策略，常用的策略有<code>AUTO</code>、<code>ASSIGN_UUID</code>、<code>INPUT</code>等等</li>
</ul>
</li>
<li><p><code>@TableField</code>：普通字段注解，用于标识属性所对应的表字段</p>
<ul>
<li><code>value</code>：用于声明普通字段的字段名</li>
</ul>
</li>
</ul>
<h4 id="6-2-2-4-通用Mapper"><a href="#6-2-2-4-通用Mapper" class="headerlink" title="6.2.2.4 通用Mapper"></a>6.2.2.4 通用Mapper</h4><p>通用Mapper提供了通用的CRUD方法，使用它可以省去大量编写简单重复的SQL语句的工作，具体用法如下</p>
<ol>
<li><p><strong>创建Mapper接口</strong></p>
<p>创建<code>UserMapper</code>接口，并继承由Mybatis Plus提供的<code>BaseMapper&lt;T&gt;</code>接口，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>若Mapper接口过多，可不用逐一配置<code>@Mapper</code>注解，而使用<code>@MapperScan</code>注解指定包扫描路径进行统一管理，例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.hellomp.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloMpApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HelloMpApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试通用Mapper</strong></p>
<p>创建<code>userMapperTest</code>测试类型，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">11</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;test@test.com&quot;</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span> &#123;</span><br><span class="line">        userMapper.deleteById(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="6-2-2-5-通用Service"><a href="#6-2-2-5-通用Service" class="headerlink" title="6.2.2.5 通用Service"></a>6.2.2.5 通用Service</h4><p>通用Service进一步封装了通用Mapper的CRUD方法，并提供了例如<code>saveOrUpdate</code>、<code>saveBatch</code>等高级方法。</p>
<ol>
<li><p><strong>创建Service接口</strong></p>
<p>创建<code>UserService</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建Service实现类</strong></p>
<p>创建<code>UserServiceImpl</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试通用Service</strong></p>
<p>创建<code>UserServiceImplTest</code>测试类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSaveOrUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userService.getById(<span class="number">2</span>);</span><br><span class="line">        user1.setName(<span class="string">&quot;xiaohu&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user2.setName(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        user2.setAge(<span class="number">27</span>);</span><br><span class="line">        user2.setEmail(<span class="string">&quot;lisi@email.com&quot;</span>);</span><br><span class="line">        userService.saveOrUpdate(user1);</span><br><span class="line">        userService.saveOrUpdate(user2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSaveBatch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user1.setName(<span class="string">&quot;dongdong&quot;</span>);</span><br><span class="line">        user1.setAge(<span class="number">49</span>);</span><br><span class="line">        user1.setEmail(<span class="string">&quot;dongdong@email.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user2.setName(<span class="string">&quot;nannan&quot;</span>);</span><br><span class="line">        user2.setAge(<span class="number">29</span>);</span><br><span class="line">        user2.setEmail(<span class="string">&quot;nannan@email.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users = List.of(user1, user2);</span><br><span class="line">        userService.saveBatch(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="6-2-2-6-条件构造器"><a href="#6-2-2-6-条件构造器" class="headerlink" title="6.2.2.6 条件构造器"></a>6.2.2.6 条件构造器</h4><p>条件构造器用于构造复杂的查询条件，例如获取<code>name=&#39;zhangsan&#39;</code>的用户。MyBatis Plus共提供了两类构造器，分别是<code>QueryWrapper</code>和<code>UpdateWrapper</code>。其中<code>QueryWrapper</code>主要用于查询、删除操作，<code>UpdateWrapper</code>主要用于更新操作，下面通过几个案例学习条件构造器的基础用法。</p>
<ol>
<li><p>创建<code>WrapperTest</code>测试类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询name=Tom的所有用户</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper1.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询邮箱域名为baomidou.com的所有用户</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper2 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper2.like(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;baomidou.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询所有用户信息并按照age字段降序排序</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper3 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper3.orderByDesc(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//查询age介于[20,30]的所有用户</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper4 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper4.between(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//查询age小于20或大于30的用户</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper5 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper5.lt(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>).or().gt(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//邮箱域名为baomidou.com且年龄小于30或大于40且的用户</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper6 = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper6.like(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;baomidou.com&quot;</span>).and(wrapper -&gt; wrapper.lt(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>).or().gt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>));</span><br><span class="line">        </span><br><span class="line">        List&lt;User&gt; list = userService.list(queryWrapper6);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将name=Tom的用户的email改为Tom@baobidou.com</span></span><br><span class="line">        UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        updateWrapper.set(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;Tom@baobidou.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        userService.update(updateWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建<code>LambdaWrapperTest</code>测试类，内容如下</p>
<p>上述的<code>QueryWrapper</code>和<code>UpdateWrapper</code>均有一个<code>Lambda</code>版本，也就是<code>LambdaQueryWrapper</code>和<code>LambdaUpdateWrapper</code>，<code>Lambda</code>版本的优势在于，可以省去字段名的硬编码，具体案例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaWrapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLambdaQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询name=Tom的所有用户</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lambdaQueryWrapper.eq(User::getName, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = userService.list(lambdaQueryWrapper);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLambdaUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//将name=Tom的用户的邮箱改为Tom@tom.com</span></span><br><span class="line">        LambdaUpdateWrapper&lt;User&gt; lambdaUpdateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        lambdaUpdateWrapper.eq(User::getName, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        lambdaUpdateWrapper.set(User::getEmail, <span class="string">&quot;Tom@Tom.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        userService.update(lambdaUpdateWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="6-2-2-7-分页插件"><a href="#6-2-2-7-分页插件" class="headerlink" title="6.2.2.7 分页插件"></a>6.2.2.7 分页插件</h4><p>分页查询是一个很常见的需求，故Mybatis-Plus提供了一个分页插件，使用它可以十分方便的完成分页查询。下面介绍Mybatis-Plus分页插件的用法，详细信息可参考<a target="_blank" rel="noopener" href="https://baomidou.com/pages/97710a/">官方文档</a>。</p>
<ul>
<li><p>配置分页插件</p>
<p>创建<code>com.atguigu.hellomp.config.MPConfiguration</code>配置类，增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MPConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分页插件使用说明</p>
<ul>
<li><p>构造分页对象</p>
<p>分页对象包含了分页的各项信息，其核心属性如下：</p>
</li>
</ul>
</li>
</ul>
<pre><code>| 属性名  | 类型 | 默认值    | 描述                   |
| ------- | ---- | --------- | ---------------------- |
| records | List | emptyList | 查询数据列表           |
| total   | Long | 0         | 查询列表总记录数       |
| size    | Long | 10        | 每页显示条数，默认`10` |
| current | Long | 1         | 当前页                 |

分页对象既作为分页查询的参数，也作为分页查询的返回结果，当作为查询参数时，通常只需提供`current`和`size`属性，如下

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br></pre></td></tr></table></figure>

注：`IPage`为分页接口，`Page`为`IPage`接口的一个实现类。
</code></pre><ul>
<li><p>分页查询</p>
<p>Mybatis Plus的<code>BaseMapper</code>和<code>ServiceImpl</code>均提供了常用的分页查询的方法，例如：</p>
<ul>
<li><p><code>BaseMapper</code>的分页查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page,Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ServiceImpl</code>的分页查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page)</span>;</span><br><span class="line"><span class="comment">// 条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义Mapper</p>
<p>  对于自定义SQL，也可以十分方便的完成分页查询，如下</p>
<p>  <code>Mapper</code>接口：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;UserVo&gt; <span class="title function_">selectPageVo</span><span class="params">(IPage&lt;?&gt; page, Integer state)</span>;</span><br></pre></td></tr></table></figure>
<p>  <code>Mapper.xml</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectPageVo&quot;</span> resultType=<span class="string">&quot;xxx.xxx.xxx.UserVo&quot;</span>&gt;</span><br><span class="line">    SELECT id,name FROM user WHERE state=#&#123;state&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>  <strong>注意</strong>：<code>Mapper.xml</code>中的SQL只需实现查询<code>list</code>的逻辑即可，无需关注分页的逻辑。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>案例实操</p>
<p>分页查询案例如下：</p>
<p>创建<code>PageTest</code>测试类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通用Service分页查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageService</span><span class="params">()</span> &#123;</span><br><span class="line">        Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        Page&lt;User&gt; userPage = userService.page(page);</span><br><span class="line">        userPage.getRecords().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通用Mapper分页查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        IPage&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        IPage&lt;User&gt; userPage = userMapper.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">        userPage.getRecords().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义SQL分页查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCustomMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        IPage&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        IPage&lt;User&gt; userPage = userMapper.selectUserPage(page);</span><br><span class="line">        userPage.getRecords().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在UserMapper中声明分页查询方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;User&gt; <span class="title function_">selectUserPage</span><span class="params">(IPage&lt;User&gt; page)</span>;</span><br></pre></td></tr></table></figure>
<p>创建<code>resources/mapper/UserMapper.xml</code>文件，内容如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.hellomp.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.hellomp.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>Mybatis-Plus中<code>Mapper.xml</code>文件路径默认为：<code>classpath*:/mapper/**/*.xml</code>，可在<code>application.yml</code>中配置以下参数进行修改</p>
   <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="6-2-2-8-MyBatisX插件"><a href="#6-2-2-8-MyBatisX插件" class="headerlink" title="6.2.2.8 MyBatisX插件"></a>6.2.2.8 MyBatisX插件</h4><p>MyBatis Plus提供了一个IDEA插件——<code>MybatisX</code>,使用它可根据数据库快速生成<code>Entity</code>、<code>Mapper</code>、<code>Mapper.xml</code>、<code>Service</code>、<code>ServiceImpl</code>等代码，使用户更专注于业务。</p>
<p>下面演示具体用法</p>
<ol>
<li><p><strong>安装插件</strong></p>
<p>在IDEA插件市场搜索<code>MyBatisX</code>，进行在线安装</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019766.png" style="zoom:67%;" /></p>
</li>
<li><p><strong>配置数据库连接</strong></p>
<p>在IDEA中配置数据库连接</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019767.png" style="zoom:67%;" /></p>
</li>
<li><p><strong>生成代码</strong></p>
<p>首先将之前编写的<code>User</code>、<code>UserMapper</code>、<code>UserServcie</code>、<code>UserServiceImpl</code>全部删除，然后按照下图指示使用插件生成代码</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019768.png" style="zoom:67%;" /></p>
<p>配置实体类相关信息</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019769.png" style="zoom:67%;" /></p>
<p>配置代码模版信息</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019770.png" style="zoom:67%;" /></p>
<p>点击Finish然后查看生成的代码。</p>
</li>
</ol>
<h3 id="6-2-2-MinIO快速入门"><a href="#6-2-2-MinIO快速入门" class="headerlink" title="6.2.2 MinIO快速入门"></a>6.2.2 MinIO快速入门</h3><h4 id="6-2-2-1-MinIO核心概念"><a href="#6-2-2-1-MinIO核心概念" class="headerlink" title="6.2.2.1 MinIO核心概念"></a>6.2.2.1 MinIO核心概念</h4><p>下面介绍MinIO中的几个核心概念，这些概念在所有的对象存储服务中也都是通用的。</p>
<ul>
<li><p><strong>对象（Object）</strong> </p>
<p>对象是实际的数据单元，例如我们上传的一个图片。</p>
</li>
<li><p><strong>存储桶（Bucket）</strong></p>
<p>存储桶是用于组织对象的命名空间，类似于文件夹。每个存储桶可以包含多个对象。</p>
</li>
<li><p><strong>端点（Endpoint）</strong> </p>
<p>端点是MinIO服务器的网络地址，用于访问存储桶和对象，例如<code>http://192.168.10.101:9000</code></p>
<p><strong>注意：</strong></p>
<p><code>9000</code>为MinIO的API的默认端口，前边配置的<code>9001</code>以为管理页面端口。</p>
</li>
<li><p><strong>Access Key 和 Secret Key</strong></p>
<p><strong>Access Key</strong>是用于标识和验证访问者身份的唯一标识符，相当于用户名。</p>
<p><strong>Secret Key</strong>是与<strong>Access Key</strong>关联的密码，用于验证访问者的身份。</p>
</li>
</ul>
<h4 id="6-2-2-2-MinIO管理页面操作"><a href="#6-2-2-2-MinIO管理页面操作" class="headerlink" title="6.2.2.2 MinIO管理页面操作"></a>6.2.2.2 MinIO管理页面操作</h4><ol>
<li><p><strong>登录</strong></p>
<p>管理页面的地址为<a href="http://192.168.10.101:9001，登录的用户名和密码为部署时在`EnvironmentFile`文件中配置的如下参数">http://192.168.10.101:9001，登录的用户名和密码为部署时在`EnvironmentFile`文件中配置的如下参数</a></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MINIO_ROOT_USER</span>=minioadmin</span><br><span class="line"><span class="attr">MINIO_ROOT_PASSWORD</span>=minioadmin</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建存储桶</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019771.png" alt=""></p>
</li>
<li><p><strong>上传图片</strong></p>
<ul>
<li><p>找到目标桶</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019772.png" alt=""></p>
</li>
<li><p>上传图片</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019773.png" alt=""></p>
</li>
</ul>
</li>
<li><p><strong>访问图片</strong></p>
<ul>
<li><p><strong>图片URL</strong></p>
<p>由于MinIO提供了HTTP访问功能，所以可以通过浏览器直接访问对象。对象URL为MinIO的<code>Endpoint</code>+<code>对象的存储路径</code>，例如下图中的图片对象的URL为<a href="http:192.168.10.101:9000/test/公寓-外观.jpg">http:192.168.10.101:9000/test/公寓-外观.jpg</a>。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019774.png" alt=""></p>
</li>
<li><p><strong>访问权限</strong></p>
<p>不出意外的话，使用浏览器访问上述URL，会得到如下响应，很显然是没有访问权限。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Error</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Code</span>&gt;</span>AccessDenied<span class="tag">&lt;/<span class="name">Code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Message</span>&gt;</span>Access Denied.<span class="tag">&lt;/<span class="name">Message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Key</span>&gt;</span>公寓-外观.jpg<span class="tag">&lt;/<span class="name">Key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BucketName</span>&gt;</span>test<span class="tag">&lt;/<span class="name">BucketName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span>&gt;</span>/test/公寓-外观.jpg<span class="tag">&lt;/<span class="name">Resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RequestId</span>&gt;</span>177BC92022FC5684<span class="tag">&lt;/<span class="name">RequestId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">HostId</span>&gt;</span>dd9025bab4ad464b049177c95eb6ebf374d3b3fd1af9251148b658df7ac2e3e8<span class="tag">&lt;/<span class="name">HostId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Error</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>若想继续访问图片，需要修改图片<strong>所在桶</strong>的访问权限，如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019775.png" alt=""></p>
<p>如上图所示，可选的访问权限共有三个选项，分别是<code>Private</code>、<code>Public</code>和<code>Custom</code>，具体说明如下</p>
<ul>
<li><p><code>Private</code></p>
<p>只允许桶的所有者对该桶进行读写。</p>
</li>
<li><p><code>Public</code></p>
<p>允许所有人对该桶进行读写。</p>
</li>
<li><p><code>Custom</code></p>
<p>自定义访问权限。</p>
</li>
</ul>
<p>若想将权限设置为只允许所有者写，但允许所有人读，就需要自定义访问权限。自定义访问权限，需要使用一个规定格式的JSON字符串进行描述，具体格式可参考<a target="_blank" rel="noopener" href="https://min.io/docs/minio/linux/administration/identity-access-management/policy-based-access-control.html#policy-document-structure">官方文档</a>。</p>
<p>例如以下JSON字符串表达的含义是：允许(<code>Allow</code>)所有人(<code>*</code>)读取(<code>s3:GetObject</code>)指定桶(<code>test</code>)的所有内容。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Action&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;s3:GetObject&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Effect&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Principal&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Resource&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;arn:aws:s3:::test/*&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>将<code>test</code>桶访问权限设置为<code>Custom</code>，并添加上述内容</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019776.png" alt=""></p>
<p>重新访问<a href="http:192.168.10.101:9000/test/公寓-外观.jpg">http:192.168.10.101:9000/test/公寓-外观.jpg</a>，观察是否正常。</p>
</li>
</ul>
</li>
</ol>
<h4 id="6-2-2-3-MinIO-Java-SDK"><a href="#6-2-2-3-MinIO-Java-SDK" class="headerlink" title="6.2.2.3 MinIO Java SDK"></a>6.2.2.3 MinIO Java SDK</h4><p>MinIO提供了多种语言的SDK供开发者使用，本项目需要用到Java SDK，下面通过一个简单案例熟悉一下其基本用法，具体内容可参考<a target="_blank" rel="noopener" href="https://www.minio.org.cn/docs/minio/linux/developers/java/minio-java.html#">官方文档</a>。</p>
<ol>
<li><p><strong>创建一个Maven项目</strong></p>
</li>
<li><p><strong>引入如下依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写如下内容</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, NoSuchAlgorithmException, InvalidKeyException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//构造MinIO Client</span></span><br><span class="line">            <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> MinioClient.builder()</span><br><span class="line">                    .endpoint(<span class="string">&quot;http://192.168.10.101:9000&quot;</span>)</span><br><span class="line">                    .credentials(<span class="string">&quot;minioadmin&quot;</span>, <span class="string">&quot;minioadmin&quot;</span>)</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建hello-minio桶</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span> minioClient.bucketExists(BucketExistsArgs.builder().bucket(<span class="string">&quot;hello-minio&quot;</span>).build());</span><br><span class="line">            <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">                <span class="comment">//创建hello-minio桶</span></span><br><span class="line">                minioClient.makeBucket(MakeBucketArgs.builder().bucket(<span class="string">&quot;hello-minio&quot;</span>).build());</span><br><span class="line">                <span class="comment">//设置hello-minio桶的访问权限</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">policy</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        &#123;</span></span><br><span class="line"><span class="string">                          &quot;Statement&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                            &quot;Action&quot; : &quot;s3:GetObject&quot;,</span></span><br><span class="line"><span class="string">                            &quot;Effect&quot; : &quot;Allow&quot;,</span></span><br><span class="line"><span class="string">                            &quot;Principal&quot; : &quot;*&quot;,</span></span><br><span class="line"><span class="string">                            &quot;Resource&quot; : &quot;arn:aws:s3:::hello-minio/*&quot;</span></span><br><span class="line"><span class="string">                          &#125; ],</span></span><br><span class="line"><span class="string">                          &quot;Version&quot; : &quot;2012-10-17&quot;</span></span><br><span class="line"><span class="string">                        &#125;&quot;&quot;&quot;</span>;</span><br><span class="line">                minioClient.setBucketPolicy(SetBucketPolicyArgs.builder().bucket(<span class="string">&quot;hello-minio&quot;</span>).config(policy).build());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Bucket &#x27;hello-minio&#x27; already exists.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//上传图片</span></span><br><span class="line">            minioClient.uploadObject(</span><br><span class="line">                    UploadObjectArgs.builder()</span><br><span class="line">                            .bucket(<span class="string">&quot;hello-minio&quot;</span>)</span><br><span class="line">                            .object(<span class="string">&quot;公寓-外观.jpg&quot;</span>)</span><br><span class="line">                            .filename(<span class="string">&quot;D:\\workspace\\hello-minio\\src\\main\\resources\\公寓-外观.jpg&quot;</span>)</span><br><span class="line">                            .build());</span><br><span class="line">            System.out.println(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MinioException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Error occurred: &quot;</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>运行测试</strong></p>
<p>运行上述代码，然后查看MinIO管理页面，观察是否上传成功。</p>
</li>
</ol>
<h3 id="6-2-3-Redis快速入门"><a href="#6-2-3-Redis快速入门" class="headerlink" title="6.2.3 Redis快速入门"></a>6.2.3 Redis快速入门</h3><h4 id="6-2-3-1-Redis概述"><a href="#6-2-3-1-Redis概述" class="headerlink" title="6.2.3.1 Redis概述"></a>6.2.3.1 Redis概述</h4><ol>
<li><p><strong>Reids定义</strong></p>
<p>Redis（Remote Dictionary Server）是一个<strong>基于内存</strong>的键值对存储系统，常用作缓存服务。由于Reids将数据都保存在内存中，因此其读写性能十分惊人，同时，为保证数据的可靠性，Redis会将数据备份到硬盘上，用于故障发生时的数据恢复。</p>
</li>
<li><p><strong>Redis特点</strong></p>
<ul>
<li><strong>高性能</strong>：Redis主要将数据存储在内存中，因此读写速度非常快，适合对速度有较高要求的场景。</li>
<li><strong>支持多种数据结构</strong>：Redis中键值对的值（Value）支持多种数据结构，如字符串、哈希表、列表、集合等，这使得它可以应用于多种不同的场景。</li>
<li><strong>持久化</strong>：Redis可以通过<strong>定期快照</strong>或者<strong>实时记录写操作日志</strong>的方式将内存中的数据持久化到硬盘，确保数据在重启后不会丢失。</li>
<li><strong>灵活的数据过期策略</strong>：可以为每个键设置过期时间，一旦过期，Redis会自动删除。</li>
</ul>
</li>
<li><p><strong>Redis应用场景</strong></p>
<p>Redis最为常见的一个应用场景就是用作<strong>缓存</strong>，缓存可以显著提升访问速度，降低数据库压力。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019777.svg" style="zoom:45%;" /></p>
</li>
</ol>
<h4 id="6-2-3-2-Reids客户端"><a href="#6-2-3-2-Reids客户端" class="headerlink" title="6.2.3.2 Reids客户端"></a>6.2.3.2 Reids客户端</h4><ol>
<li><p><strong>命令行客户端</strong></p>
<p>Reids提供了一个命令行客户端<code>redis-cli</code>，我们可以使用它连接到Redis服务器，然后通过命令与服务器进行各种交互，例如数据的增删改查。下面介绍该命令的基本用法。</p>
<ul>
<li><p><strong>启动客户端</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：</p>
<ul>
<li><code>-h &lt;hostname&gt;</code>选项用于声明Redis服务器的主机名或IP地址，默认值为<code>127.0.0.1</code>。</li>
<li><code>-p &lt;port&gt;</code>选项用于声明Redis服务器监听的端口号，默认值为<code>6379</code>。</li>
</ul>
</li>
<li><p><strong>测试连接状态</strong></p>
<p><code>ping</code>命令可用于测试连接状态，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：若连接正常，则会返回pong。</p>
</li>
<li><p><strong>退出客户端</strong></p>
<p><code>quit</code>命令可用于断开客户端与服务端的连接，并退出客户端，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>图形化客户端</strong></p>
<p>Redis官方推荐的图形化客户端为<strong>RedisInsight</strong>，该客户端开源免费，且功能强大，下面演示如何使用。</p>
<ul>
<li><p>安装</p>
<p>安装包为<code>RedisInsight-v2-win-installer.exe</code>，可在项目资料中获取，安装步骤比较简单，大家自行安装即可。</p>
</li>
<li><p>选择配置数据库连接</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019778.png" alt=""></p>
</li>
<li><p>填写连接信息，并测试连接，通过后保存连接</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019779.png" alt=""></p>
</li>
<li><p>点击创建好的连接</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019780.png" alt=""></p>
</li>
<li><p>工作界面如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019781.png" alt=""></p>
</li>
</ul>
</li>
</ol>
<h4 id="6-2-3-3-Redis常用数据类型及命令"><a href="#6-2-3-3-Redis常用数据类型及命令" class="headerlink" title="6.2.3.3 Redis常用数据类型及命令"></a>6.2.3.3 Redis常用数据类型及命令</h4><h5 id="6-2-3-3-1-通用命令"><a href="#6-2-3-3-1-通用命令" class="headerlink" title="6.2.3.3.1 通用命令"></a>6.2.3.3.1 通用命令</h5><ul>
<li><p><strong>查看所有键</strong></p>
<p><code>keys</code>命令可用于查看所有键，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys pattern</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：pattern用于匹配key，其中<code>*</code>表示任意个任意字符，<code>?</code>表示一个任意字符。</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; KEYS *</span><br><span class="line">1) &quot;k3&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">3) &quot;k1&quot;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：该命令会遍历Redis服务器中保存的所有键，因此当键很多时会影响整个Redis服务的性能，线上环境需要谨慎使用。</p>
</li>
<li><p><strong>键总数</strong></p>
<p><code>dbsize</code>可用于查看键的总数，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbsize</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>判断键是否存在</strong></p>
<p><code>exists</code>命令可用于判断一个键是否存在，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists key</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：若键存在则返回1，不存在则返回0。</p>
</li>
<li><p><strong>删除键</strong></p>
<p><code>del</code>可用于删除指定键，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del key [key ...]</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：返回值为删除键的个数，若删除一个不存在的键，则返回0。</p>
</li>
<li><p><strong>查询键的剩余过期时间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ttl key</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：<code>ttl</code>的含义为<strong>time to live</strong>，用于查询一个定时键的剩余存活时间，返回值以秒为单位。若查询的键的未设置过期时间，则返回<code>-1</code>，若查询的键不存在，则返回<code>-2</code>。</p>
</li>
<li><p><strong>数据库管理命令</strong></p>
<p>Redis默认有编号为0~15的16个逻辑数据库，每个数据库之间的数据是相互独立的，所有连接默认使用的都是0号数据库。</p>
<ul>
<li><p><strong>切换数据库</strong></p>
<p><code>select</code>命令可用于切换数据库，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select index</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：若index超出范围，会报错</p>
</li>
<li><p><strong>清空数据库</strong></p>
<p><code>flushdb</code>命令会清空当前所选用的数据库，<code>flushall</code>命令会清空0~15号所有的数据库。</p>
<p><strong>注意</strong>：生产环境慎用</p>
</li>
</ul>
</li>
</ul>
<h5 id="6-2-3-3-2-string类型"><a href="#6-2-3-3-2-string类型" class="headerlink" title="6.2.3.3.2 string类型"></a>6.2.3.3.2 string类型</h5><ol>
<li><p><strong>概述</strong></p>
<p>Redis中的string类型保存的是字节序列（Sequence of bytes），因此任意类型的数据，只要经过序列化之后都可以保存到Redis的string类型中，包括文本、数字甚至是一个对象。</p>
</li>
<li><p><strong>常用命令</strong></p>
<ul>
<li><p><strong>set</strong></p>
<p><code>set</code>命令用于添加string类型的键值对，具体语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET key value [NX|XX] [EX seconds|PX milliseconds]</span><br></pre></td></tr></table></figure>
<p>各选项含义如下</p>
<ul>
<li>NX：仅在key不存在时set</li>
<li>XX：仅在key存在时set</li>
<li>EX seconds：设置过期时间，单位为秒</li>
<li>PX milliseconds：设置过期时间，单位为毫秒</li>
</ul>
</li>
<li><p><strong>get</strong></p>
<p><code>get</code>命令用于获取某个string类型的键对应的值，具体语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET key</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>incr</strong></p>
<p><code>incr</code>命令用于对数值做自增操作，具体语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INCR key</span><br></pre></td></tr></table></figure>
<p>若key对应的value是整数，则返回自增后的结果，若不是整数则报错，若key不存在则创建并返回1。</p>
</li>
<li><p><strong>decr</strong></p>
<p><code>decr</code>命令用于对数值做自减操作，具体语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECR key</span><br></pre></td></tr></table></figure>
<p>若key对应的value是整数，则返回自减后的结果，若不是整数则报错，若key不存在则创建并返回-1。</p>
</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<p>string类型常用于缓存、计数器等场景。</p>
</li>
</ol>
<h5 id="6-2-3-3-3-list类型"><a href="#6-2-3-3-3-list类型" class="headerlink" title="6.2.3.3.3 list类型"></a>6.2.3.3.3 list类型</h5><ol>
<li><p><strong>概述</strong></p>
<p>list类型可用于存储多个string类型的元素，并且所有元素按照被添加的顺序存储。</p>
</li>
<li><p><strong>常用命令</strong></p>
<p>list类型相关的命令较多，下面分类进行进行介绍。</p>
<ul>
<li><p><strong>添加元素</strong></p>
<p>向列表中添加元素的命令有<code>lpush</code>、<code>rpush</code> 、<code>linsert</code>，各命令的功能与用法如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019782.png" style="zoom:50%;" /></p>
<ul>
<li><p><code>lpush</code></p>
<p>该命令用于向list左侧添加元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpush key element [element ...]</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpush l1 a b c</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>rpush</code></p>
<p>该命令用于向list右侧添加元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpush key element [element ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>linsert</code></p>
<p>该命令用于向list指定位置添加元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linsert key before|after pivot element</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linsert l1 after b new</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>查询元素</strong></p>
<p>查询list元素的命令有<code>lindex</code>和<code>lrange</code>，各命令的功能与用法如下</p>
<ul>
<li><p><code>lindex</code></p>
<p>该命令用于获取指定索引位置的元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lindex key index</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：index从左到右依次是0，1，2…，从右到左依次是-1，-2，-3…</p>
</li>
<li><p><code>lrange</code></p>
<p>该命令用于获取指定范围内的元素列表，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrange key start stop</span><br></pre></td></tr></table></figure>
<p>示例</p>
<p>获取list全部元素，命令如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrange l1 0 -1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>删除元素</strong></p>
<p>删除list元素的命令有<code>lpop</code>、<code>rpop</code>、<code>lrem</code>，各命令的功能与用法如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019783.png" style="zoom:50%;" /></p>
<ul>
<li><p><code>lpop</code></p>
<p>该命令用于移除并返回list左侧元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpop key [count]</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：count参数表示移除元素的个数</p>
</li>
<li><p><code>rpop</code></p>
<p>该命令用于移除并返回list右侧的元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpop key [count]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>lrem</code></p>
<p>该命令用于移除list中的指定元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrem key count element</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：count参数表示要移除element元素的个数（list中可以存在多个相同的元素），count的用法如下</p>
<ul>
<li>若count&gt;0，则从左到右删除最多count个element元素</li>
<li>若count&lt;0，则从右到左删除最多count（的绝对值）个element元素</li>
<li>若count=0，则删除所有的element元素</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>修改元素</strong></p>
<p><code>lset</code>命令可用于修改指定索引位置的元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lset key index element</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>其他</strong></p>
<p><code>llen</code>命令可用于查看list长度，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llen key</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<ul>
<li>社交应用中，可使用list缓存每个用户发布的最新的N条记录。</li>
<li>list可用作异步消息队列。</li>
</ul>
</li>
</ol>
<h5 id="6-2-3-3-4-set类型"><a href="#6-2-3-3-4-set类型" class="headerlink" title="6.2.3.3.4 set类型"></a>6.2.3.3.4 set类型</h5><ol>
<li><p><strong>概述</strong></p>
<p>和list类型相似，set类型也可用来存储多个string类型的元素，但与list类型不同，set中的元素是无序的，且set中不会包含相同元素。</p>
</li>
<li><p><strong>常用命令</strong></p>
<ul>
<li><p><strong>集合内</strong></p>
<ul>
<li><p><strong>sadd</strong></p>
<p>该命令用于向set中添加元素，语法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sadd key member [member ...]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code> - **smembers**

   该命令用于查询set中的全部元素，语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smembers key</span><br></pre></td></tr></table></figure>


 - **srem**

   该命令用于移除set中的指定元素，语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srem key member [member ...]</span><br></pre></td></tr></table></figure>


 - **spop**

   该命令随机移除并返回set中的n个元素，语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spop key [count]</span><br></pre></td></tr></table></figure>


 - **srandmember**

   该命令随机返回set中的n个元素（不删除），语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srandmember key [count]</span><br></pre></td></tr></table></figure>


 - **scard**（Cardinality，基数）

   该命令用于查询set中的元素个数，语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scard key</span><br></pre></td></tr></table></figure>


 - **sismember**

   该命令用于元素是否在set中，语法如下

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sismember key element</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p><strong>集合间</strong></p>
<ul>
<li><p><strong>sinter</strong></p>
<p>该命令用于计算多个集合的交集，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sinter key [key ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>sunion</strong></p>
<p>该命令用于计算多个集合的并集，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sunion key [key ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>sdiff</strong></p>
<p>该命令用于计算多个集合的差集，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdiff key [key ...]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol>
<li><p><strong>应用场景</strong></p>
<p>set可用于计算共同关注好友，随机抽奖系统等等。</p>
</li>
</ol>
<h5 id="6-2-3-3-5-hash类型"><a href="#6-2-3-3-5-hash类型" class="headerlink" title="6.2.3.3.5 hash类型"></a>6.2.3.3.5 hash类型</h5><ol>
<li><p><strong>概述</strong></p>
<p>hash类型类似于Java语言中的<code>HashMap</code>，可用于存储键值对。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019784.png" style="zoom:50%;" /></p>
</li>
<li><p><strong>常用命令</strong></p>
<ul>
<li><p><strong>hset</strong></p>
<p>该命令用于向hash中增加键值对，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hset key field value [field value ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hget</strong></p>
<p>该命令用于获取hash中某个键对应的值，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hget key field</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hdel</strong></p>
<p>该命令用于删除hash中的指定的键值对，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdel key field [field ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hlen</strong></p>
<p>该命令用于查询hash中的键值对个数，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hlen key</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hexists</strong></p>
<p>该命令用于判断hash中的某个键是否存在，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexists key field</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hkeys</strong></p>
<p>该命令用于返回hash中所有的键，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hkeys key</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hvals</strong></p>
<p>该命令用于返回hash中所有的值，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvals key</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hgetall</strong></p>
<p>该命令用于返回hash中所有的键与值，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgetall key</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<p>hash类型可用于缓存对象等。</p>
</li>
</ol>
<h5 id="6-2-3-3-6-zset类型"><a href="#6-2-3-3-6-zset类型" class="headerlink" title="6.2.3.3.6 zset类型"></a>6.2.3.3.6 zset类型</h5><ol>
<li><p><strong>概述</strong></p>
<p>zset（sorted set）被称为有序集合，同set相似，zset中也不会包含相同元素，但不同的是，zset中的元素是有序的。并且zset中的元素并非像list一样按照元素的插入顺序排序，而是按照每个元素的分数（score）排序。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019785.png" style="zoom:50%;" /></p>
</li>
<li><p><strong>常用命令</strong></p>
<ul>
<li><p><strong>zadd</strong></p>
<p>该命令用于向zset中添加元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZADD key [NX|XX] score member</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li>NX：仅当member不存在时才add</li>
<li>XX：仅当member存在时才add</li>
</ul>
</li>
<li><p><strong>zcard</strong></p>
<p>该命令用于计算zset中的元素个数，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcard key</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>zscore</strong></p>
<p>改名用于查看某个元素的分数，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zscore key member</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>zrank/zrevrank</strong></p>
<p>这组命令用于计算元素的排名，其中zrank按照score的升序排序，zrevrank则按照降序排序，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zrank/zrevrank key member</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong>名次从0开始。</p>
</li>
<li><p><strong>zrem</strong></p>
<p>该命令用于删除元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zrem key member [member ...]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>zincrby</strong> </p>
<p>该命令用于增加元素的分数，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zincrby key increment member</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>zrange</strong></p>
<p>该命令用于查询指定区间范围的元素，语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zrange key start stop [byscore] [rev] [limit offset count] [withscores]</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li>start/stop：用于指定查询区间，但是在不同模式下，其代表的含义也不相同<ul>
<li>默认模式下，<code>start~stop</code>表示的是名次区间，且该区间为闭区间。名次从0开始，且可为负数，-1表示倒数第一，-2表示倒数第二，以此类推。</li>
<li>byscore模式下（声明了byscore参数），则<code>start~stop</code>表示的就是分数区间，该区间默认仍为闭区间。在该模式下，可以在<code>start</code>或<code>stop</code>前增加<code>(</code>来表示开区间，例如<code>(1 (5</code>，表示的就是<code>(1,5)</code>这个开区间。除此之外，还可以使用<code>-inf</code>和<code>+inf</code>表示负无穷和正无穷。</li>
</ul>
</li>
<li>byscore：用于切换到分数模式</li>
<li>rev：表示降序排序。在byscore模式下使用rev参数需要注意查询区间，start应大于stop。</li>
<li>limit：该选项只用于byscore模式，作用和sql语句中的limit一致</li>
<li>withscores：用于打印分数</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<p>zset主要用于各种排行榜。</p>
</li>
</ol>
<h4 id="6-2-3-4-SpringBoot整合Redis"><a href="#6-2-3-4-SpringBoot整合Redis" class="headerlink" title="6.2.3.4 SpringBoot整合Redis"></a>6.2.3.4 SpringBoot整合Redis</h4><h5 id="6-2-3-4-1-Spring-Data-Redis概述"><a href="#6-2-3-4-1-Spring-Data-Redis概述" class="headerlink" title="6.2.3.4.1 Spring Data Redis概述"></a>6.2.3.4.1 Spring Data Redis概述</h5><p><strong>Spring Data Redis</strong> 是Spring大家族中的一个子项目，主要用于Spring程序和Redis的交互。它基于的Redis Java客户端（<a target="_blank" rel="noopener" href="https://github.com/redis/jedis">Jedis</a>和<a target="_blank" rel="noopener" href="https://lettuce.io/">Lettuce</a>）做了抽象，提供了一个统一的编程模型，使得Spring程序与Redis的交互变得十分简单。</p>
<p><strong>Spring Data Redis</strong> 中有一个十分重要的类——<code>RedisTemplate</code>，它封装了与Redis进行的交互的各种方法，我们主要用使用它与Redis进行交互。</p>
<h5 id="6-2-3-4-2-Spring-Data-Redis快速入门"><a href="#6-2-3-4-2-Spring-Data-Redis快速入门" class="headerlink" title="6.2.3.4.2 Spring Data Redis快速入门"></a>6.2.3.4.2 Spring Data Redis快速入门</h5><ol>
<li><p><strong>创建SpringBoot项目</strong></p>
</li>
<li><p><strong>引入Maven依赖</strong></p>
<p>Spring Boot提供了对Spring Data Redis的支持，在Spring Boot项目中可以直接引入<code>spring-boot-starter-data-redis</code>来完成Spring Data Redis的自动配置，具体依赖如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置application.yml文件</strong></p>
<p>在<code>application.yml</code>文件中增加如下参数</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.101</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>RedisTemplate使用</strong></p>
<p>由于<code>spring-boot-starter-data-redis</code>中提供了<code>RedisTemplate</code>的自动配置，所以我们可以将<code>RedisTemplate</code>注入自己的类中，如下边的案例所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRedisTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据Redis的数据类型，RedisTemplate对各种交互方法做了分组，以下是常用的几个分组</p>
<p>| 分组                          | 说明                 |<br>| :—————————————— | :—————————- |<br>| <code>redisTemplate.opsForValue()</code> | 操作string类型的方法 |<br>| <code>redisTemplate.opsForList()</code>  | 操作list类型的方法   |<br>| <code>redisTemplate.opsForSet()</code>   | 操作set类型的方法    |<br>| <code>redisTemplate.opsForHash()</code>  | 操作hash类型的方法   |<br>| <code>redisTemplate.opsForZSet()</code>  | 操作zset类型的方法   |<br>| <code>redisTemplate</code>               | 通用方法             |</p>
<p>下面简单测试几个简单的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRedisTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDel</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>序列化问题</strong></p>
<ul>
<li><p><strong>问题演示</strong></p>
<ul>
<li><p><strong>问题一</strong></p>
<p>使用RedisTemplate向Redis中增加一个键值对</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForValue().set(<span class="string">&quot;key2&quot;</span>,<span class="string">&quot;value2&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>使用RedisTemplate查询key2所对应的value，有结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForValue().get(<span class="string">&quot;key2&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>使用命令行客户端查询key2所对应的value，无结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get key2</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>问题二</strong></p>
<p>在图形化客户端或者命令行客户端观察key2，显示异常</p>
<p>RedisInsight中的key2显示如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019786.png" style="zoom: 80%;" /></p>
<p>命令行客户端中的key2显示如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019787.png" style="zoom:80%;" /></p>
</li>
</ul>
</li>
<li><p><strong>问题说明</strong></p>
<p>上述问题的根本原因是，Redis中的key和value均是以二进制的形式存储的，因此客户端输入的key和value都会经过序列化之后才发往Redis服务端。而RedisTemplate所使用序列化方式和命令行客户端采用序列化方式不相同，进而导致序列化之后的二进制数据不同，所以才会导致上述的现象。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019788.png" style="zoom: 45%;" /></p>
</li>
</ul>
</li>
<li><p><strong>StringRedisTemplate使用</strong></p>
<p>为解决上述问题，可使用<code>StringRedisTemplate</code>代替<code>RedisTemplate</code>，因为<code>StringRedisTemplate</code>使用的序列化器和命令行所使用的序列化器是相同的。</p>
<p><code>spring-boot-starter-data-redis</code>同样提供了<code>StringRedisTemplate</code>的自动配置，因此我们也可以直接将其注入到自己的类中。实例代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestStringRedisTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;key4&quot;</span>, <span class="string">&quot;value4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;key4&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDel</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;key4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="6-2-4-Knife4j快速入门"><a href="#6-2-4-Knife4j快速入门" class="headerlink" title="6.2.4 Knife4j快速入门"></a>6.2.4 Knife4j快速入门</h3><h4 id="6-2-4-1-概述"><a href="#6-2-4-1-概述" class="headerlink" title="6.2.4.1 概述"></a>6.2.4.1 概述</h4><p>Knife4j是一个用于生成和展示API文档的工具，同时它还提供了在线调试的功能，下图是其工作界面。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019719.png" alt=""></p>
<p><strong>了解</strong>：</p>
<ul>
<li>Knife4j有多个版本，最新版的Knife4j基于开源项目<code>springdoc-openapi</code>，这个开源项目的核心功能就是根据SpringBoot项目中的代码自动生成符合OpenAPI规范的接口信息。</li>
<li>OpenAPI规范定义接口文档的内容和格式，其前身是<code>Swagger</code>规范。</li>
</ul>
<h4 id="6-2-4-2-与SpringBoot集成"><a href="#6-2-4-2-与SpringBoot集成" class="headerlink" title="6.2.4.2 与SpringBoot集成"></a>6.2.4.2 与SpringBoot集成</h4><p>与SpringBoot的集成相对简单，具体操作如下</p>
<ol>
<li><p><strong>创建SpringBoot项目</strong></p>
</li>
<li><p><strong>引入Maven 依赖</strong></p>
<p>Knife4j的依赖如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>项目完整的pom.xml文件如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-knife4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello-knife4j<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>hello-knife4j<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建配置类</strong></p>
<p>创建<code>com.atguigu.helloknife4j.config.Knife4jConfiguration</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Knife4jConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">openAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>()</span><br><span class="line">                        .title(<span class="string">&quot;hello-knife4j项目API&quot;</span>)</span><br><span class="line">                        .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;hello-knife4j项目的接口文档&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">userAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;用户信息管理&quot;</span>).</span><br><span class="line">                pathsToMatch(<span class="string">&quot;/user/**&quot;</span>).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">systemAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;产品信息管理&quot;</span>).</span><br><span class="line">                pathsToMatch(<span class="string">&quot;/product/**&quot;</span>).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动项目</strong></p>
<p>启动SpringBoot项目，访问<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html，观察接口文档。">http://localhost:8080/doc.html，观察接口文档。</a></p>
</li>
</ol>
<h4 id="6-2-4-3-基本使用"><a href="#6-2-4-3-基本使用" class="headerlink" title="6.2.4.3 基本使用"></a>6.2.4.3 基本使用</h4><p>Knife4j的使用也十分简单，我们只需使用几个简单注解，对接口进行描述，Knife4j就能自动生成API文档了。具体操作如下</p>
<ol>
<li><p><strong>描述实体类</strong></p>
<p>创建<code>com.atguigu.helloknife4j.entity.User</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;用户信息实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;编号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户邮箱&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p><code>@Schema</code>注解用于描述作为接口参数或者返回值的实体类的数据结构。</p>
</li>
<li><p><strong>描述Controller接口</strong></p>
<p>创建<code>com.atguigu.helloknife4j.controller.HelloController</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;用户信息管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据id获取用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Parameter(description = &quot;用户id&quot;)</span> <span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">11</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;zhangsan@email.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p><code>@Tag</code>注解用于对接口进行分类，相同<code>Tag</code>的接口会放在同一个菜单。</p>
<p><code>@Operation</code>用于对接口进行描述。</p>
<p><code>@Parameter</code>用于对HTTP请求参数进行描述</p>
</li>
</ol>
<h1 id="7-项目开发"><a href="#7-项目开发" class="headerlink" title="7. 项目开发"></a>7. 项目开发</h1><h2 id="7-1-项目初始化"><a href="#7-1-项目初始化" class="headerlink" title="7.1 项目初始化"></a>7.1 项目初始化</h2><h3 id="7-1-1-数据库初始化"><a href="#7-1-1-数据库初始化" class="headerlink" title="7.1.1 数据库初始化"></a>7.1.1 数据库初始化</h3><ol>
<li><p><strong>创建数据库</strong></p>
<p>在MySQL中创建一个<code>lease</code>数据库，建库语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE lease <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>导入数据库脚本</strong></p>
<p>将资料中的<code>lease.sql</code>脚本导入<code>lease</code>数据库，其中包含了建表语句和少量的原始数据。</p>
</li>
</ol>
<h3 id="7-1-2-创建工程"><a href="#7-1-2-创建工程" class="headerlink" title="7.1.2 创建工程"></a>7.1.2 创建工程</h3><p>按照如下目录结构创建一个多模块的Maven工程。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lease</span><br><span class="line">├── common（公共模块——工具类、公用配置等）</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">├── model（数据模型——与数据库相对应地实体类）</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">├── web（Web模块）</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   ├── web-admin（后台管理系统Web模块——包含mapper、service、controller）</span><br><span class="line">│   │   ├── pom.xml</span><br><span class="line">│   │   └── src</span><br><span class="line">│   └── web-app（移动端Web模块——包含mapper、service、controller）</span><br><span class="line">│       ├── pom.xml</span><br><span class="line">│       └── src</span><br><span class="line">└── pom.xml</span><br></pre></td></tr></table></figure>
<p>各模块的pom.xml文件内容如下：</p>
<p><strong>1.  根模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lease<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>model<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>web<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>lease<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2. common模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lease<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>3. model模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lease<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>4. web模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lease<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>web-admin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>web-app<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>5. web-admin模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-admin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>6. web-app模块</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="7-2-后台管理系统后端开发"><a href="#7-2-后台管理系统后端开发" class="headerlink" title="7.2 后台管理系统后端开发"></a>7.2 后台管理系统后端开发</h2><h3 id="7-2-1-项目初始配置"><a href="#7-2-1-项目初始配置" class="headerlink" title="7.2.1 项目初始配置"></a>7.2.1 项目初始配置</h3><h4 id="7-2-1-1-SpringBoot配置"><a href="#7-2-1-1-SpringBoot配置" class="headerlink" title="7.2.1.1 SpringBoot配置"></a>7.2.1.1 SpringBoot配置</h4><p><strong>1. pom文件配置</strong></p>
<p>在<strong>父工程</strong>的pom.xml文件中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 继承Spring Boot父项目 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注意：直接替换pom文件中原有的properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.11.2<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">easycaptcha.version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">easycaptcha.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">minio.version</span>&gt;</span>8.2.0<span class="tag">&lt;/<span class="name">minio.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">knife4j.version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">knife4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun.sms.version</span>&gt;</span>2.0.23<span class="tag">&lt;/<span class="name">aliyun.sms.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置dependencyManagement统一管理依赖版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://baomidou.com/pages/bab2db/ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--knife4j文档--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://doc.xiaominfo.com/docs/quick-start --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;knife4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--JWT登录认证相关--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://github.com/jwtk/jjwt#install-jdk-maven --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--图形验证码--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://gitee.com/ele-admin/EasyCaptcha --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.whvcse<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-captcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;easycaptcha.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--对象存储，用于存储图像等非结构化数据--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://min.io/docs/minio/linux/developers/minio-drivers.html?ref=docs#java-sdk --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;minio.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--阿里云短信客户端，用于发送短信验证码--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方文档：https://help.aliyun.com/document_detail/215759.html?spm=a2c4g.215759.0.0.49f32807f4Yc0y --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dysmsapi20170525<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun.sms.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<strong>web模块</strong>的pom.xml文件中增加如下内容</p>
<ul>
<li>依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--包含spring web相关依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--包含spring test相关依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>插件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring Boot Maven插件，用于打包可执行的JAR文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 创建application.yml文件</strong></p>
<p>在<strong>web-admin模块</strong>的<code>src/main/resources</code>目录下创建<code>application.yml</code>配置文件，内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<p><strong>3. 创建SpringBoot启动类</strong></p>
<p>在<strong>web-admin模块</strong>下创建<code>com.atguigu.lease.AdminWebApplication</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AdminWebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-1-2-Mybatis-Plus配置"><a href="#7-2-1-2-Mybatis-Plus配置" class="headerlink" title="7.2.1.2 Mybatis-Plus配置"></a>7.2.1.2 Mybatis-Plus配置</h4><p>Mybatis-Plus为公用工具，故将其配置于<strong>common模块</strong>。具体配置可参考其<a target="_blank" rel="noopener" href="https://baomidou.com/pages/bab2db/#release">官方文档</a>。</p>
<p><strong>1. pom文件配置</strong></p>
<p>在<strong>common模块</strong>的pom.xml文件中增加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<strong>model模块</strong>的pom.xml文件中增加如下内容：</p>
<blockquote>
<p>因为<strong>model模块</strong>下的实体类中需要配置Mybatis-Plus相关注解，故也需引入Mybatis-Plus依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2. application.yml配置</strong></p>
<p>在<strong>web-admin模块</strong>的<code>application.yml</code>文件增加如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=GMT%2b8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&lt;username&gt;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&lt;password&gt;</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="comment"># 自动检测连接</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span> <span class="comment">#数据库连接超时时间,默认30秒</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span> <span class="comment">#空闲连接存活最大时间，默认600000（10分钟）</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span> <span class="comment">#此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span> <span class="comment">#连接池最大连接数，默认是10</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span> <span class="comment">#最小空闲连接数量</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">SPHHikariPool</span> <span class="comment"># 连接池名称</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#用于打印框架生成的sql语句，便于调试</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：需根据实际情况修改<code>hostname</code>、<code>port</code>、<code>database</code>、<code>username</code>、<code>password</code>。</p>
<p><strong>3. 配置类</strong></p>
<p>在<strong>common模块</strong>下创建<code>com.atguigu.lease.common.mybatisplus.MybatisPlusConfiguration</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.lease.web.*.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfiguration</span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<code>@MapperScan()</code>的包路径需要根据实际情况进行修改。</p>
<h4 id="7-2-1-3-Knife4j配置"><a href="#7-2-1-3-Knife4j配置" class="headerlink" title="7.2.1.3 Knife4j配置"></a>7.2.1.3 Knife4j配置</h4><p><strong>1. pom文件配置</strong></p>
<p>在<strong>web模块</strong>的pom.xml文件添加如下内容</p>
<blockquote>
<p>因为<strong>web-app</strong>模块同样需要Knife4j依赖，故在两个的父工程引入依赖即可</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<strong>model模块</strong>的pom.xml文件添加上述内容</p>
<blockquote>
<p>因为<strong>model模块</strong>下的实体类需要配置Knife4j相关注解，故也需引入Knife4j依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi3-jakarta-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 配置类</strong></p>
<p>后台管理系统和移动端的接口配置并不相同，所以需各自编写一个配置类。在<strong>web-admin模块</strong>下创建<code>com.atguigu.lease.web.admin.custom.config.Knife4jConfiguration</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Knife4jConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">customOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>().info(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Info</span>()</span><br><span class="line">                        .title(<span class="string">&quot;后台管理系统API&quot;</span>)</span><br><span class="line">                        .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;后台管理系统API&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">systemAPI</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;系统信息管理&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/admin/system/**&quot;</span></span><br><span class="line">                ).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">loginAPI</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;后台登录管理&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/admin/login/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/info&quot;</span></span><br><span class="line">                ).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">apartmentAPI</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;公寓信息管理&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/admin/apartment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/room/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/label/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/facility/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/fee/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/attr/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/payment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/region/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/term/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/file/**&quot;</span></span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">leaseAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;租赁信息管理&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/admin/appointment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/admin/agreement/**&quot;</span></span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">userAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;平台用户管理&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/admin/user/**&quot;</span></span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<code>pathsToMatch</code>参数需要根据实际情况进行配置。</p>
<h4 id="7-2-1-3-生成或导入基础代码"><a href="#7-2-1-3-生成或导入基础代码" class="headerlink" title="7.2.1.3 生成或导入基础代码"></a>7.2.1.3 生成或导入基础代码</h4><p>在完成上述配置后，便可使用一些逆向工具自动生成基础代码了（例如实体类、mapper、service等），在使用Mybatis-Plus作为存储层框架时，推荐使用IDEA中的<a target="_blank" rel="noopener" href="https://baomidou.com/pages/ba5b24/">Mybatis X</a>插件。除了可自动生成这些代码，也可直接导入资料中提供的代码。推荐大家直接导入。</p>
<p>导入的代码和目标位置如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>导入代码</th>
<th>模块</th>
<th>包名/路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>实体类</td>
<td>model</td>
<td><code>com.atguigu.lease.model.entity</code></td>
<td>与数据库表一一对应</td>
</tr>
<tr>
<td>枚举类</td>
<td>model</td>
<td><code>com.atguigu.lease.model.enums</code></td>
<td>实体类中的某些状态类字段，使用枚举类型</td>
</tr>
<tr>
<td>mapper接口</td>
<td>web-admin</td>
<td><code>com.atguigu.lease.web.admin.mapper</code></td>
<td>略</td>
</tr>
<tr>
<td>mapper xml</td>
<td>web-admin</td>
<td>src/main/resources/mapper</td>
<td>略</td>
</tr>
<tr>
<td>service</td>
<td>web-admin</td>
<td><code>com.atguigu.lease.web.admin.service</code></td>
<td>略</td>
</tr>
<tr>
<td>serviceImpl</td>
<td>web-admin</td>
<td><code>com.atguigu.lease.web.admin.service.impl</code></td>
<td>略</td>
</tr>
</tbody>
</table>
</div>
<p><strong>知识点</strong>：</p>
<ul>
<li>实体类中的公共字段（例如<code>id</code>、<code>create_time</code>、<code>update_time</code>、<code>is_deleted</code>）抽取到一个基类，进行统一管理，然后让各实体类继承该基类。</li>
<li><p>实体类中的状态字段（例如<code>status</code>）或类型字段（例如<code>type</code>），全部使用枚举类型。</p>
<blockquote>
<p>状态（类型）字段，在数据库中通常用一个数字表示一个状态（类型）。例如：订单状态（1:待支付，2:待发货，3:待收货，4:已收货，5:已完结）。若实体类中对应的字段也用数字类型，例如<code>int</code>，那么程序中就会有大量的如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">order.setStatus(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (order.getStatus() == <span class="number">1</span>) &#123;</span><br><span class="line"> order.setStatus(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些代码后期维护起来会十分麻烦，所以本项目中所有的此类字段均使用枚举类型。例如上述订单状态可定义为以下枚举：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line"></span><br><span class="line"> CANCEL(<span class="number">0</span>, <span class="string">&quot;已取消&quot;</span>),</span><br><span class="line"> WAIT_PAY(<span class="number">1</span>, <span class="string">&quot;待支付&quot;</span>),</span><br><span class="line"> WAIT_TRANSFER(<span class="number">2</span>, <span class="string">&quot;待发货&quot;</span>),</span><br><span class="line"> WAIT_RECEIPT(<span class="number">3</span>, <span class="string">&quot;待收货&quot;</span>),</span><br><span class="line"> RECEIVE(<span class="number">4</span>, <span class="string">&quot;已收货&quot;</span>),</span><br><span class="line"> COMPLETE(<span class="number">5</span>, <span class="string">&quot;已完结&quot;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> Integer value;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> Integer <span class="title function_">value</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> value;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> desc;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>订单实体类中的状态字段定义为<code>Status</code>类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> Status status;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样上述代码便可调整为如下效果，后期维护起来会容易许多。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.setStatus(Status.WAIT_PAY);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>所有的实体类均实现了<code>Serializable</code>接口，方便对实体对象进行缓存。</p>
</li>
<li><p>所有的<code>Mapper</code>接口均没有使用<code>@Mapper</code>注解，而是使用<code>@MapperScan</code>注解统一扫描。</p>
</li>
</ul>
<h4 id="7-2-1-4-导入接口定义代码"><a href="#7-2-1-4-导入接口定义代码" class="headerlink" title="7.2.1.4 导入接口定义代码"></a>7.2.1.4 导入接口定义代码</h4><p>资料中提供了所有的Controller代码，并且Controller中定义好了每个接口（只有定义，没有实现），大家可直接导入接口定义相关的代码，然后只专注于接口逻辑的实现。</p>
<p>导入的代码和目标位置如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>导入代码</th>
<th>模块</th>
<th>包名/路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller</td>
<td>web-admin</td>
<td><code>com.atguigu.lease.web.admin.controller</code></td>
<td>略</td>
</tr>
<tr>
<td>vo</td>
<td>web-admin</td>
<td><code>com.atguigu.lease.web.admin.vo</code></td>
<td>View Object，用于封装或定义接口接受及返回的数据结构</td>
</tr>
<tr>
<td>result</td>
<td>common</td>
<td><code>com.atguigu.lease.common.result</code></td>
<td>统一定义接口返回的数据结构</td>
</tr>
</tbody>
</table>
</div>
<p>导入完成后，便可启动SpringBoot项目，并访问接口文档了，Knife4j文档的url为：<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html。">http://localhost:8080/doc.html。</a></p>
<p><strong>知识点</strong>：</p>
<ul>
<li><p>vo（View Object）：用于封装或定义接口接收及返回的数据的结构。</p>
</li>
<li><p>统一接口返回数据结构：为方便前端对接口数据进行处理，统一接口返回数据结构是一个良好的习惯。</p>
<p>以下是所有接口统一返回的数据结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;正常&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>以下是与上述结构相对应的Java类</p>
<ul>
<li><p>Result</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Data</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">  </span><br><span class="line">      <span class="comment">//返回码</span></span><br><span class="line">      <span class="keyword">private</span> Integer code;</span><br><span class="line">  </span><br><span class="line">      <span class="comment">//返回消息</span></span><br><span class="line">      <span class="keyword">private</span> String message;</span><br><span class="line">  </span><br><span class="line">      <span class="comment">//返回数据</span></span><br><span class="line">      <span class="keyword">private</span> T data;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span> &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">build</span><span class="params">(T data)</span> &#123;</span><br><span class="line">          Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">          <span class="keyword">if</span> (data != <span class="literal">null</span>)</span><br><span class="line">              result.setData(data);</span><br><span class="line">          <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">build</span><span class="params">(T body, ResultCodeEnum resultCodeEnum)</span> &#123;</span><br><span class="line">          Result&lt;T&gt; result = build(body);</span><br><span class="line">          result.setCode(resultCodeEnum.getCode());</span><br><span class="line">          result.setMessage(resultCodeEnum.getMessage());</span><br><span class="line">          <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(T data)</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> build(data, ResultCodeEnum.SUCCESS);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> Result.ok(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> build(<span class="literal">null</span>, ResultCodeEnum.FAIL);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">          Result&lt;T&gt; result = build(<span class="literal">null</span>);</span><br><span class="line">          result.setCode(code);</span><br><span class="line">          result.setMessage(message);</span><br><span class="line">          <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">- ResultCodeEnum</span><br><span class="line"></span><br><span class="line">  为方便管理，可将返回码`code`和返回消息`message`封装到枚举类。</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  <span class="meta">@Getter</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResultCodeEnum</span> &#123;</span><br><span class="line">  </span><br><span class="line">      SUCCESS(<span class="number">200</span>, <span class="string">&quot;成功&quot;</span>),</span><br><span class="line">      FAIL(<span class="number">201</span>, <span class="string">&quot;失败&quot;</span>),</span><br><span class="line">      PARAM_ERROR(<span class="number">202</span>, <span class="string">&quot;参数不正确&quot;</span>),</span><br><span class="line">      SERVICE_ERROR(<span class="number">203</span>, <span class="string">&quot;服务异常&quot;</span>),</span><br><span class="line">      DATA_ERROR(<span class="number">204</span>, <span class="string">&quot;数据异常&quot;</span>),</span><br><span class="line">      ILLEGAL_REQUEST(<span class="number">205</span>, <span class="string">&quot;非法请求&quot;</span>),</span><br><span class="line">      REPEAT_SUBMIT(<span class="number">206</span>, <span class="string">&quot;重复提交&quot;</span>),</span><br><span class="line">      DELETE_ERROR(<span class="number">207</span>, <span class="string">&quot;请先删除子集&quot;</span>),</span><br><span class="line">  </span><br><span class="line">      ADMIN_ACCOUNT_EXIST_ERROR(<span class="number">301</span>, <span class="string">&quot;账号已存在&quot;</span>),</span><br><span class="line">      ADMIN_CAPTCHA_CODE_ERROR(<span class="number">302</span>, <span class="string">&quot;验证码错误&quot;</span>),</span><br><span class="line">      ADMIN_CAPTCHA_CODE_EXPIRED(<span class="number">303</span>, <span class="string">&quot;验证码已过期&quot;</span>),</span><br><span class="line">      ADMIN_CAPTCHA_CODE_NOT_FOUND(<span class="number">304</span>, <span class="string">&quot;未输入验证码&quot;</span>),</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      ADMIN_LOGIN_AUTH(<span class="number">305</span>, <span class="string">&quot;未登陆&quot;</span>),</span><br><span class="line">      ADMIN_ACCOUNT_NOT_EXIST_ERROR(<span class="number">306</span>, <span class="string">&quot;账号不存在&quot;</span>),</span><br><span class="line">      ADMIN_ACCOUNT_ERROR(<span class="number">307</span>, <span class="string">&quot;用户名或密码错误&quot;</span>),</span><br><span class="line">      ADMIN_ACCOUNT_DISABLED_ERROR(<span class="number">308</span>, <span class="string">&quot;该用户已被禁用&quot;</span>),</span><br><span class="line">      ADMIN_ACCESS_FORBIDDEN(<span class="number">309</span>, <span class="string">&quot;无访问权限&quot;</span>),</span><br><span class="line">  </span><br><span class="line">      APP_LOGIN_AUTH(<span class="number">501</span>, <span class="string">&quot;未登陆&quot;</span>),</span><br><span class="line">      APP_LOGIN_PHONE_EMPTY(<span class="number">502</span>, <span class="string">&quot;手机号码为空&quot;</span>),</span><br><span class="line">      APP_LOGIN_CODE_EMPTY(<span class="number">503</span>, <span class="string">&quot;验证码为空&quot;</span>),</span><br><span class="line">      APP_SEND_SMS_TOO_OFTEN(<span class="number">504</span>, <span class="string">&quot;验证法发送过于频繁&quot;</span>),</span><br><span class="line">      APP_LOGIN_CODE_EXPIRED(<span class="number">505</span>, <span class="string">&quot;验证码已过期&quot;</span>),</span><br><span class="line">      APP_LOGIN_CODE_ERROR(<span class="number">506</span>, <span class="string">&quot;验证码错误&quot;</span>),</span><br><span class="line">      APP_ACCOUNT_DISABLED_ERROR(<span class="number">507</span>, <span class="string">&quot;该用户已被禁用&quot;</span>),</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      TOKEN_EXPIRED(<span class="number">601</span>, <span class="string">&quot;token过期&quot;</span>),</span><br><span class="line">      TOKEN_INVALID(<span class="number">602</span>, <span class="string">&quot;token非法&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line">  </span><br><span class="line">      ResultCodeEnum(Integer code, String message) &#123;</span><br><span class="line">          <span class="built_in">this</span>.code = code;</span><br><span class="line">          <span class="built_in">this</span>.message = message;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注意：</strong></p>
<p>由于<code>Result</code>和<code>ResultCodeEnum</code>中使用<code>@Data</code>、<code>@Getter</code>注解，因此需要再<strong>common模块</strong>中引入<code>lombok</code>依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7-2-2-公寓信息管理"><a href="#7-2-2-公寓信息管理" class="headerlink" title="7.2.2 公寓信息管理"></a>7.2.2 公寓信息管理</h3><h4 id="7-2-2-1-房间支付方式管理"><a href="#7-2-2-1-房间支付方式管理" class="headerlink" title="7.2.2.1 房间支付方式管理"></a>7.2.2.1 房间支付方式管理</h4><p>房间支付方式管理共有三个接口，分别是<strong>查询全部支付方式列表</strong>、<strong>保存或更新支付方式</strong>和<strong>根据ID删除支付方式</strong>，下面逐一实现。</p>
<p>首先在<code>PaymentTypeController</code>中注入<code>PaymentTypeService</code>依赖，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;支付方式管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/payment&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentTypeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentTypeService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-查询全部支付方式列表"><a href="#1-查询全部支付方式列表" class="headerlink" title="1. 查询全部支付方式列表"></a>1. 查询全部支付方式列表</h5><p>在<code>PaymentTypeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;查询全部支付方式列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;PaymentType&gt;&gt; <span class="title function_">listPaymentType</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;PaymentType&gt; list = service.list();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<ul>
<li><p><strong>逻辑删除功能</strong></p>
<p>由于数据库中所有表均采用逻辑删除策略，所以查询数据时均需要增加过滤条件<code>is_deleted=0</code>。</p>
<p>上述操作虽不难实现，但是每个查询接口都要考虑到，也显得有些繁琐。为简化上述操作，可以使用Mybatis-Plus提供的逻辑删除功能，它可以自动为查询操作增加<code>is_deleted=0</code>过滤条件，并将删除操作转为更新语句。具体配置如下，详细信息可参考<a target="_blank" rel="noopener" href="https://baomidou.com/pages/6b03c5/#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">官方文档</a>。</p>
<ul>
<li><p>步骤一：在<code>application.yml</code>中增加如下内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">flag</span> <span class="comment"># 全局逻辑删除的实体字段名(配置后可以忽略不配置步骤二)</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤二：在实体类中的删除标识字段上增加<code>@TableLogic</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;主键&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;更新时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;逻辑删除&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Byte isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>逻辑删除功能只对Mybatis-Plus自动注入的sql起效，也就是说，对于手动在<code>Mapper.xml</code>文件配置的sql不会生效，需要单独考虑。</p>
</li>
</ul>
</li>
<li><p><strong>忽略特定字段</strong></p>
<p>通常情况下接口响应的Json对象中并不需要<code>create_time</code>、<code>update_time</code>、<code>is_deleted</code>等字段，这时只需在实体类中的相应字段添加<code>@JsonIgnore</code>注解，该字段就会在序列化时被忽略。</p>
<p>具体配置如下，详细信息可参考Jackson<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-annotations#annotations-for-ignoring-properties">官方文档</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;主键&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;create_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;更新时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;update_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;逻辑删除&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Byte isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="2-保存或更新支付方式"><a href="#2-保存或更新支付方式" class="headerlink" title="2. 保存或更新支付方式"></a>2. 保存或更新支付方式</h5><p>在<code>PaymentTypeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新支付方式&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdatePaymentType</span><span class="params">(<span class="meta">@RequestBody</span> PaymentType paymentType)</span> &#123;</span><br><span class="line">    service.saveOrUpdate(paymentType);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>保存或更新数据时，前端通常不会传入<code>isDeleted</code>、<code>createTime</code>、<code>updateTime</code>这三个字段，因此我们需要手动赋值。但是数据库中几乎每张表都有上述字段，所以手动去赋值就显得有些繁琐。为简化上述操作，我们可采取以下措施。</p>
<ul>
<li><p><code>is_deleted</code>字段：可将数据库中该字段的默认值设置为0。</p>
</li>
<li><p><code>create_time</code>和<code>update_time</code>：可使用mybatis-plus的自动填充功能，所谓自动填充，就是通过统一配置，在插入或更新数据时，自动为某些字段赋值，具体配置如下，详细信息可参考<a target="_blank" rel="noopener" href="https://baomidou.com/pages/4c6bcf/">官方文档</a>。</p>
<ul>
<li><p>为相关字段配置触发填充的时机，例如<code>create_time</code>需要在插入数据时填充，而<code>update_time</code>需要在更新数据时填充。具体配置如下，观察<code>@TableField</code>注解中的<code>fill</code>属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;主键&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;create_time&quot;, fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;更新时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;update_time&quot;, fill = FieldFill.UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;逻辑删除&quot;)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Byte isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置自动填充的内容，具体配置如下</p>
<p>在<strong>common模块</strong>下创建<code>com.atguigu.lease.common.mybatisplus.MybatisMetaObjectHandler</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在做完上述配置后，当写入数据时，Mybatis-Plus会自动将实体对象的<code>create_time</code>字段填充为当前时间，当更新数据时，则会自动将实体对象的<code>update_time</code>字段填充为当前时间。</p>
</li>
</ul>
<h5 id="3-根据ID删除支付方式"><a href="#3-根据ID删除支付方式" class="headerlink" title="3. 根据ID删除支付方式"></a>3. 根据ID删除支付方式</h5><p>在<code>PaymentTypeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据ID删除支付方式&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deletePaymentById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    service.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>MybatisPlus逻辑删除功能的使用。</p>
<h4 id="7-2-2-2-房间租期管理"><a href="#7-2-2-2-房间租期管理" class="headerlink" title="7.2.2.2 房间租期管理"></a>7.2.2.2 房间租期管理</h4><p><strong>房间租期管理</strong>共有三个接口，分别是<strong>查询全部租期列表</strong>、<strong>保存或更新租期信息</strong>和<strong>根据ID删除租期</strong>，具体实现如下。</p>
<p>在<code>LeaseTermController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;租期管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/term&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaseTermController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LeaseTermService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;查询全部租期列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;LeaseTerm&gt;&gt; <span class="title function_">listLeaseTerm</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;LeaseTerm&gt; list = service.list();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;保存或更新租期信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> LeaseTerm leaseTerm)</span> &#123;</span><br><span class="line">        service.saveOrUpdate(leaseTerm);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据ID删除租期&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteLeaseTermById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        service.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-3-标签管理"><a href="#7-2-2-3-标签管理" class="headerlink" title="7.2.2.3 标签管理"></a>7.2.2.3 标签管理</h4><p><strong>标签管理</strong>共有三个接口，分别是<strong>[根据类型]查询标签列表</strong>、<strong>保存或更新标签信息</strong>和<strong>根据ID删除标签</strong>，下面逐一实现。</p>
<p>首先在<code>LabelController</code>中注入<code>LabelInfoService</code>依赖，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;标签管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/label&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LabelInfoService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-根据类型-查询标签列表"><a href="#1-根据类型-查询标签列表" class="headerlink" title="1. [根据类型]查询标签列表"></a>1. [根据类型]查询标签列表</h5><p>在<code>LabelController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;（根据类型）查询标签列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;LabelInfo&gt;&gt; <span class="title function_">labelList</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> ItemType type)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;LabelInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(type != <span class="literal">null</span>, LabelInfo::getType, type);</span><br><span class="line">    List&lt;LabelInfo&gt; list = service.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>上述接口的功能是根据<strong>type</strong>（公寓/房间），查询标签列表。由于这个<strong>type</strong>字段在数据库、实体类、前后端交互的过程中有多种不同的形式，因此在请求和响应的过程中，<strong>type</strong>字段会涉及到多次类型转换。</p>
<p>首先明确一下<strong>type</strong>字段的各种形式：</p>
<ul>
<li><p><strong>数据库中</strong></p>
<p>数据库中的<strong>type</strong>字段为<code>tinyint</code>类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------------+--------------+</span><br><span class="line">| Field       | Type         |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| id          | bigint       |</span><br><span class="line">| type        | tinyint      |</span><br><span class="line">| name        | varchar(255) |</span><br><span class="line">| create_time | timestamp    |</span><br><span class="line">| update_time | timestamp    |</span><br><span class="line">| is_deleted  | tinyint      |</span><br><span class="line">+-------------+--------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>实体类</strong></p>
<p>实体类中的<strong>type</strong>字段为<code>ItemType</code>枚举类型</p>
<p><code>LabelInfo</code>实体类如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;标签信息表&quot;)</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;label_info&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelInfo</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;类型&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;type&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ItemType type;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;标签名称&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ItemType</code>枚举类如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ItemType</span> &#123;</span><br><span class="line"></span><br><span class="line">    APARTMENT(<span class="number">1</span>, <span class="string">&quot;公寓&quot;</span>),</span><br><span class="line">    ROOM(<span class="number">2</span>, <span class="string">&quot;房间&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    ItemType(Integer code, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>前后端交互中</strong></p>
<p>前后端交互所传递的数据中<strong>type</strong>字段为<strong>数字</strong>（1/2）。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019789.png" style="zoom: 70%; border: 1px solid rgb(0, 0, 0);" /></p>
</li>
</ul>
<p>具体转换过程如下图所示：</p>
<ul>
<li><p><strong>请求流程</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019790.png" style="zoom: 200%;" /></p>
<p><strong>说明</strong></p>
<ul>
<li>SpringMVC中的<code>WebDataBinder</code>组件负责将HTTP的请求参数绑定到Controller方法的参数，并实现参数类型的转换。</li>
<li>Mybatis中的<code>TypeHandler</code>用于处理Java中的实体对象与数据库之间的数据类型转换。</li>
</ul>
</li>
<li><p><strong>响应流程</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019791.png" style="zoom:200%;" /></p>
<p><strong>说明</strong></p>
<ul>
<li>SpringMVC中的<code>HTTPMessageConverter</code>组件负责将Controller方法的返回值（Java对象）转换为HTTP响应体中的JSON字符串，或者将请求体中的JSON字符串转换为Controller方法中的参数（Java对象），例如下一个接口<strong>保存或更新标签信息</strong></li>
</ul>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019792.png" style="zoom:200%;" /></p>
</li>
</ul>
<p>下面介绍一下每个环节的类型转换原理</p>
<ul>
<li><p><strong>WebDataBinder枚举类型转换</strong></p>
<p><code>WebDataBinder</code>依赖于<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/core/validation/convert.html"><code>Converter</code></a>实现类型转换，若Controller方法声明的<code>@RequestParam</code>参数的类型不是<code>String</code>，<code>WebDataBinder</code>就会自动进行数据类型转换。SpringMVC提供了常用类型的转换器，例如<code>String</code>到<code>Integer</code>、<code>String</code>到<code>Date</code>，<code>String</code>到<code>Boolean</code>等等，其中也包括<code>String</code>到枚举类型，但是<code>String</code>到枚举类型的默认转换规则是根据实例名称（”APARTMENT”）转换为枚举对象实例（ItemType.APARTMENT）。若想实现<code>code</code>属性到枚举对象实例的转换，需要自定义<code>Converter</code>，代码如下，具体内容可参考<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/core/validation/convert.html#core-convert-Converter-API">官方文档</a>。</p>
<ul>
<li><p>在<strong>web-admin模块</strong>自定义<code>com.atguigu.lease.web.admin.custom.converter.StringToItemTypeConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToItemTypeConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, ItemType&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ItemType <span class="title function_">convert</span><span class="params">(String code)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ItemType value : ItemType.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getCode().equals(Integer.valueOf(code))) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;code非法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册上述的<code>StringToItemTypeConverter</code>，在<strong>web-admin模块</strong>创建<code>com.atguigu.lease.web.admin.custom.config.WebMvcConfiguration</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringToItemTypeConverter stringToItemTypeConverter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        registry.addConverter(<span class="built_in">this</span>.stringToItemTypeConverter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>但是我们有很多的枚举类型都需要考虑类型转换这个问题，按照上述思路，我们需要为每个枚举类型都定义一个Converter，并且每个Converter的转换逻辑都完全相同，针对这种情况，我们使用<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/core/validation/convert.html#core-convert-ConverterFactory-SPI"><code>ConverterFactory</code></a>接口更为合适，这个接口可以将同一个转换逻辑应用到一个接口的所有实现类，因此我们可以定义一个<code>BaseEnum</code>接口，然后另所有的枚举类都实现该接口，然后就可以自定义<code>ConverterFactory</code>，集中编写各枚举类的转换逻辑了。具体实现如下：</p>
<ul>
<li><p>在<strong>model模块</strong>定义<code>com.atguigu.lease.model.enums.BaseEnum</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseEnum</span> &#123;</span><br><span class="line">    Integer <span class="title function_">getCode</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>令所有<code>com.atguigu.lease.model.enums</code>包下的枚举类都实现<code>BaseEnun</code>接口</p>
</li>
<li><p>在<strong>web-admin模块</strong>自定义<code>com.atguigu.lease.web.admin.custom.converter.StringToBaseEnumConverterFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToBaseEnumConverterFactory</span> <span class="keyword">implements</span> <span class="title class_">ConverterFactory</span>&lt;String, BaseEnum&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">BaseEnum</span>&gt; Converter&lt;String, T&gt; <span class="title function_">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, T&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> T <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (T enumConstant : targetType.getEnumConstants()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (enumConstant.getCode().equals(Integer.valueOf(source))) &#123;</span><br><span class="line">                        <span class="keyword">return</span> enumConstant;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;非法的枚举值:&quot;</span> + source);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册上述的<code>ConverterFactory</code>，在<strong>web-admin模块</strong>创建<code>com.atguigu.lease.web.admin.custom.config.WebMvcConfiguration</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringToBaseEnumConverterFactory stringToBaseEnumConverterFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        registry.addConverterFactory(<span class="built_in">this</span>.stringToBaseEnumConverterFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>最终采用的是<code>ConverterFactory</code>方案，因此<code>StringToItemTypeConverter</code>相关代码可以直接删除。</p>
</li>
</ul>
</li>
<li><p><strong>TypeHandler枚举类型转换</strong></p>
<p>Mybatis预置的<code>TypeHandler</code>可以处理常用的数据类型转换，例如<code>String</code>、<code>Integer</code>、<code>Date</code>等等，其中也包含枚举类型，但是枚举类型的默认转换规则是枚举对象实例（ItemType.APARTMENT）和实例名称（”APARTMENT”）相互映射。若想实现<code>code</code>属性到枚举对象实例的相互映射，需要自定义<code>TypeHandler</code>。</p>
<p>不过MybatisPlus提供了一个<a target="_blank" rel="noopener" href="https://baomidou.com/pages/8390a4/">通用的处理枚举类型的TypeHandler</a>。其使用十分简单，只需在<code>ItemType</code>枚举类的<code>code</code>属性上增加一个注解<code>@EnumValue</code>，Mybatis-Plus便可完成从<code>ItemType</code>对象到<code>code</code>属性之间的相互映射，具体配置如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ItemType</span> &#123;</span><br><span class="line"></span><br><span class="line">    APARTMENT(<span class="number">1</span>, <span class="string">&quot;公寓&quot;</span>),</span><br><span class="line">    ROOM(<span class="number">2</span>, <span class="string">&quot;房间&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    ItemType(Integer code, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>HTTPMessageConverter枚举类型转换</strong></p>
<p><code>HttpMessageConverter</code>依赖于Json序列化框架（默认使用Jackson）。其对枚举类型的默认处理规则也是枚举对象实例（ItemType.APARTMENT）和实例名称（”APARTMENT”）相互映射。不过其提供了一个注解<code>@JsonValue</code>，同样只需在<code>ItemType</code>枚举类的<code>code</code>属性上增加一个注解<code>@JsonValue</code>，Jackson便可完成从<code>ItemType</code>对象到<code>code</code>属性之间的互相映射。具体配置如下，详细信息可参考Jackson<a target="_blank" rel="noopener" href="https://fasterxml.github.io/jackson-annotations/javadoc/2.8/com/fasterxml/jackson/annotation/JsonValue.html">官方文档</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ItemType</span> &#123;</span><br><span class="line"></span><br><span class="line">    APARTMENT(<span class="number">1</span>, <span class="string">&quot;公寓&quot;</span>),</span><br><span class="line">    ROOM(<span class="number">2</span>, <span class="string">&quot;房间&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span></span><br><span class="line">  	<span class="meta">@JsonValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    ItemType(Integer code, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="2-保存或更新标签信息"><a href="#2-保存或更新标签信息" class="headerlink" title="2.保存或更新标签信息"></a>2.保存或更新标签信息</h5><p>在<code>LabelController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新标签信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdateFacility</span><span class="params">(<span class="meta">@RequestBody</span> LabelInfo labelInfo)</span> &#123;</span><br><span class="line">    service.saveOrUpdate(labelInfo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-根据ID删除标签"><a href="#3-根据ID删除标签" class="headerlink" title="3. 根据ID删除标签"></a>3. 根据ID删除标签</h5><p>在<code>LabelController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除标签信息&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteLabelById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    service.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-4-配套管理"><a href="#7-2-2-4-配套管理" class="headerlink" title="7.2.2.4 配套管理"></a>7.2.2.4 配套管理</h4><p><strong>配套管理</strong>共有三个接口，分别是<strong>[根据类型]查询配套列表</strong>、<strong>保存或更新配套信息</strong>和<strong>根据ID删除配套</strong>，具体实现如下。</p>
<p>在<code>FacilityController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;配套管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/facility&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FacilityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FacilityInfoService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;[根据类型]查询配套信息列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;FacilityInfo&gt;&gt; <span class="title function_">listFacility</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> ItemType type)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;FacilityInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(type != <span class="literal">null</span>, FacilityInfo::getType, type);</span><br><span class="line">        List&lt;FacilityInfo&gt; list = service.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;新增或修改配套信息&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> FacilityInfo facilityInfo)</span> &#123;</span><br><span class="line">        service.saveOrUpdate(facilityInfo);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据id删除配套信息&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">removeFacilityById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        service.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-5-基本属性管理"><a href="#7-2-2-5-基本属性管理" class="headerlink" title="7.2.2.5 基本属性管理"></a>7.2.2.5 基本属性管理</h4><p>房间基本属性管理共有五个接口，分别是<strong>保存或更新属性名称</strong>、<strong>保存或更新属性值</strong>、<strong>查询全部属性名称和属性值列表</strong>、<strong>根据ID删除属性名称</strong>、<strong>根据ID删除属性值</strong>。下面逐一是实现。</p>
<p>首先在<code>AttrController</code>中注入<code>AttrKeyService</code>和<code>AttrValueService</code>，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;房间属性管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrKeyService attrKeyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrValueService attrValueService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存或更新属性名称"><a href="#1-保存或更新属性名称" class="headerlink" title="1. 保存或更新属性名称"></a>1. 保存或更新属性名称</h5><p>在<code>AttrController</code>增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新属性名称&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;key/saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdateAttrKey</span><span class="params">(<span class="meta">@RequestBody</span> AttrKey attrKey)</span> &#123;</span><br><span class="line"></span><br><span class="line">    attrKeyService.saveOrUpdate(attrKey);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-保存或更新属性值"><a href="#2-保存或更新属性值" class="headerlink" title="2. 保存或更新属性值"></a>2. 保存或更新属性值</h5><p>在<code>AttrController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新属性值&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;value/saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdateAttrValue</span><span class="params">(<span class="meta">@RequestBody</span> AttrValue attrValue)</span> &#123;</span><br><span class="line"></span><br><span class="line">    attrValueService.saveOrUpdate(attrValue);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-查询全部属性名称和属性值列表"><a href="#3-查询全部属性名称和属性值列表" class="headerlink" title="3. 查询全部属性名称和属性值列表"></a>3. 查询全部属性名称和属性值列表</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.admin.vo.attr.AttrKeyVo</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrKeyVo</span> <span class="keyword">extends</span> <span class="title class_">AttrKey</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;属性值列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrValue&gt; attrValueList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>AttrController</code>中添加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;查询全部属性名称和属性值列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;AttrKeyVo&gt;&gt; <span class="title function_">listAttrInfo</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AttrKeyVo&gt; list = attrKeyService.listAttrInfo();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>AttrKeyService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AttrKeyVo&gt; <span class="title function_">listAttrInfo</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>AttrKeyServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AttrKeyMapper mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AttrKeyVo&gt; <span class="title function_">listAttrInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mapper.listAttrInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<p>在<code>AttrKeyMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AttrKeyVo&gt; <span class="title function_">listAttrInfo</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>对应的在<code>AttrKeyMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.admin.vo.attr.AttrKeyVo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;key_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;attrValueList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.AttrValue&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;value_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;value_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;key_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;attrKeyId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listAttrInfo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    select k.id,</span><br><span class="line">           k.name        key_name,</span><br><span class="line">           v.id          value_id,</span><br><span class="line">           v.name        value_name,</span><br><span class="line">           v.attr_key_id key_id</span><br><span class="line">    from attr_key k</span><br><span class="line">             left join attr_value v on k.id = v.attr_key_id and v.is_deleted = 0</span><br><span class="line">    where k.is_deleted = 0</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-根据ID删除属性名称"><a href="#4-根据ID删除属性名称" class="headerlink" title="4. 根据ID删除属性名称"></a>4. 根据ID删除属性名称</h5><p>在<code>AttrController</code>中增加如下内容，注意删除属性名称时，会一并删除其下的所有属性值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除属性名称&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;key/deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeAttrKeyById</span><span class="params">(<span class="meta">@RequestParam</span> Long attrKeyId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除attrKey</span></span><br><span class="line">    attrKeyService.removeById(attrKeyId);</span><br><span class="line">    <span class="comment">//删除attrValue</span></span><br><span class="line">    LambdaQueryWrapper&lt;AttrValue&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(AttrValue::getAttrKeyId, attrKeyId);</span><br><span class="line">    attrValueService.remove(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-根据ID删除属性值"><a href="#5-根据ID删除属性值" class="headerlink" title="5. 根据ID删除属性值"></a>5. 根据ID删除属性值</h5><p>在<code>AttrController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除属性值&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;value/deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeAttrValueById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    attrValueService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-6-公寓杂费管理"><a href="#7-2-2-6-公寓杂费管理" class="headerlink" title="7.2.2.6 公寓杂费管理"></a>7.2.2.6 公寓杂费管理</h4><p>房间基本属性管理共有五个接口，分别是<strong>保存或更新杂费名称</strong>、<strong>保存或更新杂费值</strong>、<strong>查询全部杂费名称和杂费值列表</strong>、<strong>根据ID删除杂费名称</strong>、<strong>根据ID删除杂费值</strong>。下面逐一实现</p>
<p>首先在<code>FeeController</code>中注入<code>FeeKeyService</code>和<code>FeeValueService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;房间杂费管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/fee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FeeKeyService feeKeyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FeeValueService feeValueService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存或更新杂费名称"><a href="#1-保存或更新杂费名称" class="headerlink" title="1. 保存或更新杂费名称"></a>1. 保存或更新杂费名称</h5><p>在<code>FeeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新杂费名称&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;key/saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdateFeeKey</span><span class="params">(<span class="meta">@RequestBody</span> FeeKey feeKey)</span> &#123;</span><br><span class="line">    feeKeyService.saveOrUpdate(feeKey);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-保存或更新杂费值"><a href="#2-保存或更新杂费值" class="headerlink" title="2. 保存或更新杂费值"></a>2. 保存或更新杂费值</h5><p>在<code>FeeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新杂费值&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;value/saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdateFeeValue</span><span class="params">(<span class="meta">@RequestBody</span> FeeValue feeValue)</span> &#123;</span><br><span class="line">    feeValueService.saveOrUpdate(feeValue);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-查询全部杂费名称和杂费值列表"><a href="#3-查询全部杂费名称和杂费值列表" class="headerlink" title="3. 查询全部杂费名称和杂费值列表"></a>3. 查询全部杂费名称和杂费值列表</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>下创的<code>com.atguigu.lease.web.admin.vo.fee.FeeKeyVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeeKeyVo</span> <span class="keyword">extends</span> <span class="title class_">FeeKey</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;杂费value列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;FeeValue&gt; feeValueList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>FeeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;查询全部杂费名称和杂费值列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;FeeKeyVo&gt;&gt; <span class="title function_">feeInfoList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;FeeKeyVo&gt; list = feeKeyService.listFeeInfo();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>FeeKeyService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeeKeyVo&gt; <span class="title function_">listFeeInfo</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FeeKeyServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> FeeKeyMapper mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;FeeKeyVo&gt; <span class="title function_">listFeeInfo</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mapper.listFeeInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>FeeKeyMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeeKeyVo&gt; <span class="title function_">listFeeInfo</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FeeKeyMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=<span class="string">&quot;FeeInfoList&quot;</span> type=<span class="string">&quot;com.atguigu.lease.web.admin.vo.fee.FeeKeyVo&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;name&quot;</span> column=<span class="string">&quot;key_name&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;feeValueList&quot;</span> ofType=<span class="string">&quot;com.atguigu.lease.model.entity.FeeValue&quot;</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">&quot;value_id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;value_name&quot;</span> property=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;value_unit&quot;</span> property=<span class="string">&quot;unit&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;key_id&quot;</span> property=<span class="string">&quot;feeKeyId&quot;</span>/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;listFeeInfo&quot;</span> resultMap=<span class="string">&quot;FeeInfoList&quot;</span>&gt;</span><br><span class="line">    select k.id,</span><br><span class="line">           k.name       key_name,</span><br><span class="line">           v.id         value_id,</span><br><span class="line">           v.name       value_name,</span><br><span class="line">           v.unit       value_unit,</span><br><span class="line">           v.fee_key_id key_id</span><br><span class="line">    from fee_key k</span><br><span class="line">             left join fee_value v on k.id = v.fee_key_id and v.is_deleted = <span class="number">0</span></span><br><span class="line">    where k.is_deleted = <span class="number">0</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="4-根据ID删除杂费名称"><a href="#4-根据ID删除杂费名称" class="headerlink" title="4. 根据ID删除杂费名称"></a>4. 根据ID删除杂费名称</h5><p>在<code>FeeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除杂费名称&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;key/deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteFeeKeyById</span><span class="params">(<span class="meta">@RequestParam</span> Long feeKeyId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除杂费名称</span></span><br><span class="line">    feeKeyService.removeById(feeKeyId);</span><br><span class="line">    <span class="comment">//删除杂费名称下的杂费值</span></span><br><span class="line">    LambdaQueryWrapper&lt;FeeValue&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(FeeValue::getFeeKeyId, feeKeyId);</span><br><span class="line">    feeValueService.remove(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-根据ID删除杂费值"><a href="#5-根据ID删除杂费值" class="headerlink" title="5. 根据ID删除杂费值"></a>5. 根据ID删除杂费值</h5><p>在<code>FeeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除杂费值&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;value/deleteById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteFeeValueById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    feeValueService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-7-地区信息管理"><a href="#7-2-2-7-地区信息管理" class="headerlink" title="7.2.2.7 地区信息管理"></a>7.2.2.7 地区信息管理</h4><p>地区信息管理共有三个接口，分别是<strong>查询省份信息列表</strong>，<strong>根据省份ID查询城市信息列表</strong>和<strong>根据城市ID查询区县信息列表</strong>，具体实现如下</p>
<p>在<code>RegionInfoController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;地区信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/region&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegionInfoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProvinceInfoService provinceInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CityInfoService cityInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DistrictInfoService districtInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;查询省份信息列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;province/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;ProvinceInfo&gt;&gt; <span class="title function_">listProvince</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;ProvinceInfo&gt; list = provinceInfoService.list();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据省份id查询城市信息列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;city/listByProvinceId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;CityInfo&gt;&gt; <span class="title function_">listCityInfoByProvinceId</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;CityInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(CityInfo::getProvinceId, id);</span><br><span class="line">        List&lt;CityInfo&gt; list = cityInfoService.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;district/listByCityId&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;根据城市id查询区县信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DistrictInfo&gt;&gt; <span class="title function_">listDistrictInfoByCityId</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;DistrictInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(DistrictInfo::getCityId, id);</span><br><span class="line">        List&lt;DistrictInfo&gt; list = districtInfoService.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-8-图片上传管理"><a href="#7-2-2-8-图片上传管理" class="headerlink" title="7.2.2.8 图片上传管理"></a>7.2.2.8 图片上传管理</h4><p>由于公寓、房间等实体均包含图片信息，所以在新增或修改公寓、房间信息时，需要上传图片，因此我们需要实现一个上传图片的接口。</p>
<p><strong>1. 图片上传流程</strong></p>
<p>下图展示了新增房间或公寓时，上传图片的流程。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019793.svg" style="zoom: 40%;" /></p>
<p>可以看出图片上传接口接收的是图片文件，返回的Minio对象的URL。</p>
<p><strong>2. 图片上传接口开发</strong></p>
<p>下面为该接口的具体实现</p>
<ul>
<li><p><strong>配置Minio Client</strong></p>
<ul>
<li><p>引入Minio Maven依赖</p>
<p>在<strong>common模块</strong>的<code>pom.xml</code>文件增加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Minio相关参数</p>
<p>在<code>application.yml</code>中配置Minio的<code>endpoint</code>、<code>accessKey</code>、<code>secretKey</code>、<code>bucketName</code>等参数</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">minio:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">http://&lt;hostname&gt;:&lt;port&gt;</span></span><br><span class="line">  <span class="attr">access-key:</span> <span class="string">&lt;access-key&gt;</span></span><br><span class="line">  <span class="attr">secret-key:</span> <span class="string">&lt;secret-key&gt;</span></span><br><span class="line">  <span class="attr">bucket-name:</span> <span class="string">&lt;bucket-name&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：上述<code>&lt;hostname&gt;</code>、<code>&lt;port&gt;</code>等信息需根据实际情况进行修改。</p>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.minio.MinioProperties</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;minio&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.minio.MinioConfiguration</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MinioProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">minioClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder().endpoint(properties.getEndpoint()).credentials(properties.getAccessKey(), properties.getSecretKey()).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>开发图片上传接口</strong></p>
<ul>
<li><p>编写Controller层逻辑</p>
<p>在<code>FileUploadController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;文件管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/file&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;上传文件&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> MultipartFile file)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> service.upload(file);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong><code>MultipartFile</code>是Spring框架中用于处理文件上传的类，它包含了上传文件的信息（如文件名、文件内容等）。</p>
</li>
<li><p>编写Service层逻辑</p>
<ul>
<li><p>在<code>FileService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FileServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MinioProperties properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MinioClient client;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">bucketExists</span> <span class="operator">=</span> client.bucketExists(BucketExistsArgs.builder().bucket(properties.getBucketName()).build());</span><br><span class="line">        <span class="keyword">if</span> (!bucketExists) &#123;</span><br><span class="line">            client.makeBucket(MakeBucketArgs.builder().bucket(properties.getBucketName()).build());</span><br><span class="line">            client.setBucketPolicy(SetBucketPolicyArgs.builder().bucket(properties.getBucketName()).config(createBucketPolicyConfig(properties.getBucketName())).build());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()) + <span class="string">&quot;/&quot;</span> + UUID.randomUUID() + <span class="string">&quot;-&quot;</span> + file.getOriginalFilename();</span><br><span class="line">        client.putObject(PutObjectArgs.builder().</span><br><span class="line">                bucket(properties.getBucketName()).</span><br><span class="line">                object(filename).</span><br><span class="line">                stream(file.getInputStream(), file.getSize(), -<span class="number">1</span>).</span><br><span class="line">                contentType(file.getContentType()).build());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">&quot;/&quot;</span>, properties.getEndpoint(), properties.getBucketName(), filename);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">createBucketPolicyConfig</span><span class="params">(String bucketName)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;Statement&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;Action&quot; : &quot;s3:GetObject&quot;,</span></span><br><span class="line"><span class="string">                &quot;Effect&quot; : &quot;Allow&quot;,</span></span><br><span class="line"><span class="string">                &quot;Principal&quot; : &quot;*&quot;,</span></span><br><span class="line"><span class="string">                &quot;Resource&quot; : &quot;arn:aws:s3:::%s/*&quot;</span></span><br><span class="line"><span class="string">              &#125; ],</span></span><br><span class="line"><span class="string">              &quot;Version&quot; : &quot;2012-10-17&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.formatted(bucketName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>上述<code>createBucketPolicyConfig</code>方法的作用是生成用于描述指定bucket访问权限的JSON字符串。最终生成的字符串格式如下，其表示，允许(<code>Allow</code>)所有人(<code>*</code>)获取(<code>s3:GetObject</code>)指定桶(<code>&lt;bucket-name&gt;</code>)的内容。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Action&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;s3:GetObject&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Effect&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Principal&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Resource&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;arn:aws:s3:::&lt;bucket-name&gt;/*&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>由于公寓、房间的图片为公开信息，所以将其设置为所有人可访问。</p>
</li>
<li><p><strong>异常处理</strong></p>
<ul>
<li><p><strong>问题说明</strong></p>
<p>上述代码只是对<code>MinioClient</code>方法抛出的各种异常进行了捕获，然后打印了异常信息，目前这种处理逻辑，无论Minio是否发生异常，前端在上传文件时，总是会受到成功的响应信息。可按照以下步骤进行操作，查看具体现象</p>
<p>关闭虚拟机中的Minio服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop minio</span><br></pre></td></tr></table></figure>
<p>启动项目，并上传文件，观察接收的响应信息</p>
</li>
<li><p><strong>问题解决思路</strong></p>
<p>为保证前端能够接收到正常的错误提示信息，应该将Service方法的异常抛出到Controller方法中，然后在Controller方法中对异常进行捕获并处理。具体操作如下</p>
<p><strong>Service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> ServerException, InsufficientDataException, ErrorResponseException, IOException, NoSuchAlgorithmException, InvalidKeyException, InvalidResponseException, XmlParserException, InternalException&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">bucketExists</span> <span class="operator">=</span> minioClient.bucketExists(</span><br><span class="line">            BucketExistsArgs.builder()</span><br><span class="line">                    .bucket(properties.getBucketName())</span><br><span class="line">                    .build());</span><br><span class="line">    <span class="keyword">if</span> (!bucketExists) &#123;</span><br><span class="line">        minioClient.makeBucket(</span><br><span class="line">                MakeBucketArgs.builder()</span><br><span class="line">                        .bucket(properties.getBucketName())</span><br><span class="line">                        .build());</span><br><span class="line">        minioClient.setBucketPolicy(</span><br><span class="line">                SetBucketPolicyArgs.builder()</span><br><span class="line">                        .bucket(properties.getBucketName())</span><br><span class="line">                        .config(createBucketPolicyConfig(properties.getBucketName()))</span><br><span class="line">                        .build());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()) +</span><br><span class="line">            <span class="string">&quot;/&quot;</span> + UUID.randomUUID() + <span class="string">&quot;-&quot;</span> + file.getOriginalFilename();</span><br><span class="line">    minioClient.putObject(</span><br><span class="line">            PutObjectArgs.builder()</span><br><span class="line">                    .bucket(properties.getBucketName())</span><br><span class="line">                    .stream(file.getInputStream(), file.getSize(), -<span class="number">1</span>)</span><br><span class="line">                    .object(filename)</span><br><span class="line">                    .contentType(file.getContentType())</span><br><span class="line">                    .build());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> String.join(<span class="string">&quot;/&quot;</span>,properties.getEndpoint(),properties.getBucketName(),filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> MultipartFile file)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> service.upload(file);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(url);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> Result.fail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>全局异常处理</strong></p>
<p>按照上述写法，所有的Controller层方法均需要增加<code>try-catch</code>逻辑，使用Spring MVC提供的<strong>全局异常处理</strong>功能，可以将所有处理异常的逻辑集中起来，进而统一处理所有异常，使代码更容易维护。</p>
<p>具体用法如下，详细信息可参考<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-exceptionhandler.html">官方文档</a>：</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.exception.GlobalExceptionHandler</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> Result.fail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中的关键注解的作用如下</p>
<p><code>@ControllerAdvice</code>用于声明处理全局Controller方法异常的类</p>
<p><code>@ExceptionHandler</code>用于声明处理异常的方法，<code>value</code>属性用于声明该方法处理的异常类型</p>
<p><code>@ResponseBody</code>表示将方法的返回值作为HTTP的响应体</p>
<p><strong>注意：</strong></p>
<p>全局异常处理功能由SpringMVC提供，因此需要在<strong>common模块</strong>的<code>pom.xml</code>中引入如下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改Controller层代码</strong></p>
<p>由于前文的<code>GlobalExceptionHandler</code>会处理所有Controller方法抛出的异常，因此Controller层就无序关注异常的处理逻辑了，因此Controller层代码可做出如下调整。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> MultipartFile file)</span> <span class="keyword">throws</span> ServerException, InsufficientDataException, ErrorResponseException, IOException, NoSuchAlgorithmException, InvalidKeyException, InvalidResponseException, XmlParserException, InternalException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> service.upload(file);</span><br><span class="line">  <span class="keyword">return</span> Result.ok(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="7-2-2-9-公寓管理"><a href="#7-2-2-9-公寓管理" class="headerlink" title="7.2.2.9 公寓管理"></a>7.2.2.9 公寓管理</h4><p>公寓管理共有六个接口，下面逐一实现。</p>
<p>首先在<code>ApartmentController</code>中注入<code>ApartmentInfoService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;公寓信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/apartment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfoService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存或更新公寓信息"><a href="#1-保存或更新公寓信息" class="headerlink" title="1. 保存或更新公寓信息"></a>1. 保存或更新公寓信息</h5><ul>
<li><p><strong>查看请求的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.vo.apartment.ApartmentSubmitVo</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;公寓信息&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentSubmitVo</span> <span class="keyword">extends</span> <span class="title class_">ApartmentInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;公寓配套id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; facilityInfoIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;公寓标签id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; labelIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;公寓杂费值id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; feeValueIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;公寓图片id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ApartmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新公寓信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> ApartmentSubmitVo apartmentSubmitVo)</span> &#123;</span><br><span class="line">    service.saveOrUpdateApartment(apartmentSubmitVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">saveOrUpdateApartment</span><span class="params">(ApartmentSubmitVo apartmentSubmitVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<p><strong>注意</strong>：所需<code>Service</code>和<code>Mapper</code>的注入语句省略未写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdateApartment</span><span class="params">(ApartmentSubmitVo apartmentSubmitVo)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isUpdate</span> <span class="operator">=</span> apartmentSubmitVo.getId()!=<span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">super</span>.saveOrUpdate(apartmentSubmitVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isUpdate)&#123;</span><br><span class="line">        <span class="comment">//1.删除图片列表</span></span><br><span class="line">        LambdaQueryWrapper&lt;GraphInfo&gt; graphQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        graphQueryWrapper.eq(GraphInfo::getItemType, ItemType.APARTMENT);</span><br><span class="line">        graphQueryWrapper.eq(GraphInfo::getItemId,apartmentSubmitVo.getId());</span><br><span class="line">        graphInfoService.remove(graphQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.删除配套列表</span></span><br><span class="line">        LambdaQueryWrapper&lt;ApartmentFacility&gt; facilityQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        facilityQueryWrapper.eq(ApartmentFacility::getApartmentId,apartmentSubmitVo.getId());</span><br><span class="line">        apartmentFacilityService.remove(facilityQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.删除标签列表</span></span><br><span class="line">        LambdaQueryWrapper&lt;ApartmentLabel&gt; labelQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        labelQueryWrapper.eq(ApartmentLabel::getApartmentId,apartmentSubmitVo.getId());</span><br><span class="line">        apartmentLabelService.remove(labelQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.删除杂费列表</span></span><br><span class="line">        LambdaQueryWrapper&lt;ApartmentFeeValue&gt; feeQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        feeQueryWrapper.eq(ApartmentFeeValue::getApartmentId,apartmentSubmitVo.getId());</span><br><span class="line">        apartmentFeeValueService.remove(feeQueryWrapper);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.插入图片列表</span></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = apartmentSubmitVo.getGraphVoList();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(graphVoList))&#123;</span><br><span class="line">        ArrayList&lt;GraphInfo&gt; graphInfoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (GraphVo graphVo : graphVoList) &#123;</span><br><span class="line">            <span class="type">GraphInfo</span> <span class="variable">graphInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GraphInfo</span>();</span><br><span class="line">            graphInfo.setItemType(ItemType.APARTMENT);</span><br><span class="line">            graphInfo.setItemId(apartmentSubmitVo.getId());</span><br><span class="line">            graphInfo.setName(graphVo.getName());</span><br><span class="line">            graphInfo.setUrl(graphVo.getUrl());</span><br><span class="line">            graphInfoList.add(graphInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        graphInfoService.saveBatch(graphInfoList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.插入配套列表</span></span><br><span class="line">    List&lt;Long&gt; facilityInfoIdList = apartmentSubmitVo.getFacilityInfoIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(facilityInfoIdList))&#123;</span><br><span class="line">        ArrayList&lt;ApartmentFacility&gt; facilityList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long facilityId : facilityInfoIdList) &#123;</span><br><span class="line">            <span class="type">ApartmentFacility</span> <span class="variable">apartmentFacility</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentFacility</span>();</span><br><span class="line">            apartmentFacility.setApartmentId(apartmentSubmitVo.getId());</span><br><span class="line">            apartmentFacility.setFacilityId(facilityId);</span><br><span class="line">            facilityList.add(apartmentFacility);</span><br><span class="line">        &#125;</span><br><span class="line">        apartmentFacilityService.saveBatch(facilityList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.插入标签列表</span></span><br><span class="line">    List&lt;Long&gt; labelIds = apartmentSubmitVo.getLabelIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(labelIds)) &#123;</span><br><span class="line">        List&lt;ApartmentLabel&gt; apartmentLabelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long labelId : labelIds) &#123;</span><br><span class="line">            <span class="type">ApartmentLabel</span> <span class="variable">apartmentLabel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentLabel</span>();</span><br><span class="line">            apartmentLabel.setApartmentId(apartmentSubmitVo.getId());</span><br><span class="line">            apartmentLabel.setLabelId(labelId);</span><br><span class="line">            apartmentLabelList.add(apartmentLabel);</span><br><span class="line">        &#125;</span><br><span class="line">        apartmentLabelService.saveBatch(apartmentLabelList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.插入杂费列表</span></span><br><span class="line">    List&lt;Long&gt; feeValueIds = apartmentSubmitVo.getFeeValueIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(feeValueIds)) &#123;</span><br><span class="line">        ArrayList&lt;ApartmentFeeValue&gt; apartmentFeeValueList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long feeValueId : feeValueIds) &#123;</span><br><span class="line">            <span class="type">ApartmentFeeValue</span> <span class="variable">apartmentFeeValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentFeeValue</span>();</span><br><span class="line">            apartmentFeeValue.setApartmentId(apartmentSubmitVo.getId());</span><br><span class="line">            apartmentFeeValue.setFeeValueId(feeValueId);</span><br><span class="line">            apartmentFeeValueList.add(apartmentFeeValue);</span><br><span class="line">        &#125;</span><br><span class="line">        apartmentFeeValueService.saveBatch(apartmentFeeValueList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="2-根据条件分页查询公寓列表"><a href="#2-根据条件分页查询公寓列表" class="headerlink" title="2. 根据条件分页查询公寓列表"></a>2. 根据条件分页查询公寓列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>ApartmentQueryVo</code>为公寓的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;公寓查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;省份id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long provinceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;城市id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long cityId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;区域id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long districtId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>响应数据结构</strong></p>
<p>单个公寓信息记录可查看<code>com.atguigu.lease.web.admin.vo.apartment.ApartmentItemVo</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;后台管理系统公寓列表实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentItemVo</span> <span class="keyword">extends</span> <span class="title class_">ApartmentInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间总数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long totalRoomCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;空闲房间数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long freeRoomCount;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>配置Mybatis-Plus分页插件</strong></p>
<p>在<strong>common模块</strong>中的<code>com.atguigu.lease.common.mybatisplus.MybatisPlusConfiguration</code>中增加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>接口实现</strong></p>
<ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ApartmentController</code>中增加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据条件分页查询公寓列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageItem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;ApartmentItemVo&gt;&gt; <span class="title function_">pageItem</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, ApartmentQueryVo queryVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;ApartmentItemVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;ApartmentItemVo&gt; list = service.pageApartmentItemByQuery(page, queryVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;ApartmentItemVo&gt; <span class="title function_">pageApartmentItemByQuery</span><span class="params">(IPage&lt;ApartmentItemVo&gt; page, ApartmentQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;ApartmentItemVo&gt; <span class="title function_">pageApartmentItemByQuery</span><span class="params">(IPage&lt;ApartmentItemVo&gt; page, ApartmentQueryVo queryVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> apartmentInfoMapper.pageApartmentItemByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;ApartmentItemVo&gt; <span class="title function_">pageApartmentItemByQuery</span><span class="params">(IPage&lt;ApartmentItemVo&gt; page, ApartmentQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageItem&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.admin.vo.apartment.ApartmentItemVo&quot;</span>&gt;</span></span><br><span class="line">    select ai.id,</span><br><span class="line">           ai.name,</span><br><span class="line">           ai.introduction,</span><br><span class="line">           ai.district_id,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_id,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_id,</span><br><span class="line">           ai.province_name,</span><br><span class="line">           ai.address_detail,</span><br><span class="line">           ai.latitude,</span><br><span class="line">           ai.longitude,</span><br><span class="line">           ai.phone,</span><br><span class="line">           ai.is_release,</span><br><span class="line">           ifnull(tc.cnt,0) total_room_count,</span><br><span class="line">           ifnull(tc.cnt,0) - ifnull(cc.cnt,0) free_room_count</span><br><span class="line">    from (select id,</span><br><span class="line">                 name,</span><br><span class="line">                 introduction,</span><br><span class="line">                 district_id,</span><br><span class="line">                 district_name,</span><br><span class="line">                 city_id,</span><br><span class="line">                 city_name,</span><br><span class="line">                 province_id,</span><br><span class="line">                 province_name,</span><br><span class="line">                 address_detail,</span><br><span class="line">                 latitude,</span><br><span class="line">                 longitude,</span><br><span class="line">                 phone,</span><br><span class="line">                 is_release</span><br><span class="line">          from apartment_info</span><br><span class="line">            <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">                is_deleted=0</span><br><span class="line">                <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.provinceId != null&quot;</span>&gt;</span></span><br><span class="line">                    and province_id=#&#123;queryVo.provinceId&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.cityId != null&quot;</span>&gt;</span></span><br><span class="line">                    and city_id=#&#123;queryVo.cityId&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.districtId != null&quot;</span>&gt;</span></span><br><span class="line">                    and district_id=#&#123;queryVo.districtId&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">          ) ai</span><br><span class="line">             left join</span><br><span class="line">         (select apartment_id,</span><br><span class="line">                 count(*) cnt</span><br><span class="line">          from room_info</span><br><span class="line">          where is_deleted = 0</span><br><span class="line">            and is_release = 1</span><br><span class="line">          group by apartment_id) tc</span><br><span class="line">         on ai.id = tc.apartment_id</span><br><span class="line">             left join</span><br><span class="line">         (select apartment_id,</span><br><span class="line">                 count(*) cnt</span><br><span class="line">          from lease_agreement</span><br><span class="line">          where is_deleted = 0</span><br><span class="line">            and status in (2, 5)</span><br><span class="line">          group by apartment_id) cc</span><br><span class="line">         on ai.id = cc.apartment_id</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  <strong>注意：</strong></p>
<p>  默认情况下Knife4j为该接口生成的接口文档如下图所示，其中的queryVo参数不方便调试</p>
<p>  <img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019794.png" style="zoom:50%; zoom:50%;border: 1px solid #000;" /></p>
<p>  可在application.yml文件中增加如下配置，将queryVo做打平处理</p>
  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">springdoc:</span></span><br><span class="line">  <span class="attr">default-flat-param-object:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>  将<code>spring.default-flat-param-object</code>参数设置为<code>true</code>后，效果如下。</p>
<p>  <img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019795.png" style="zoom:50%; zoom:50%;border: 1px solid #000;" /></p>
<h5 id="3-根据ID获取公寓详细信息"><a href="#3-根据ID获取公寓详细信息" class="headerlink" title="3. 根据ID获取公寓详细信息"></a>3. 根据ID获取公寓详细信息</h5><ul>
<li><p><strong>查看响应数据结构</strong></p>
<p>查看<strong>web-admin</strong>下的<code>com.atguigu.lease.web.admin.vo.apartment.ApartmentDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Schema(description = &quot;公寓信息&quot;)</span></span><br><span class="line">  <span class="meta">@Data</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentDetailVo</span> <span class="keyword">extends</span> <span class="title class_">ApartmentInfo</span> &#123;</span><br><span class="line">  </span><br><span class="line">      <span class="meta">@Schema(description = &quot;图片列表&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line">  </span><br><span class="line">      <span class="meta">@Schema(description = &quot;标签列表&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line">  </span><br><span class="line">      <span class="meta">@Schema(description = &quot;配套列表&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> List&lt;FacilityInfo&gt; facilityInfoList;</span><br><span class="line">  </span><br><span class="line">      <span class="meta">@Schema(description = &quot;杂费列表&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> List&lt;FeeValueVo&gt; feeValueVoList;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">- **编写Controller层逻辑**</span><br><span class="line"></span><br><span class="line">  在`ApartmentController`中增加如下内容</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  <span class="meta">@Operation(summary = &quot;根据ID获取公寓详细信息&quot;)</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Result&lt;ApartmentDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">  </span><br><span class="line">      <span class="type">ApartmentDetailVo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> service.getApartmentDetailById(id);</span><br><span class="line">      <span class="keyword">return</span> Result.ok(apartmentInfo);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApartmentDetailVo <span class="title function_">getApartmentDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ApartmentDetailVo <span class="title function_">getApartmentDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//1.查询ApartmentInfo</span></span><br><span class="line">        <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (apartmentInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//2.查询GraphInfo</span></span><br><span class="line">        List&lt;GraphVo&gt; graphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.APARTMENT, id);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//3.查询LabelInfo</span></span><br><span class="line">        List&lt;LabelInfo&gt; labelInfoList = labelInfoMapper.selectListByApartmentId(id);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//4.查询FacilityInfo</span></span><br><span class="line">        List&lt;FacilityInfo&gt; facilityInfoList = facilityInfoMapper.selectListByApartmentId(id);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//5.查询FeeValue</span></span><br><span class="line">        List&lt;FeeValueVo&gt; feeValueVoList = feeValueMapper.selectListByApartmentId(id);</span><br><span class="line">    </span><br><span class="line">        <span class="type">ApartmentDetailVo</span> <span class="variable">adminApartmentDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentDetailVo</span>();</span><br><span class="line">    </span><br><span class="line">        BeanUtils.copyProperties(apartmentInfo, adminApartmentDetailVo);</span><br><span class="line">        adminApartmentDetailVo.setGraphVoList(graphVoList);</span><br><span class="line">        adminApartmentDetailVo.setLabelInfoList(labelInfoList);</span><br><span class="line">        adminApartmentDetailVo.setFacilityInfoList(facilityInfoList);</span><br><span class="line">        adminApartmentDetailVo.setFeeValueVoList(feeValueVoList);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> adminApartmentDetailVo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">- **编写Mapper层逻辑**</span><br><span class="line"></span><br><span class="line">  - 编写公寓图片查询逻辑</span><br><span class="line"></span><br><span class="line">    - 在`GraphInfoMapper`中增加如下内容</span><br><span class="line"></span><br><span class="line">      ```java</span><br><span class="line">      List&lt;GraphVo&gt; <span class="title function_">selectListByItemTypeAndId</span><span class="params">(ItemType itemType, Long itemId)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在<code>GraphInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByItemTypeAndId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.web.admin.vo.graph.GraphVo&quot;</span>&gt;</span><br><span class="line">    select</span><br><span class="line">        name,</span><br><span class="line">        url</span><br><span class="line">    from graph_info</span><br><span class="line">    where is_deleted=<span class="number">0</span></span><br><span class="line">    and item_type=#&#123;itemType&#125;</span><br><span class="line">    and item_id=#&#123;itemId&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写公寓标签查询逻辑</p>
<ul>
<li><p>在<code>LabelInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LabelInfo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LabelInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByApartmentId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name</span><br><span class="line">    from label_info</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span></span><br><span class="line">          <span class="params">(select label_id</span></span><br><span class="line"><span class="params">           from apartment_label</span></span><br><span class="line"><span class="params">           where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">             and apartment_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写公寓配套查询逻辑</p>
<ul>
<li><p>在<code>FacilityInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FacilityInfo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FacilityInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByApartmentId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.FacilityInfo&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name,</span><br><span class="line">           icon</span><br><span class="line">    from facility_info</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span></span><br><span class="line">          <span class="params">(select facility_id</span></span><br><span class="line"><span class="params">           from apartment_facility</span></span><br><span class="line"><span class="params">           where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">             and apartment_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写公寓杂费查询逻辑</p>
<ul>
<li><p>在<code>FeeValueMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeeValueVo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FeeValueMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByApartmentId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.web.admin.vo.fee.FeeValueVo&quot;</span>&gt;</span><br><span class="line">    SELECT fv.id,</span><br><span class="line">           fv.name,</span><br><span class="line">           fv.unit,</span><br><span class="line">           fv.fee_key_id,</span><br><span class="line">           fk.name AS fee_key_name</span><br><span class="line">    FROM fee_value fv</span><br><span class="line">             JOIN fee_key fk ON fv.fee_key_id = fk.id</span><br><span class="line">    WHERE fv.is_deleted = <span class="number">0</span></span><br><span class="line">      AND fk.is_deleted = <span class="number">0</span></span><br><span class="line">      and fv.id <span class="title function_">in</span> <span class="params">(select fee_value_id</span></span><br><span class="line"><span class="params">                    from apartment_fee_value</span></span><br><span class="line"><span class="params">                    where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">                      and apartment_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="4-根据ID删除公寓信息"><a href="#4-根据ID删除公寓信息" class="headerlink" title="4. 根据ID删除公寓信息"></a>4. 根据ID删除公寓信息</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ApartmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除公寓信息&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;removeById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    service.removeApartmentById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">removeApartmentById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeApartmentById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">super</span>.removeById(id);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.删除GraphInfo</span></span><br><span class="line">    LambdaQueryWrapper&lt;GraphInfo&gt; graphQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemType, ItemType.APARTMENT);</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemId, id);</span><br><span class="line">    graphInfoService.remove(graphQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除ApartmentLabel</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentLabel&gt; labelQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    labelQueryWrapper.eq(ApartmentLabel::getApartmentId, id);</span><br><span class="line">    apartmentLabelService.remove(labelQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.删除ApartmentFacility</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentFacility&gt; facilityQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    facilityQueryWrapper.eq(ApartmentFacility::getApartmentId, id);</span><br><span class="line">    apartmentFacilityService.remove(facilityQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除ApartmentFeeValue</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentFeeValue&gt; feeQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    feeQueryWrapper.eq(ApartmentFeeValue::getApartmentId, id);</span><br><span class="line">    apartmentFeeValueService.remove(feeQueryWrapper);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>由于公寓下会包含房间信息，因此在删除公寓时最好先判断一下该公寓下是否存在房间信息，若存在，则提醒用户先删除房间信息后再删除公寓信息，判断逻辑如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;RoomInfo&gt; roomQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">roomQueryWrapper.eq(RoomInfo::getApartmentId, id);</span><br><span class="line"><span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> roomInfoMapper.selectCount(roomQueryWrapper);</span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//直接为前端返回如下响应：先删除房间信息再删除公寓信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要直接为前端返回响应，可利用前边配置的全局异常处理功能（此处直接抛出异常，全局异常处理器捕获到异常后，便会直接为前端返回响应结果）。</p>
<p>为灵活设置响应信息，可自定义异常类，如下</p>
<p>在<strong>common模块</strong>创建<code>com.atguigu.lease.common.exception.LeaseException</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaseException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常状态码</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过状态码和错误消息创建异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeaseException</span><span class="params">(String message, Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据响应结果枚举对象创建异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeaseException</span><span class="params">(ResultCodeEnum resultCodeEnum)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="built_in">this</span>.code = resultCodeEnum.getCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LeaseException&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&quot;, message=&quot;</span> + <span class="built_in">this</span>.getMessage() +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<strong>common模块</strong>的<code>com.atguigu.lease.common.exception.GlobalExceptionHandler</code>类中，增加自定义异常类的处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(LeaseException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(LeaseException e)</span>&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> Result.fail(e.getCode(), e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为Result新增一个构造方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">    Result&lt;T&gt; result = build(<span class="literal">null</span>);</span><br><span class="line">    result.setCode(code);</span><br><span class="line">    result.setMessage(message);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>removeApartmentById</code>方法的最终实现如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeApartmentById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    LambdaQueryWrapper&lt;RoomInfo&gt; roomQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    roomQueryWrapper.eq(RoomInfo::getApartmentId, id);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> roomInfoMapper.selectCount(roomQueryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_APARTMENT_DELETE_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.删除GraphInfo</span></span><br><span class="line">    LambdaQueryWrapper&lt;GraphInfo&gt; graphQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemType, ItemType.APARTMENT);</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemId, id);</span><br><span class="line">    graphInfoService.remove(graphQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除ApartmentLabel</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentLabel&gt; labelQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    labelQueryWrapper.eq(ApartmentLabel::getApartmentId, id);</span><br><span class="line">    apartmentLabelService.remove(labelQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.删除ApartmentFacility</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentFacility&gt; facilityQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    facilityQueryWrapper.eq(ApartmentFacility::getApartmentId, id);</span><br><span class="line">    apartmentFacilityService.remove(facilityQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除ApartmentFeeValue</span></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentFeeValue&gt; feeQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    feeQueryWrapper.eq(ApartmentFeeValue::getApartmentId, id);</span><br><span class="line">    apartmentFeeValueService.remove(feeQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.删除ApartmentInfo</span></span><br><span class="line">    <span class="built_in">super</span>.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="5-根据ID修改公寓发布状态"><a href="#5-根据ID修改公寓发布状态" class="headerlink" title="5. 根据ID修改公寓发布状态"></a>5. 根据ID修改公寓发布状态</h5><p>在<code>ApartmentController</code>中增加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id修改公寓发布状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateReleaseStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateReleaseStatusById</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> ReleaseStatus status)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaUpdateWrapper&lt;ApartmentInfo&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(ApartmentInfo::getId, id);</span><br><span class="line">    updateWrapper.set(ApartmentInfo::getIsRelease, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-根据区县ID查询公寓信息列表"><a href="#6-根据区县ID查询公寓信息列表" class="headerlink" title="6. 根据区县ID查询公寓信息列表"></a>6. 根据区县ID查询公寓信息列表</h5><p>在<code>ApartmentController</code>中增加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据区县id查询公寓信息列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;listInfoByDistrictId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;ApartmentInfo&gt;&gt; <span class="title function_">listInfoByDistrictId</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;ApartmentInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(ApartmentInfo::getDistrictId, id);</span><br><span class="line">    List&lt;ApartmentInfo&gt; list = service.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-10-房间管理"><a href="#7-2-2-10-房间管理" class="headerlink" title="7.2.2.10 房间管理"></a>7.2.2.10 房间管理</h4><p>房间管理共有六个接口，下面逐一实现</p>
<p>首先在<code>RoomController</code>中注入<code>RoomInfoService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;房间信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/room&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoomInfoService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存或更新房间信息"><a href="#1-保存或更新房间信息" class="headerlink" title="1. 保存或更新房间信息"></a>1. 保存或更新房间信息</h5><ul>
<li><p><strong>查看请求的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.vo.room.RoomSubmitVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;房间信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomSubmitVo</span> <span class="keyword">extends</span> <span class="title class_">RoomInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;属性信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; attrValueIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;配套信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; facilityInfoIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;标签信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; labelInfoIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;支付方式列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; paymentTypeIds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;可选租期列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; leaseTermIds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新房间信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> RoomSubmitVo roomSubmitVo)</span> &#123;</span><br><span class="line">    service.saveOrUpdateRoom(roomSubmitVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service 层逻辑</strong></p>
<p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">saveOrUpdateRoom</span><span class="params">(RoomSubmitVo roomSubmitVo)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdateRoom</span><span class="params">(RoomSubmitVo roomSubmitVo)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isUpdate</span> <span class="operator">=</span> roomSubmitVo.getId() != <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">super</span>.saveOrUpdate(roomSubmitVo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//若为更新操作，则先删除与Room相关的各项信息列表</span></span><br><span class="line">    <span class="keyword">if</span> (isUpdate) &#123;</span><br><span class="line">        <span class="comment">//1.删除原有graphInfoList</span></span><br><span class="line">        LambdaQueryWrapper&lt;GraphInfo&gt; graphQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        graphQueryWrapper.eq(GraphInfo::getItemType, ItemType.ROOM);</span><br><span class="line">        graphQueryWrapper.eq(GraphInfo::getItemId, roomSubmitVo.getId());</span><br><span class="line">        graphInfoService.remove(graphQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.删除原有roomAttrValueList</span></span><br><span class="line">        LambdaQueryWrapper&lt;RoomAttrValue&gt; attrQueryMapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        attrQueryMapper.eq(RoomAttrValue::getRoomId, roomSubmitVo.getId());</span><br><span class="line">        roomAttrValueService.remove(attrQueryMapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.删除原有roomFacilityList</span></span><br><span class="line">        LambdaQueryWrapper&lt;RoomFacility&gt; facilityQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        facilityQueryWrapper.eq(RoomFacility::getRoomId, roomSubmitVo.getId());</span><br><span class="line">        roomFacilityService.remove(facilityQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.删除原有roomLabelList</span></span><br><span class="line">        LambdaQueryWrapper&lt;RoomLabel&gt; labelQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        labelQueryWrapper.eq(RoomLabel::getRoomId, roomSubmitVo.getId());</span><br><span class="line">        roomLabelService.remove(labelQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.删除原有paymentTypeList</span></span><br><span class="line">        LambdaQueryWrapper&lt;RoomPaymentType&gt; paymentQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        paymentQueryWrapper.eq(RoomPaymentType::getRoomId, roomSubmitVo.getId());</span><br><span class="line">        roomPaymentTypeService.remove(paymentQueryWrapper);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.删除原有leaseTermList</span></span><br><span class="line">        LambdaQueryWrapper&lt;RoomLeaseTerm&gt; termQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        termQueryWrapper.eq(RoomLeaseTerm::getRoomId, roomSubmitVo.getId());</span><br><span class="line">        roomLeaseTermService.remove(termQueryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.保存新的graphInfoList</span></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = roomSubmitVo.getGraphVoList();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(graphVoList)) &#123;</span><br><span class="line">        ArrayList&lt;GraphInfo&gt; graphInfoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (GraphVo graphVo : graphVoList) &#123;</span><br><span class="line">            <span class="type">GraphInfo</span> <span class="variable">graphInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GraphInfo</span>();</span><br><span class="line">            graphInfo.setItemType(ItemType.ROOM);</span><br><span class="line">            graphInfo.setItemId(roomSubmitVo.getId());</span><br><span class="line">            graphInfo.setName(graphVo.getName());</span><br><span class="line">            graphInfo.setUrl(graphVo.getUrl());</span><br><span class="line">            graphInfoList.add(graphInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        graphInfoService.saveBatch(graphInfoList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.保存新的roomAttrValueList</span></span><br><span class="line">    List&lt;Long&gt; attrValueIds = roomSubmitVo.getAttrValueIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(attrValueIds)) &#123;</span><br><span class="line">        List&lt;RoomAttrValue&gt; roomAttrValueList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long attrValueId : attrValueIds) &#123;</span><br><span class="line">            <span class="type">RoomAttrValue</span> <span class="variable">roomAttrValue</span> <span class="operator">=</span> RoomAttrValue.builder().roomId(roomSubmitVo.getId()).attrValueId(attrValueId).build();</span><br><span class="line">            roomAttrValueList.add(roomAttrValue);</span><br><span class="line">        &#125;</span><br><span class="line">        roomAttrValueService.saveBatch(roomAttrValueList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.保存新的facilityInfoList</span></span><br><span class="line">    List&lt;Long&gt; facilityInfoIds = roomSubmitVo.getFacilityInfoIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(facilityInfoIds)) &#123;</span><br><span class="line">        List&lt;RoomFacility&gt; roomFacilityList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long facilityInfoId : facilityInfoIds) &#123;</span><br><span class="line">            <span class="type">RoomFacility</span> <span class="variable">roomFacility</span> <span class="operator">=</span> RoomFacility.builder().roomId(roomSubmitVo.getId()).facilityId(facilityInfoId).build();</span><br><span class="line">            roomFacilityList.add(roomFacility);</span><br><span class="line">        &#125;</span><br><span class="line">        roomFacilityService.saveBatch(roomFacilityList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.保存新的labelInfoList</span></span><br><span class="line">    List&lt;Long&gt; labelInfoIds = roomSubmitVo.getLabelInfoIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(labelInfoIds)) &#123;</span><br><span class="line">        ArrayList&lt;RoomLabel&gt; roomLabelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long labelInfoId : labelInfoIds) &#123;</span><br><span class="line">            <span class="type">RoomLabel</span> <span class="variable">roomLabel</span> <span class="operator">=</span> RoomLabel.builder().roomId(roomSubmitVo.getId()).labelId(labelInfoId).build();</span><br><span class="line">            roomLabelList.add(roomLabel);</span><br><span class="line">        &#125;</span><br><span class="line">        roomLabelService.saveBatch(roomLabelList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.保存新的paymentTypeList</span></span><br><span class="line">    List&lt;Long&gt; paymentTypeIds = roomSubmitVo.getPaymentTypeIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(paymentTypeIds)) &#123;</span><br><span class="line">        ArrayList&lt;RoomPaymentType&gt; roomPaymentTypeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long paymentTypeId : paymentTypeIds) &#123;</span><br><span class="line">            <span class="type">RoomPaymentType</span> <span class="variable">roomPaymentType</span> <span class="operator">=</span> RoomPaymentType.builder().roomId(roomSubmitVo.getId()).paymentTypeId(paymentTypeId).build();</span><br><span class="line">            roomPaymentTypeList.add(roomPaymentType);</span><br><span class="line">        &#125;</span><br><span class="line">        roomPaymentTypeService.saveBatch(roomPaymentTypeList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.保存新的leaseTermList</span></span><br><span class="line">    List&lt;Long&gt; leaseTermIds = roomSubmitVo.getLeaseTermIds();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(leaseTermIds)) &#123;</span><br><span class="line">        ArrayList&lt;RoomLeaseTerm&gt; roomLeaseTerms = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long leaseTermId : leaseTermIds) &#123;</span><br><span class="line">            <span class="type">RoomLeaseTerm</span> <span class="variable">roomLeaseTerm</span> <span class="operator">=</span> RoomLeaseTerm.builder().roomId(roomSubmitVo.getId()).leaseTermId(leaseTermId).build();</span><br><span class="line">            roomLeaseTerms.add(roomLeaseTerm);</span><br><span class="line">        &#125;</span><br><span class="line">        roomLeaseTermService.saveBatch(roomLeaseTerms);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="2-根据条件分页查询房间列表"><a href="#2-根据条件分页查询房间列表" class="headerlink" title="2. 根据条件分页查询房间列表"></a>2. 根据条件分页查询房间列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>RoomQueryVo</code>为房间的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;房间查询实体&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;省份Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long provinceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;城市Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long cityId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;区域Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long districtId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long apartmentId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>响应数据结构</strong></p>
<p>单个房间信息记录可查看<code>com.atguigu.lease.web.admin.vo.room.RoomItemVo</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;房间信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomItemVo</span> <span class="keyword">extends</span> <span class="title class_">RoomInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约结束日期&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date leaseEndDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;当前入住状态&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isCheckIn;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;所属公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据条件分页查询房间列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageItem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;RoomItemVo&gt;&gt; <span class="title function_">pageItem</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, RoomQueryVo queryVo)</span> &#123;</span><br><span class="line">    IPage&lt;RoomItemVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;RoomItemVo&gt; result = service.pageRoomItemByQuery(page, queryVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service 层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(IPage&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(IPage&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> roomInfoMapper.pageRoomItemByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(IPage&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=<span class="string">&quot;RoomItemVoMap&quot;</span> type=<span class="string">&quot;com.atguigu.lease.web.admin.vo.room.RoomItemVo&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;apartmentInfo&quot;</span> javaType=<span class="string">&quot;com.atguigu.lease.model.entity.ApartmentInfo&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;apart_id&quot;</span>/&gt;</span><br><span class="line">        &lt;result property=<span class="string">&quot;isRelease&quot;</span> column=<span class="string">&quot;apart_is_release&quot;</span>/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;pageRoomItemByQuery&quot;</span> resultMap=<span class="string">&quot;RoomItemVoMap&quot;</span>&gt;</span><br><span class="line">    select ri.id,</span><br><span class="line">           ri.room_number,</span><br><span class="line">           ri.rent,</span><br><span class="line">           ri.apartment_id,</span><br><span class="line">           ri.is_release,</span><br><span class="line">           la.room_id is not <span class="literal">null</span> is_check_in,</span><br><span class="line">           la.lease_end_date,</span><br><span class="line">           ai.id                  apart_id,</span><br><span class="line">           ai.name,</span><br><span class="line">           ai.introduction,</span><br><span class="line">           ai.district_id,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_id,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_id,</span><br><span class="line">           ai.province_name,</span><br><span class="line">           ai.address_detail,</span><br><span class="line">           ai.latitude,</span><br><span class="line">           ai.longitude,</span><br><span class="line">           ai.phone,</span><br><span class="line">           ai.is_release          apart_is_release</span><br><span class="line">    from room_info ri</span><br><span class="line">             left join lease_agreement la</span><br><span class="line">                       on ri.id = la.room_id</span><br><span class="line">                           and la.is_deleted = <span class="number">0</span></span><br><span class="line">                           and la.status <span class="title function_">in</span> <span class="params">(<span class="number">2</span>,<span class="number">5</span>)</span></span><br><span class="line">             left join apartment_info ai</span><br><span class="line">                       on ri.apartment_id = ai.id</span><br><span class="line">                           and ai.is_deleted = <span class="number">0</span></span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        ri.is_deleted = <span class="number">0</span></span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.provinceId != null&quot;</span>&gt;</span><br><span class="line">            apart.province_id = #&#123;queryVo.provinceId&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.cityId != null&quot;</span>&gt;</span><br><span class="line">            and apart.city_id = #&#123;queryVo.cityId&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.districtId != null&quot;</span>&gt;</span><br><span class="line">            and apart.district_id = #&#123;queryVo.districtId&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.apartmentId != null&quot;</span>&gt;</span><br><span class="line">            <span class="type">and</span> <span class="variable">apartment_id</span> <span class="operator">=</span> #&#123;queryVo.apartmentId&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="3-根据ID获取房间详细信息"><a href="#3-根据ID获取房间详细信息" class="headerlink" title="3. 根据ID获取房间详细信息"></a>3. 根据ID获取房间详细信息</h5><ul>
<li><p><strong>查看响应数据结构</strong></p>
<p>查看<strong>web-admin</strong>下的<code>com.atguigu.lease.web.admin.vo.room.RoomDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;房间信息&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomDetailVo</span> <span class="keyword">extends</span> <span class="title class_">RoomInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;所属公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;属性信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrValueVo&gt; attrValueVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;配套信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;FacilityInfo&gt; facilityInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;标签信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;支付方式列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PaymentType&gt; paymentTypeList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;可选租期列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LeaseTerm&gt; leaseTermList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id获取房间详细信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;RoomDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> service.getRoomDetailById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(roomInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service 层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoomDetailVo <span class="title function_">getRoomDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> RoomDetailVo <span class="title function_">getRoomDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.查询RoomInfo</span></span><br><span class="line">    <span class="type">RoomInfo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> roomInfoMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.查询所属公寓信息</span></span><br><span class="line">    <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> apartmentInfoMapper.selectById(roomInfo.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.查询graphInfoList</span></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.ROOM, id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.查询attrValueList</span></span><br><span class="line">    List&lt;AttrValueVo&gt; attrvalueVoList = attrValueMapper.selectListByRoomId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.查询facilityInfoList</span></span><br><span class="line">    List&lt;FacilityInfo&gt; facilityInfoList = facilityInfoMapper.selectListByRoomId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.查询labelInfoList</span></span><br><span class="line">    List&lt;LabelInfo&gt; labelInfoList = labelInfoMapper.selectListByRoomId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.查询paymentTypeList</span></span><br><span class="line">    List&lt;PaymentType&gt; paymentTypeList = paymentTypeMapper.selectListByRoomId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8.查询leaseTermList</span></span><br><span class="line">    List&lt;LeaseTerm&gt; leaseTermList = leaseTermMapper.selectListByRoomId(id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">adminRoomDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoomDetailVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(roomInfo, adminRoomDetailVo);</span><br><span class="line"></span><br><span class="line">    adminRoomDetailVo.setApartmentInfo(apartmentInfo);</span><br><span class="line">    adminRoomDetailVo.setGraphVoList(graphVoList);</span><br><span class="line">    adminRoomDetailVo.setAttrValueVoList(attrvalueVoList);</span><br><span class="line">    adminRoomDetailVo.setFacilityInfoList(facilityInfoList);</span><br><span class="line">    adminRoomDetailVo.setLabelInfoList(labelInfoList);</span><br><span class="line">    adminRoomDetailVo.setPaymentTypeList(paymentTypeList);</span><br><span class="line">    adminRoomDetailVo.setLeaseTermList(leaseTermList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> adminRoomDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>编写房间属性查询逻辑</p>
<ul>
<li><p>在<code>AttrValueMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AttrValueVo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>AttrValueMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByRoomId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.web.admin.vo.attr.AttrValueVo&quot;</span>&gt;</span><br><span class="line">    select v.id,</span><br><span class="line">           v.name,</span><br><span class="line">           v.attr_key_id,</span><br><span class="line">           k.name attr_key_name</span><br><span class="line">    from attr_value v</span><br><span class="line">             join attr_key k on v.attr_key_id = k.id</span><br><span class="line">    where v.is_deleted = <span class="number">0</span></span><br><span class="line">      and k.is_deleted = <span class="number">0</span></span><br><span class="line">      and v.id <span class="title function_">in</span> <span class="params">(select attr_value_id</span></span><br><span class="line"><span class="params">                   from room_attr_value</span></span><br><span class="line"><span class="params">                   where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">                     and room_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写房间配套查询逻辑</p>
<ul>
<li><p>在<code>FacilityInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FacilityInfo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FacilityInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByRoomId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.FacilityInfo&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name,</span><br><span class="line">           icon</span><br><span class="line">    from facility_info</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span></span><br><span class="line">          <span class="params">(select facility_id</span></span><br><span class="line"><span class="params">           from room_facility</span></span><br><span class="line"><span class="params">           where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">             and room_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写房间标签查询逻辑</p>
<ul>
<li><p>在<code>LabelInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LabelInfo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LabelInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByRoomId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name</span><br><span class="line">    from label_info</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span></span><br><span class="line">          <span class="params">(select label_id</span></span><br><span class="line"><span class="params">           from room_label</span></span><br><span class="line"><span class="params">           where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">             and room_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写房间可选支付方式查询逻辑</p>
<ul>
<li><p>在<code>PaymentTypeMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;PaymentType&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>PaymentTypeMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByRoomId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.PaymentType&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           name,</span><br><span class="line">           pay_month_count,</span><br><span class="line">           additional_info</span><br><span class="line">    from payment_type</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span></span><br><span class="line">          <span class="params">(select payment_type_id</span></span><br><span class="line"><span class="params">           from room_payment_type</span></span><br><span class="line"><span class="params">           where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">             and room_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt; </span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写房间可选租期查询逻辑</p>
<ul>
<li><p>在<code>Mapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LeaseTerm&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>Mapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectListByRoomId&quot;</span> resultType=<span class="string">&quot;com.atguigu.lease.model.entity.LeaseTerm&quot;</span>&gt;</span><br><span class="line">    select id,</span><br><span class="line">           month_count,</span><br><span class="line">           unit</span><br><span class="line">    from lease_term</span><br><span class="line">    <span class="type">where</span> <span class="variable">is_deleted</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      and id <span class="title function_">in</span> <span class="params">(select lease_term_id</span></span><br><span class="line"><span class="params">                 from room_lease_term</span></span><br><span class="line"><span class="params">                 where is_deleted = <span class="number">0</span></span></span><br><span class="line"><span class="params">                   and room_id = #&#123;id&#125;)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="4-根据ID删除房间信息"><a href="#4-根据ID删除房间信息" class="headerlink" title="4. 根据ID删除房间信息"></a>4. 根据ID删除房间信息</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除房间信息&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;removeById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    service.removeRoomById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service 层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">removeRoomById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeRoomById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//1.删除RoomInfo</span></span><br><span class="line">    <span class="built_in">super</span>.removeById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除graphInfoList</span></span><br><span class="line">    LambdaQueryWrapper&lt;GraphInfo&gt; graphQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemType, ItemType.ROOM);</span><br><span class="line">    graphQueryWrapper.eq(GraphInfo::getItemId, id);</span><br><span class="line">    graphInfoService.remove(graphQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.删除attrValueList</span></span><br><span class="line">    LambdaQueryWrapper&lt;RoomAttrValue&gt; attrQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    attrQueryWrapper.eq(RoomAttrValue::getRoomId, id);</span><br><span class="line">    roomAttrValueService.remove(attrQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除facilityInfoList</span></span><br><span class="line">    LambdaQueryWrapper&lt;RoomFacility&gt; facilityQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    facilityQueryWrapper.eq(RoomFacility::getRoomId, id);</span><br><span class="line">    roomFacilityService.remove(facilityQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.删除labelInfoList</span></span><br><span class="line">    LambdaQueryWrapper&lt;RoomLabel&gt; labelQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    labelQueryWrapper.eq(RoomLabel::getRoomId, id);</span><br><span class="line">    roomLabelService.remove(labelQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.删除paymentTypeList</span></span><br><span class="line">    LambdaQueryWrapper&lt;RoomPaymentType&gt; paymentQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    paymentQueryWrapper.eq(RoomPaymentType::getRoomId, id);</span><br><span class="line">    roomPaymentTypeService.remove(paymentQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.删除leaseTermList</span></span><br><span class="line">    LambdaQueryWrapper&lt;RoomLeaseTerm&gt; termQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    termQueryWrapper.eq(RoomLeaseTerm::getRoomId, id);</span><br><span class="line">    roomLeaseTermService.remove(termQueryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="5-根据id修改房间发布状态"><a href="#5-根据id修改房间发布状态" class="headerlink" title="5. 根据id修改房间发布状态"></a>5. 根据id修改房间发布状态</h5><p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id修改房间发布状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateReleaseStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateReleaseStatusById</span><span class="params">(Long id, ReleaseStatus status)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;RoomInfo&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(RoomInfo::getId, id);</span><br><span class="line">    updateWrapper.set(RoomInfo::getIsRelease, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-根据公寓ID查询房间列表"><a href="#6-根据公寓ID查询房间列表" class="headerlink" title="6. 根据公寓ID查询房间列表"></a>6. 根据公寓ID查询房间列表</h5><p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;listBasicByApartmentId&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据公寓id查询房间列表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;RoomInfo&gt;&gt; <span class="title function_">listBasicByApartmentId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;RoomInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(RoomInfo::getApartmentId, id);</span><br><span class="line">    queryWrapper.eq(RoomInfo::getIsRelease, ReleaseStatus.RELEASED);</span><br><span class="line">    List&lt;RoomInfo&gt; roomInfoList = service.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(roomInfoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-3-租赁管理"><a href="#7-2-3-租赁管理" class="headerlink" title="7.2.3 租赁管理"></a>7.2.3 租赁管理</h3><h4 id="7-2-3-1-看房预约管理"><a href="#7-2-3-1-看房预约管理" class="headerlink" title="7.2.3.1 看房预约管理"></a>7.2.3.1 看房预约管理</h4><p>看房预约管理共有两个接口，分别是<strong>根据条件分页查询预约信息</strong>、<strong>根据ID更新预约状态</strong>，下面逐一实现</p>
<p>首先在<code>ViewAppointmentController</code>中注入<code>ViewAppointmentService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;预约看房管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/appointment&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewAppointmentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ViewAppointmentService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-根据条件分页查询预约信息"><a href="#1-根据条件分页查询预约信息" class="headerlink" title="1. 根据条件分页查询预约信息"></a>1. 根据条件分页查询预约信息</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>AppointmentQueryVo</code>为看房预约的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;预约看房查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约公寓所在省份&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long provinceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约公寓所在城市&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long cityId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约公寓所在区&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long districtId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约公寓所在公寓&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long apartmentId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;预约用户手机号码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>响应数据结构</strong></p>
<p>单个看房预约信息的结构可查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.admin.vo.appointment.AppointmentVo</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;预约看房信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentVo</span> <span class="keyword">extends</span> <span class="title class_">ViewAppointment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;预约公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ViewAppointmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;分页查询预约信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;AppointmentVo&gt;&gt; <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, AppointmentQueryVo queryVo)</span> &#123;</span><br><span class="line">    IPage&lt;AppointmentVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;AppointmentVo&gt; list = service.pageAppointmentByQuery(page, queryVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ViewAppointmentService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;AppointmentVo&gt; <span class="title function_">pageAppointmentByQuery</span><span class="params">(IPage&lt;AppointmentVo&gt; page, AppointmentQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ViewAppointmentServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;AppointmentVo&gt; <span class="title function_">pageAppointmentByQuery</span><span class="params">(IPage&lt;AppointmentVo&gt; page, AppointmentQueryVo queryVo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> viewAppointmentMapper.pageAppointmentByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>ViewAppointmentMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;AppointmentVo&gt; <span class="title function_">pageAppointmentByQuery</span><span class="params">(IPage&lt;AppointmentVo&gt; page, AppointmentQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ViewAppointmentMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;AppointmentVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.admin.vo.appointment.AppointmentVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;apartmentInfo&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.ApartmentInfo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;apartment_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;apartment_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageAppointmentByQuery&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AppointmentVoMap&quot;</span>&gt;</span></span><br><span class="line">    select va.id,</span><br><span class="line">           va.user_id,</span><br><span class="line">           va.name,</span><br><span class="line">           va.phone,</span><br><span class="line">           va.appointment_time,</span><br><span class="line">           va.additional_info,</span><br><span class="line">           va.appointment_status,</span><br><span class="line">           ai.id   apartment_id,</span><br><span class="line">           ai.name apartment_name,</span><br><span class="line">           ai.district_id,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_id,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_id,</span><br><span class="line">           ai.province_name</span><br><span class="line">    from view_appointment va</span><br><span class="line">             left join</span><br><span class="line">         apartment_info ai</span><br><span class="line">         on va.apartment_id = ai.id and ai.is_deleted=0</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        va.is_deleted = 0</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.provinceId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.province_id = #&#123;queryVo.provinceId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.cityId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.city_id = #&#123;queryVo.cityId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.districtId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.district_id = #&#123;queryVo.districtId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.apartmentId != null&quot;</span>&gt;</span></span><br><span class="line">            and va.apartment_id = #&#123;queryVo.apartmentId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.name != null and queryVo.name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and va.name like concat(&#x27;%&#x27;,#&#123;queryVo.name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.phone != null and queryVo.phone != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and va.phone like concat(&#x27;%&#x27;,#&#123;queryVo.phone&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>  <strong>知识点</strong>：</p>
<p>  <code>ViewAppointment</code>实体类中的<code>appointmentTime</code>字段为<code>Date</code>类型，<code>Date</code>类型的字段在序列化成JSON字符串时，需要考虑两个点，分别是<strong>格式</strong>和<strong>时区</strong>。本项目使用JSON序列化框架为Jackson，具体配置如下</p>
<ul>
<li><p><strong>格式</strong></p>
<p>格式可按照字段单独配置，也可全局配置，下面分别介绍</p>
<ul>
<li><p><strong>单独配置</strong></p>
<p>在指定字段增加<code>@JsonFormat</code>注解，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date appointmentTime;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>全局配置</strong></p>
<p>在<code>application.yml</code>中增加如下内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>时区</strong></p>
<p>时区同样可按照字段单独配置，也可全局配置，下面分别介绍</p>
<ul>
<li><p><strong>单独配置</strong></p>
<p>在指定字段增加<code>@JsonFormat</code>注解，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(timezone = &quot;GMT+8&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date appointmentTime;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>全局配置</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>推荐格式按照字段单独配置，时区全局配置。</p>
</li>
</ul>
<h5 id="2-根据ID更新预约状态"><a href="#2-根据ID更新预约状态" class="headerlink" title="2. 根据ID更新预约状态"></a>2. 根据ID更新预约状态</h5><p>在<code>ViewAppointmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id更新预约状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusById</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> AppointmentStatus status)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaUpdateWrapper&lt;ViewAppointment&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(ViewAppointment::getId, id);</span><br><span class="line">    updateWrapper.set(ViewAppointment::getAppointmentStatus, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-3-2-租约管理"><a href="#7-2-3-2-租约管理" class="headerlink" title="7.2.3.2 租约管理"></a>7.2.3.2 租约管理</h4><p>租约管理共有五个接口需要实现，除此之外，还需实现一个定时任务，用于检查租约是否到期以及修改到期状态。下面逐一实现</p>
<p>首先在<code>LeaseAgreementController</code>中注入<code>LeaseAgreementService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;租约管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/agreement&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaseAgreementController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LeaseAgreementService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存获更新租约信息"><a href="#1-保存获更新租约信息" class="headerlink" title="1. 保存获更新租约信息"></a>1. 保存获更新租约信息</h5><p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或修改租约信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> LeaseAgreement leaseAgreement)</span> &#123;</span><br><span class="line">    service.saveOrUpdate(leaseAgreement);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-根据条件分页查询租约列表"><a href="#2-根据条件分页查询租约列表" class="headerlink" title="2. 根据条件分页查询租约列表"></a>2. 根据条件分页查询租约列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>AgreementQueryVo</code>为公寓的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">        <span class="meta">@Data</span></span><br><span class="line">        <span class="meta">@Schema(description = &quot;租约查询实体&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgreementQueryVo</span> &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;公寓所处省份id&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> Long provinceId;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;公寓所处城市id&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> Long cityId;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;公寓所处区域id&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> Long districtId;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;公寓id&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> Long apartmentId;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> String roomNumber;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;用户姓名&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> String name;</span><br><span class="line">        </span><br><span class="line">            <span class="meta">@Schema(description = &quot;用户手机号码&quot;)</span></span><br><span class="line">            <span class="keyword">private</span> String phone;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">  - **响应数据结构**</span><br><span class="line">  </span><br><span class="line">      单个租约信息的结构可查看`com.atguigu.lease.web.admin.vo.agreement.AgreementVo`，内容如下：</span><br><span class="line">  </span><br><span class="line">      ```java</span><br><span class="line">      <span class="meta">@Data</span></span><br><span class="line">      <span class="meta">@Schema(description = &quot;租约信息&quot;)</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgreementVo</span> <span class="keyword">extends</span> <span class="title class_">LeaseAgreement</span> &#123;</span><br><span class="line">      </span><br><span class="line">          <span class="meta">@Schema(description = &quot;签约公寓信息&quot;)</span></span><br><span class="line">          <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line">      </span><br><span class="line">          <span class="meta">@Schema(description = &quot;签约房间信息&quot;)</span></span><br><span class="line">          <span class="keyword">private</span> RoomInfo roomInfo;</span><br><span class="line">      </span><br><span class="line">          <span class="meta">@Schema(description = &quot;支付方式&quot;)</span></span><br><span class="line">          <span class="keyword">private</span> PaymentType paymentType;</span><br><span class="line">      </span><br><span class="line">          <span class="meta">@Schema(description = &quot;租期&quot;)</span></span><br><span class="line">          <span class="keyword">private</span> LeaseTerm leaseTerm;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">- **编写Controller层逻辑**</span><br><span class="line"></span><br><span class="line">  在`LeaseAgreementController`中增加如下内容</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  <span class="meta">@Operation(summary = &quot;根据条件分页查询租约列表&quot;)</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Result&lt;IPage&lt;AgreementVo&gt;&gt; <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, AgreementQueryVo queryVo)</span> &#123;</span><br><span class="line">      IPage&lt;AgreementVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">      IPage&lt;AgreementVo&gt; list = service.pageAgreementByQuery(page, queryVo);</span><br><span class="line">      <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;AgreementVo&gt; <span class="title function_">pageAgreementByQuery</span><span class="params">(IPage&lt;AgreementVo&gt; page, AgreementQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;AgreementVo&gt; <span class="title function_">pageAgreementByQuery</span><span class="params">(IPage&lt;AgreementVo&gt; page, AgreementQueryVo queryVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> leaseAgreementMapper.pageAgreementByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;AgreementVo&gt; <span class="title function_">pageAgreementByQuery</span><span class="params">(IPage&lt;AgreementVo&gt; page, AgreementQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=<span class="string">&quot;agreementVoMap&quot;</span> type=<span class="string">&quot;com.atguigu.lease.web.admin.vo.agreement.AgreementVo&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;apartmentInfo&quot;</span> javaType=<span class="string">&quot;com.atguigu.lease.model.entity.ApartmentInfo&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;apartment_id&quot;</span>/&gt;</span><br><span class="line">        &lt;result property=<span class="string">&quot;name&quot;</span> column=<span class="string">&quot;apartment_name&quot;</span>/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;roomInfo&quot;</span> javaType=<span class="string">&quot;com.atguigu.lease.model.entity.RoomInfo&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;room_id&quot;</span>/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;paymentType&quot;</span> javaType=<span class="string">&quot;com.atguigu.lease.model.entity.PaymentType&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;payment_type_id&quot;</span>/&gt;</span><br><span class="line">        &lt;result property=<span class="string">&quot;name&quot;</span> column=<span class="string">&quot;payment_type_name&quot;</span>/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;leaseTerm&quot;</span> javaType=<span class="string">&quot;com.atguigu.lease.model.entity.LeaseTerm&quot;</span> autoMapping=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;lease_term_id&quot;</span>/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;pageAgreementByQuery&quot;</span> resultMap=<span class="string">&quot;agreementVoMap&quot;</span>&gt;</span><br><span class="line">    select la.id,</span><br><span class="line">           la.phone,</span><br><span class="line">           la.name,</span><br><span class="line">           la.identification_number,</span><br><span class="line">           la.lease_start_date,</span><br><span class="line">           la.lease_end_date,</span><br><span class="line">           la.rent,</span><br><span class="line">           la.deposit,</span><br><span class="line">           la.status,</span><br><span class="line">           la.source_type,</span><br><span class="line">           la.additional_info,</span><br><span class="line">           ai.id   apartment_id,</span><br><span class="line">           ai.name apartment_name,</span><br><span class="line">           ai.district_id,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_id,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_id,</span><br><span class="line">           ai.province_name,</span><br><span class="line">           ri.id   room_id,</span><br><span class="line">           ri.room_number,</span><br><span class="line">           pt.id   payment_type_id,</span><br><span class="line">           pt.name payment_type_name,</span><br><span class="line">           pt.pay_month_count,</span><br><span class="line">           lt.id   lease_term_id,</span><br><span class="line">           lt.month_count,</span><br><span class="line">           lt.unit</span><br><span class="line">    from  lease_agreement la</span><br><span class="line">             left join</span><br><span class="line">          apartment_info ai</span><br><span class="line">         on la.apartment_id = ai.id and ai.is_deleted=<span class="number">0</span></span><br><span class="line">             left join</span><br><span class="line">          room_info ri</span><br><span class="line">         on la.room_id = ri.id and ri.is_deleted=<span class="number">0</span></span><br><span class="line">             left join</span><br><span class="line">          payment_type pt</span><br><span class="line">         on la.payment_type_id = pt.id and pt.is_deleted=<span class="number">0</span></span><br><span class="line">             left join</span><br><span class="line">          lease_term lt</span><br><span class="line">         on la.lease_term_id = lt.id and lt.is_deleted=<span class="number">0</span></span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            la.is_deleted = <span class="number">0</span></span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.provinceId != null&quot;</span>&gt;</span><br><span class="line">                and ai.province_id = #&#123;queryVo.provinceId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.cityId != null&quot;</span>&gt;</span><br><span class="line">                and ai.city_id = #&#123;queryVo.cityId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.districtId != null&quot;</span>&gt;</span><br><span class="line">                and ai.district_id = #&#123;queryVo.districtId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.apartmentId != null&quot;</span>&gt;</span><br><span class="line">                and la.apartment_id = #&#123;queryVo.apartmentId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.roomNumber != null and queryVo.roomNumber != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">                and ri.room_number like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;queryVo.roomNumber&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.name != null and queryVo.name != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">                and la.name like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;queryVo.name&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.phone != null and queryVo.phone != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">                and la.phone like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;queryVo.phone&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="3-根据ID查询租约信息"><a href="#3-根据ID查询租约信息" class="headerlink" title="3. 根据ID查询租约信息"></a>3. 根据ID查询租约信息</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id查询租约信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(name = &quot;getById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;AgreementVo&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">AgreementVo</span> <span class="variable">apartment</span> <span class="operator">=</span> service.getAgreementById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(apartment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AgreementVo <span class="title function_">getAgreementById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AgreementVo <span class="title function_">getAgreementById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.查询租约信息</span></span><br><span class="line">    <span class="type">LeaseAgreement</span> <span class="variable">leaseAgreement</span> <span class="operator">=</span> leaseAgreementMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.查询公寓信息</span></span><br><span class="line">    <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> apartmentInfoMapper.selectById(leaseAgreement.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.查询房间信息</span></span><br><span class="line">    <span class="type">RoomInfo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> roomInfoMapper.selectById(leaseAgreement.getRoomId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.查询支付方式</span></span><br><span class="line">    <span class="type">PaymentType</span> <span class="variable">paymentType</span> <span class="operator">=</span> paymentTypeMapper.selectById(leaseAgreement.getPaymentTypeId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.查询租期</span></span><br><span class="line">    <span class="type">LeaseTerm</span> <span class="variable">leaseTerm</span> <span class="operator">=</span> leaseTermMapper.selectById(leaseAgreement.getLeaseTermId());</span><br><span class="line"></span><br><span class="line">    <span class="type">AgreementVo</span> <span class="variable">adminAgreementVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AgreementVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(leaseAgreement, adminAgreementVo);</span><br><span class="line">    adminAgreementVo.setApartmentInfo(apartmentInfo);</span><br><span class="line">    adminAgreementVo.setRoomInfo(roomInfo);</span><br><span class="line">    adminAgreementVo.setPaymentType(paymentType);</span><br><span class="line">    adminAgreementVo.setLeaseTerm(leaseTerm);</span><br><span class="line">    <span class="keyword">return</span> adminAgreementVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="4-根据ID删除租约信息"><a href="#4-根据ID删除租约信息" class="headerlink" title="4. 根据ID删除租约信息"></a>4. 根据ID删除租约信息</h5><p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除租约信息&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;removeById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    service.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-根据ID更新租约状态"><a href="#5-根据ID更新租约状态" class="headerlink" title="5. 根据ID更新租约状态"></a>5. 根据ID更新租约状态</h5><p>后台管理系统需要多个修改租约状态的接口，例如<strong>修改租约状态为已取消</strong>、<strong>修改租约状态为已退租</strong>等等。为省去重复编码，此处将多个接口合并为一个如下，注意，在生产中应避免这样的写法。</p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id更新租约状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusById</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> LeaseStatus status)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;LeaseAgreement&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(LeaseAgreement::getId, id);</span><br><span class="line">    updateWrapper.set(LeaseAgreement::getStatus, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-定时检查租约状态"><a href="#6-定时检查租约状态" class="headerlink" title="6. 定时检查租约状态"></a>6. 定时检查租约状态</h5><p>本节内容是通过定时任务定时检查租约是否到期。SpringBoot内置了定时任务，具体实现如下。</p>
<ul>
<li><p>启用Spring Boot定时任务</p>
<p>在SpringBoot启动类上增加<code>@EnableScheduling</code>注解，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AdminWebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写定时逻辑</p>
<p>在<strong>web-admin模块</strong>下创建<code>com.atguigu.lease.web.admin.schedule.ScheduledTasks</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledTasks</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LeaseAgreementService leaseAgreementService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 0 * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkLeaseStatus</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        LambdaUpdateWrapper&lt;LeaseAgreement&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        updateWrapper.le(LeaseAgreement::getLeaseEndDate, now);</span><br><span class="line">        updateWrapper.eq(LeaseAgreement::getStatus, LeaseStatus.SIGNED);</span><br><span class="line">        updateWrapper.in(LeaseAgreement::getStatus, LeaseStatus.SIGNED, LeaseStatus.WITHDRAWING);</span><br><span class="line"></span><br><span class="line">        leaseAgreementService.update(updateWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>:</p>
<p>SpringBoot中的cron表达式语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌───────────── second (0-59)</span><br><span class="line">│ ┌───────────── minute (0 - 59)</span><br><span class="line">│ │ ┌───────────── hour (0 - 23)</span><br><span class="line">│ │ │ ┌───────────── day of the month (1 - 31)</span><br><span class="line">│ │ │ │ ┌───────────── month (1 - 12) (or JAN-DEC)</span><br><span class="line">│ │ │ │ │ ┌───────────── day of the week (0 - 7)</span><br><span class="line">│ │ │ │ │ │          (0 or 7 is Sunday, or MON-SUN)</span><br><span class="line">│ │ │ │ │ │</span><br><span class="line">* * * * * *</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7-2-4-用户管理"><a href="#7-2-4-用户管理" class="headerlink" title="7.2.4 用户管理"></a>7.2.4 用户管理</h3><p>用户管理共包含两个接口，分别是<strong>根据条件分页查询用户列表</strong>和<strong>根据ID更新用户状态</strong>，下面逐一实现</p>
<p>首先在<code>UserInfoController</code>中注入<code>UserInfoService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;用户信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-根据条件分页查询用户列表"><a href="#1-根据条件分页查询用户列表" class="headerlink" title="1. 根据条件分页查询用户列表"></a>1. 根据条件分页查询用户列表</h5><ul>
<li><p><strong>查看请求的数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>UserInfoQueryVo</code>为用户的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;用户信息查询实体&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户手机号码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户账号状态&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BaseStatus status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>UserInfoController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;分页查询用户信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;UserInfo&gt;&gt; <span class="title function_">pageUserInfo</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, UserInfoQueryVo queryVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;UserInfo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    LambdaQueryWrapper&lt;UserInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(queryVo.getPhone() != <span class="literal">null</span>, UserInfo::getPhone, queryVo.getPhone());</span><br><span class="line">    queryWrapper.eq(queryVo.getStatus() != <span class="literal">null</span>, UserInfo::getStatus, queryVo.getStatus());</span><br><span class="line">    IPage&lt;UserInfo&gt; list = service.page(page, queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p><code>password</code>字段属于敏感信息，因此在查询时应过滤掉，可在<code>UserInfo</code>实体的<code>password</code>字段的<code>@TableField</code>注解中增加一个参数<code>select=false</code>来实现。</p>
</li>
</ul>
<h5 id="2-根据ID更新用户状态"><a href="#2-根据ID更新用户状态" class="headerlink" title="2. 根据ID更新用户状态"></a>2. 根据ID更新用户状态</h5><p>在<code>UserInfoController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据用户id更新账号状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusById</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> BaseStatus status)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaUpdateWrapper&lt;UserInfo&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(UserInfo::getId, id);</span><br><span class="line">    updateWrapper.set(UserInfo::getStatus, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-5-系统管理"><a href="#7-2-5-系统管理" class="headerlink" title="7.2.5 系统管理"></a>7.2.5 系统管理</h3><h4 id="7-2-5-1-后台用户岗位管理"><a href="#7-2-5-1-后台用户岗位管理" class="headerlink" title="7.2.5.1 后台用户岗位管理"></a>7.2.5.1 后台用户岗位管理</h4><p>后台用户岗位管理共有六个接口，下面逐一实现</p>
<p>首先在<code>SystemPostController</code>中注入<code>SystemPostService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;后台用户岗位管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/system/post&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemPostController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemPostService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-分页查询岗位信息"><a href="#1-分页查询岗位信息" class="headerlink" title="1. 分页查询岗位信息"></a>1. 分页查询岗位信息</h5><p>在<code>SystemPostController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;分页获取岗位信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Result&lt;IPage&lt;SystemPost&gt;&gt; <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size)</span> &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SystemPost&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;SystemPost&gt; systemPostPage = service.page(page);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(systemPostPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-保存或更新岗位信息"><a href="#2-保存或更新岗位信息" class="headerlink" title="2. 保存或更新岗位信息"></a>2. 保存或更新岗位信息</h5><p>在<code>SystemPostController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新岗位信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> SystemPost systemPost)</span> &#123;</span><br><span class="line"></span><br><span class="line">    service.saveOrUpdate(systemPost);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-根据ID删除岗位信息"><a href="#3-根据ID删除岗位信息" class="headerlink" title="3. 根据ID删除岗位信息"></a>3. 根据ID删除岗位信息</h5><p>在<code>SystemPostController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据id删除岗位&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    service.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-获取全部岗位列表"><a href="#4-获取全部岗位列表" class="headerlink" title="4. 获取全部岗位列表"></a>4. 获取全部岗位列表</h5><p>在<code>SystemPostController</code>增加入下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取全部岗位列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;SystemPost&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;SystemPost&gt; list = service.list();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-根据ID获取岗位信息"><a href="#5-根据ID获取岗位信息" class="headerlink" title="5. 根据ID获取岗位信息"></a>5. 根据ID获取岗位信息</h5><p>在<code>SystemPostController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;getById&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据id获取岗位信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemPost&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">SystemPost</span> <span class="variable">systemPost</span> <span class="operator">=</span> service.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(systemPost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-根据ID修改岗位状态"><a href="#6-根据ID修改岗位状态" class="headerlink" title="6. 根据ID修改岗位状态"></a>6. 根据ID修改岗位状态</h5><p>在<code>SystemPostController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据岗位id修改状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusByPostId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusByPostId</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> BaseStatus status)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;SystemPost&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(SystemPost::getId, id);</span><br><span class="line">    updateWrapper.set(SystemPost::getStatus, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-5-2-后台用户信息管理"><a href="#7-2-5-2-后台用户信息管理" class="headerlink" title="7.2.5.2 后台用户信息管理"></a>7.2.5.2 后台用户信息管理</h4><p>后台用户信息管理共有六个接口，下面逐一实现</p>
<p>首先在<code>SystemUserController</code>中注入<code>SystemUserService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;后台用户信息管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/system/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemUserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SystemUserService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-根据条件分页查询后台用户列表"><a href="#1-根据条件分页查询后台用户列表" class="headerlink" title="1. 根据条件分页查询后台用户列表"></a>1. 根据条件分页查询后台用户列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求的数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>SystemUserQueryVo</code>为房间的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;员工查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemUserQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description= &quot;员工姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description= &quot;手机号码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>响应的数据结构</strong></p>
<p>单个系统用户信息的结构可查看<strong>web-admin</strong>模块下的<code>com.atguigu.lease.web.admin.vo.system.user.SystemUserItemVo</code>，具体内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;后台管理系统用户基本信息实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemUserItemVo</span> <span class="keyword">extends</span> <span class="title class_">SystemUser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;岗位名称&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;post_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String postName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据条件分页查询后台用户列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;SystemUserItemVo&gt;&gt; <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, SystemUserQueryVo queryVo)</span> &#123;</span><br><span class="line">    IPage&lt;SystemUser&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;SystemUserItemVo&gt; systemUserPage = service.pageSystemUserByQuery(page, queryVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(systemUserPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>SystemUserService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;SystemUserItemVo&gt; <span class="title function_">pageSystemUserByQuery</span><span class="params">(IPage&lt;SystemUser&gt; page, SystemUserQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>SystemUserServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;SystemUserItemVo&gt; <span class="title function_">pageSystemUserByQuery</span><span class="params">(IPage&lt;SystemUser&gt; page, SystemUserQueryVo queryVo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> systemUserMapper.pageSystemUserByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>SystemUserMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;SystemUserItemVo&gt; <span class="title function_">pageSystemUserByQuery</span><span class="params">(IPage&lt;SystemUser&gt; page, SystemUserQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>SystemUserMapper.xml</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;pageSystemUserByQuery&quot;</span></span><br><span class="line">        resultType=<span class="string">&quot;com.atguigu.lease.web.admin.vo.system.user.SystemUserItemVo&quot;</span>&gt;</span><br><span class="line">    select su.id,</span><br><span class="line">           username,</span><br><span class="line">           su.name,</span><br><span class="line">           type,</span><br><span class="line">           phone,</span><br><span class="line">           avatar_url,</span><br><span class="line">           additional_info,</span><br><span class="line">           post_id,</span><br><span class="line">		   su.status,</span><br><span class="line">           sp.name post_name</span><br><span class="line">    from system_user su</span><br><span class="line">             left join system_post sp on su.post_id = sp.id and sp.is_deleted = <span class="number">0</span></span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        su.is_deleted = <span class="number">0</span></span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.name != null and queryVo.name != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            and su.name like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;queryVo.name&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryVo.phone !=null and queryVo.phone != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            and su.phone like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;queryVo.phone&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong></p>
<p><code>password</code>字段不要查询。</p>
</li>
</ul>
</li>
</ul>
<h5 id="2-根据ID查询后台用户信息"><a href="#2-根据ID查询后台用户信息" class="headerlink" title="2. 根据ID查询后台用户信息"></a>2. 根据ID查询后台用户信息</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据ID查询后台用户信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemUserItemVo&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">SystemUserItemVo</span> <span class="variable">systemUser</span> <span class="operator">=</span> service.getSystemUserById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(systemUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>SystemUserServcie</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SystemUserItemVo <span class="title function_">getSystemUserById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>SystemUserServcieImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SystemUserItemVo <span class="title function_">getSystemUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">SystemUser</span> <span class="variable">systemUser</span> <span class="operator">=</span> systemUserMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">SystemPost</span> <span class="variable">systemPost</span> <span class="operator">=</span> systemPostMapper.selectById(systemUser.getPostId());</span><br><span class="line"></span><br><span class="line">    <span class="type">SystemUserItemVo</span> <span class="variable">systemUserItemVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemUserItemVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(systemPost, systemUserItemVo);</span><br><span class="line">    systemUserItemVo.setPostName(systemUserItemVo.getPostName());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> systemUserItemVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong></p>
<p><code>system_user</code>表中的<code>password</code>字段不应查询，需要在<code>SystemUser</code>的<code>password</code>字段的<code>@TableField</code>注解中增加<code>select=false</code>参数。</p>
</li>
</ul>
</li>
</ul>
<h5 id="3-保存或更新后台用户信息"><a href="#3-保存或更新后台用户信息" class="headerlink" title="3. 保存或更新后台用户信息"></a>3. 保存或更新后台用户信息</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新后台用户信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> SystemUser systemUser)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(systemUser.getPassword() != <span class="literal">null</span>)&#123;</span><br><span class="line">        systemUser.setPassword(DigestUtils.md5Hex(systemUser.getPassword()));</span><br><span class="line">    &#125;</span><br><span class="line">    service.saveOrUpdate(systemUser);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<ul>
<li><p><strong>密码处理</strong></p>
<p>用户的密码通常不会直接以明文的形式保存到数据库中，而是会先经过处理，然后将处理之后得到的”密文”保存到数据库，这样能够降低数据库泄漏导致的用户账号安全问题。</p>
<p>密码通常会使用一些单向函数进行处理，如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019796.png" style="zoom: 50%;" /></p>
<p>常用于处理密码的单向函数（算法）有MD5、SHA-256等，<strong>Apache Commons</strong>提供了一个工具类<code>DigestUtils</code>，其中就包含上述算法的实现。</p>
<blockquote>
<p><strong>Apache Commons</strong>是Apache软件基金会下的一个项目，其致力于提供可重用的开源软件，其中包含了很多易于使用的现成工具。</p>
</blockquote>
<p>使用该工具类需引入<code>commons-codec</code>依赖，在<strong>common模块</strong>的pom.xml中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Mybatis-Plus update strategy</strong></p>
<p>使用Mybatis-Plus提供的更新方法时，若实体中的字段为<code>null</code>，默认情况下，最终生成的update语句中，不会包含该字段。若想改变默认行为，可做以下配置。</p>
<ul>
<li><p>全局配置</p>
<p>在<code>application.yml</code>中配置如下参数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      update-strategy: <span class="tag">&lt;<span class="name">strategy</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注</strong>：上述<code>&lt;strategy&gt;</code>可选值有：<code>ignore</code>、<code>not_null</code>、<code>not_empty</code>、<code>never</code>，默认值为<code>not_null</code></p>
<ul>
<li><p><code>ignore</code>：忽略空值判断，不管字段是否为空，都会进行更新</p>
</li>
<li><p><code>not_null</code>：进行非空判断，字段非空才会进行判断</p>
</li>
<li><p><code>not_empty</code>：进行非空判断，并进行非空串（””）判断，主要针对字符串类型</p>
</li>
<li><p><code>never</code>：从不进行更新，不管该字段为何值，都不更新</p>
</li>
</ul>
</li>
<li><p>局部配置</p>
<p>在实体类中的具体字段通过<code>@TableField</code>注解进行配置，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;密码&quot;)</span></span><br><span class="line"><span class="meta">@TableField(value = &quot;password&quot;, updateStrategy = FieldStrategy.NOT_EMPTY)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="4-判断后台用户名是否可用"><a href="#4-判断后台用户名是否可用" class="headerlink" title="4. 判断后台用户名是否可用"></a>4. 判断后台用户名是否可用</h5><p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;判断后台用户名是否可用&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;isUserNameAvailable&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Boolean&gt; <span class="title function_">isUsernameExists</span><span class="params">(<span class="meta">@RequestParam</span> String username)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;SystemUser&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SystemUser::getUsername, username);</span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> service.count(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(count == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-根据ID删除后台用户信息"><a href="#5-根据ID删除后台用户信息" class="headerlink" title="5. 根据ID删除后台用户信息"></a>5. 根据ID删除后台用户信息</h5><p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;deleteById&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据ID删除后台用户信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    service.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-根据ID修改后台用户状态"><a href="#6-根据ID修改后台用户状态" class="headerlink" title="6. 根据ID修改后台用户状态"></a>6. 根据ID修改后台用户状态</h5><p>在<code>SystemUserController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据ID修改后台用户状态&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusByUserId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusByUserId</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> BaseStatus status)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;SystemUser&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(SystemUser::getId, id);</span><br><span class="line">    updateWrapper.set(SystemUser::getStatus, status);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-6-登录管理"><a href="#7-2-6-登录管理" class="headerlink" title="7.2.6 登录管理"></a>7.2.6 登录管理</h3><h4 id="7-2-6-1-背景知识"><a href="#7-2-6-1-背景知识" class="headerlink" title="7.2.6.1 背景知识"></a>7.2.6.1 背景知识</h4><p><strong>1. 认证方案概述</strong></p>
<p>有两种常见的认证方案，分别是基于<strong>Session</strong>的认证和基于<strong>Token</strong>的认证，下面逐一进行介绍</p>
<ul>
<li><p><strong>基于Session</strong></p>
<p>基于Session的认证流程如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019797.png" style="zoom:50%;" /></p>
<p>该方案的特点</p>
<ul>
<li>登录用户信息保存在服务端内存中，若访问量增加，单台节点压力会较大</li>
<li>随用户规模增大，若后台升级为集群，则需要解决集群中各服务器登录状态共享的问题。</li>
</ul>
</li>
<li><p><strong>基于Token</strong></p>
<p>基于Token的认证流程如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019798.png" style="zoom:50%;" /></p>
<p>该方案的特点</p>
<ul>
<li>登录状态保存在客户端，服务器没有存储开销</li>
<li>客户端发起的每个请求自身均携带登录状态，所以即使后台为集群，也不会面临登录状态共享的问题。</li>
</ul>
</li>
</ul>
<p><strong>2. Token详解</strong></p>
<p>本项目采用基于Token的登录方案，下面详细介绍Token这一概念。</p>
<p>我们所说的Token，通常指<strong>JWT</strong>（JSON Web TOKEN）。JWT是一种轻量级的安全传输方式，用于在两个实体之间传递信息，通常用于身份验证和信息传递。</p>
<p>JWT是一个字符串，如下图所示，该字符串由三部分组成，三部分由<code>.</code>分隔。三个部分分别被称为</p>
<ul>
<li><code>header</code>（头部）</li>
<li><code>payload</code>（负载）</li>
<li><code>signature</code>（签名）</li>
</ul>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019799.png" style="zoom: 80%;" /></p>
<p>各部分的作用如下</p>
<ul>
<li><p><strong>Header（头部）</strong></p>
<p>Header部分是由一个JSON对象经过<code>base64url</code>编码得到的，这个JSON对象用于保存JWT 的类型（<code>typ</code>）、签名算法（<code>alg</code>）等元信息，例如</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Payload（负载）</strong></p>
<p>也称为 Claims（声明），也是由一个JSON对象经过<code>base64url</code>编码得到的，用于保存要传递的具体信息。JWT规范定义了7个官方字段，如下：</p>
<ul>
<li>iss (issuer)：签发人</li>
<li>exp (expiration time)：过期时间</li>
<li>sub (subject)：主题</li>
<li>aud (audience)：受众</li>
<li>nbf (Not Before)：生效时间</li>
<li>iat (Issued At)：签发时间</li>
<li>jti (JWT ID)：编号</li>
</ul>
<p>除此之外，我们还可以自定义任何字段，例如</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1516239022</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Signature（签名）</strong></p>
<p>由头部、负载和秘钥一起经过（header中指定的签名算法）计算得到的一个字符串，用于防止消息被篡改。</p>
</li>
</ul>
<h4 id="7-2-6-2-登录流程"><a href="#7-2-6-2-登录流程" class="headerlink" title="7.2.6.2 登录流程"></a>7.2.6.2 登录流程</h4><p>后台管理系统的登录流程如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019800.svg" style="zoom:50%;" /></p>
<p>根据上述登录流程，可分析出，登录管理共需三个接口，分别是<strong>获取图形验证码</strong>、<strong>登录</strong>、<strong>获取登录用户个人信息</strong>，除此之外，我们还需为所有受保护的接口增加验证JWT合法性的逻辑，这一功能可通过<code>HandlerInterceptor</code>来实现。</p>
<h4 id="7-2-6-3-接口开发"><a href="#7-2-6-3-接口开发" class="headerlink" title="7.2.6.3 接口开发"></a>7.2.6.3 接口开发</h4><p>首先在<code>LoginController</code>中注入<code>LoginService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;后台管理系统登录管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-获取图形验证码"><a href="#1-获取图形验证码" class="headerlink" title="1. 获取图形验证码"></a>1. 获取图形验证码</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.admin.vo.login.CaptchaVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;图像验证码&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;验证码图片信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;验证码key&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置所需依赖</strong></p>
<ul>
<li><p><strong>验证码生成工具</strong></p>
<p>本项目使用开源的验证码生成工具<strong>EasyCaptcha</strong>，其支持多种类型的验证码，例如gif、中文、算术等，并且简单易用，具体内容可参考其<a target="_blank" rel="noopener" href="https://gitee.com/ele-admin/EasyCaptcha">官方文档</a>。</p>
<p>在<strong>common模块</strong>的pom.xml文件中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.whvcse<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-captcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Redis</strong></p>
<p>在<strong>common模块</strong>的pom.xml中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>application.yml</code>中增加如下配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">&lt;hostname&gt;</span></span><br><span class="line">      <span class="attr">port:</span> <span class="string">&lt;port&gt;</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：上述<code>hostname</code>和<code>port</code>需根据实际情况进行修改</p>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取图形验证码&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;login/captcha&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;CaptchaVo&gt; <span class="title function_">getCaptcha</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">CaptchaVo</span> <span class="variable">captcha</span> <span class="operator">=</span> service.getCaptcha();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(captcha);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LoginService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CaptchaVo <span class="title function_">getCaptcha</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> CaptchaVo <span class="title function_">getCaptcha</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SpecCaptcha</span> <span class="variable">specCaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpecCaptcha</span>(<span class="number">130</span>, <span class="number">48</span>, <span class="number">4</span>);</span><br><span class="line">    specCaptcha.setCharType(Captcha.TYPE_DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> specCaptcha.text().toLowerCase();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.ADMIN_LOGIN_PREFIX + UUID.randomUUID();</span><br><span class="line">    <span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> specCaptcha.toBase64();</span><br><span class="line">    redisTemplate.opsForValue().set(key, code, RedisConstant.ADMIN_LOGIN_CAPTCHA_TTL_SEC, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CaptchaVo</span>(image, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <strong>知识点</strong>：</p>
<ul>
<li><p>本项目Reids中的key需遵循以下命名规范：<strong>项目名:功能模块名:其他</strong>，例如<code>admin:login:123456</code></p>
</li>
<li><p><code>spring-boot-starter-data-redis</code>已经完成了<code>StringRedisTemplate</code>的自动配置，我们直接注入即可。</p>
</li>
<li><p>为方便管理，可以将Reids相关的一些值定义为常量，例如key的前缀、TTL时长，内容如下。大家可将这些常量统一定义在<strong>common模块</strong>下的<code>com.atguigu.lease.common.constant.RedisConstant</code>类中</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADMIN_LOGIN_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;admin:login:&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">ADMIN_LOGIN_CAPTCHA_TTL_SEC</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_LOGIN_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;app:login:&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">APP_LOGIN_CODE_RESEND_TIME_SEC</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">APP_LOGIN_CODE_TTL_SEC</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_ROOM_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;app:room:&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-登录接口"><a href="#2-登录接口" class="headerlink" title="2. 登录接口"></a>2. 登录接口</h5><ul>
<li><p><strong>登录校验逻辑</strong></p>
<p>用户登录的校验逻辑分为三个主要步骤，分别是<strong>校验验证码</strong>，<strong>校验用户状态</strong>和<strong>校验密码</strong>，具体逻辑如下</p>
<ul>
<li>前端发送<code>username</code>、<code>password</code>、<code>captchaKey</code>、<code>captchaCode</code>请求登录。</li>
<li>判断<code>captchaCode</code>是否为空，若为空，则直接响应<code>验证码为空</code>；若不为空进行下一步判断。</li>
<li>根据<code>captchaKey</code>从Redis中查询之前保存的<code>code</code>，若查询出来的<code>code</code>为空，则直接响应<code>验证码已过期</code>；若不为空进行下一步判断。</li>
<li>比较<code>captchaCode</code>和<code>code</code>，若不相同，则直接响应<code>验证码不正确</code>；若相同则进行下一步判断。</li>
<li>根据<code>username</code>查询数据库，若查询结果为空，则直接响应<code>账号不存在</code>；若不为空则进行下一步判断。</li>
<li>查看用户状态，判断是否被禁用，若禁用，则直接响应<code>账号被禁</code>；若未被禁用，则进行下一步判断。</li>
<li>比对<code>password</code>和数据库中查询的密码，若不一致，则直接响应<code>账号或密码错误</code>，若一致则进行入最后一步。</li>
<li>创建JWT，并响应给浏览器。</li>
</ul>
</li>
<li><p><strong>接口逻辑实现</strong></p>
<ul>
<li><p><strong>查看请求数据结构</strong></p>
<p>查看<strong>web-admin</strong>模块下的<code>com.atguigu.lease.web.admin.vo.login.LoginVo</code>，具体内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;后台管理系统登录信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;验证码key&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String captchaKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description=&quot;验证码code&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String captchaCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置所需依赖</strong></p>
<p>登录接口需要为登录成功的用户创建并返回JWT，本项目使用开源的JWT工具<strong>Java-JWT</strong>，配置如下，具体内容可参考<a target="_blank" rel="noopener" href="https://github.com/jwtk/jjwt/tree/0.11.2">官方文档</a>。</p>
<ul>
<li><p><strong>引入Maven依赖</strong></p>
<p>在<strong>common模块</strong>的pom.xml文件中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建JWT工具类</strong></p>
<p>在<strong>common模块</strong>下创建<code>com.atguigu.lease.common.utils.JwtUtil</code>工具类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="variable">tokenExpiration</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SecretKey</span> <span class="variable">tokenSignKey</span> <span class="operator">=</span> Keys.hmacShaKeyFor(<span class="string">&quot;M0PKKI6pYGVWWfDZw90a0lTpGYX1d4AQ&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(Long userId, String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder().</span><br><span class="line">                setSubject(<span class="string">&quot;USER_INFO&quot;</span>).</span><br><span class="line">                setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + tokenExpiration)).</span><br><span class="line">                claim(<span class="string">&quot;userId&quot;</span>, userId).</span><br><span class="line">                claim(<span class="string">&quot;username&quot;</span>, username).</span><br><span class="line">                signWith(tokenSignKey).</span><br><span class="line">                compact();</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;登录&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> service.login(loginVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LoginService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span> &#123;</span><br><span class="line">    <span class="comment">//1.判断是否输入了验证码</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(loginVo.getCaptchaCode())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_CAPTCHA_CODE_NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.校验验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> redisTemplate.opsForValue().get(loginVo.getCaptchaKey());</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_CAPTCHA_CODE_EXPIRED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!code.equals(loginVo.getCaptchaCode().toLowerCase())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_CAPTCHA_CODE_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.校验用户是否存在</span></span><br><span class="line">    <span class="type">SystemUser</span> <span class="variable">systemUser</span> <span class="operator">=</span> systemUserMapper.selectOneByUsername(loginVo.getUsername());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (systemUser == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_ACCOUNT_NOT_EXIST_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.校验用户是否被禁</span></span><br><span class="line">    <span class="keyword">if</span> (systemUser.getStatus() == BaseStatus.DISABLE) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_ACCOUNT_DISABLED_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.校验用户密码</span></span><br><span class="line">    <span class="keyword">if</span> (!systemUser.getPassword().equals(DigestUtils.md5Hex(loginVo.getPassword()))) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_ACCOUNT_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.创建并返回TOKEN</span></span><br><span class="line">    <span class="keyword">return</span> JwtUtil.createToken(systemUser.getId(), systemUser.getUsername());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>LoginMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SystemUser <span class="title function_">selectOneByUsername</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginMapper.xml</code>中增加如下内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectOneByUsername&quot; resultType<span class="operator">=</span>&quot;com.atguigu.lease.model.entity.SystemUser&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">select</span> id,</span><br><span class="line">           username,</span><br><span class="line">           password,</span><br><span class="line">           name,</span><br><span class="line">           type,</span><br><span class="line">           phone,</span><br><span class="line">           avatar_url,</span><br><span class="line">           additional_info,</span><br><span class="line">           post_id,</span><br><span class="line">           status</span><br><span class="line">    <span class="keyword">from</span> <span class="built_in">system_user</span></span><br><span class="line">    <span class="keyword">where</span> is_deleted <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">      <span class="keyword">and</span> username <span class="operator">=</span> #&#123;username&#125;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写HandlerInterceptor</strong></p>
<p>我们需要为所有受保护的接口增加校验JWT合法性的逻辑。具体实现如下</p>
<ul>
<li><p>在<code>JwtUtil</code>中增加<code>parseToken</code>方法，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseToken</span><span class="params">(String token)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_LOGIN_AUTH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">JwtParser</span> <span class="variable">jwtParser</span> <span class="operator">=</span> Jwts.parserBuilder().setSigningKey(secretKey).build();</span><br><span class="line">        <span class="keyword">return</span> jwtParser.parseClaimsJws(token).getBody();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (ExpiredJwtException e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.TOKEN_EXPIRED);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (JwtException e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.TOKEN_INVALID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写HandlerInterceptor</strong></p>
<p>在<strong>web-admin模块</strong>中创建<code>com.atguigu.lease.web.admin.custom.interceptor.AuthenticationInterceptor</code>类，内容如下，有关<code>HanderInterceptor</code>的相关内容，可参考<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-servlet/handlermapping-interceptor.html">官方文档</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;access-token&quot;</span>);</span><br><span class="line">        JwtUtil.parseToken(token);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>我们约定，前端登录后，后续请求都将JWT，放置于HTTP请求的Header中，其Header的key为<code>access-token</code>。</p>
</li>
<li><p><strong>注册HandlerInterceptor</strong></p>
<p>在<strong>web-admin模块</strong>的<code>com.atguigu.lease.web.admin.custom.config.WebMvcConfiguration</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AuthenticationInterceptor authenticationInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(<span class="built_in">this</span>.authenticationInterceptor).addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/admin/login/**&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>Knife4j配置</strong></p>
<p>在增加上述拦截器后，为方便继续调试其他接口，可以获取一个长期有效的Token，将其配置到Knife4j的全局参数中，如下图所示。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019801.png" alt=""></p>
<p><strong>注意：</strong>每个接口分组需要单独配置</p>
<p>刷新页面，任选一个接口进行调试，会发现发送请求时会自动携带该header，如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019802.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h5 id="3-获取登录用户个人信息"><a href="#3-获取登录用户个人信息" class="headerlink" title="3. 获取登录用户个人信息"></a>3. 获取登录用户个人信息</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>响应的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.admin.vo.system.user.SystemUserInfoVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;员工基本信息&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemUserInfoVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>请求的数据结构</strong></p>
<p>按理说，前端若想获取当前登录用户的个人信息，需要传递当前用户的<code>id</code>到后端进行查询。但是由于请求中携带的JWT中就包含了当前登录用户的<code>id</code>，故请求个人信息时，就无需再传递<code>id</code>。</p>
</li>
</ul>
</li>
<li><p><strong>修改<code>JwtUtil</code>中的<code>parseToken</code>方法</strong></p>
<p>由于需要从Jwt中获取用户<code>id</code>，因此需要为<code>parseToken</code> 方法增加返回值，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseToken</span><span class="params">(String token)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.ADMIN_LOGIN_AUTH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">JwtParser</span> <span class="variable">jwtParser</span> <span class="operator">=</span> Jwts.parserBuilder().setSigningKey(secretKey).build();</span><br><span class="line">        <span class="keyword">return</span> jwtParser.parseClaimsJws(token).getBody();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (ExpiredJwtException e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.TOKEN_EXPIRED);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (JwtException e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.TOKEN_INVALID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写ThreadLocal工具类</strong></p>
<p>理论上我们可以在Controller方法中，使用<code>@RequestHeader</code>获取JWT，然后在进行解析，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取登陆用户个人信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemUserInfoVo&gt; <span class="title function_">info</span><span class="params">(<span class="meta">@RequestHeader(&quot;access-token&quot;)</span> String token)</span> &#123;</span><br><span class="line">    <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseToken(token);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> claims.get(<span class="string">&quot;userId&quot;</span>, Long.class);</span><br><span class="line">    <span class="type">SystemUserInfoVo</span> <span class="variable">userInfo</span> <span class="operator">=</span> service.getLoginUserInfo(userId);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码的逻辑没有任何问题，但是这样做，JWT会被重复解析两次（一次在拦截器中，一次在该方法中）。为避免重复解析，通常会在拦截器将Token解析完毕后，将结果保存至<strong>ThreadLocal</strong>中，这样一来，我们便可以在整个请求的处理流程中进行访问了。</p>
<blockquote>
<p><strong>ThreadLocal概述</strong></p>
<p>ThreadLocal的主要作用是为每个使用它的线程提供一个独立的变量副本，使每个线程都可以操作自己的变量，而不会互相干扰，其用法如下图所示。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019803.png" style="zoom: 33%;" /></p>
</blockquote>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.login.LoginUserHolder</code>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;LoginUser&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setLoginUser</span><span class="params">(LoginUser loginUser)</span> &#123;</span><br><span class="line">        threadLocal.set(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.login.LoginUser</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改<code>AuthenticationInterceptor</code>拦截器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;access-token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseToken(token);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> claims.get(<span class="string">&quot;userId&quot;</span>, Long.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> claims.get(<span class="string">&quot;username&quot;</span>, String.class);</span><br><span class="line">        LoginUserHolder.setLoginUser(<span class="keyword">new</span> <span class="title class_">LoginUser</span>(userId, username));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        LoginUserHolder.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取登陆用户个人信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemUserInfoVo&gt; <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SystemUserInfoVo</span> <span class="variable">userInfo</span> <span class="operator">=</span> service.getLoginUserInfo(LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>  在<code>LoginService</code>中增加如下内容</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> SystemUserInfoVo <span class="title function_">getLoginUserInfo</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">	    <span class="type">SystemUser</span> <span class="variable">systemUser</span> <span class="operator">=</span> systemUserMapper.selectById(userId);</span><br><span class="line">	    <span class="type">SystemUserInfoVo</span> <span class="variable">systemUserInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemUserInfoVo</span>();</span><br><span class="line">	    systemUserInfoVo.setName(systemUser.getName());</span><br><span class="line">	    systemUserInfoVo.setAvatarUrl(systemUser.getAvatarUrl());</span><br><span class="line">	    <span class="keyword">return</span> systemUserInfoVo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">## <span class="number">7.3</span> 后台管理系统前后端联调</span><br><span class="line"></span><br><span class="line">### <span class="number">7.3</span><span class="number">.1</span> 启动后端项目</span><br><span class="line"></span><br><span class="line">启动后端项目，供前端调用接口。</span><br><span class="line"></span><br><span class="line">### <span class="number">7.3</span><span class="number">.2</span> 启动前端项目</span><br><span class="line"></span><br><span class="line">#### <span class="number">7.3</span><span class="number">.2</span><span class="number">.1</span> 安装Node和npm</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> **部署Node和npm**</span><br><span class="line"></span><br><span class="line">   Node和npm的部署比较简单，拿到安装包后按照安装向导操作即可。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> **配置npm国内镜像**</span><br><span class="line"></span><br><span class="line">   为加速npm下载依赖，可以为npm配置国内镜像，在终端执行以下命令为npm配置阿里云镜像。</span><br><span class="line"></span><br><span class="line">   ```bash</span><br><span class="line">   npm config set registry https:<span class="comment">//registry.npmmirror.com</span></span><br></pre></td></tr></table></figure>
<p> 若想取消上述配置，可在终端执行以下命令删除镜像，删除后将恢复默认配置。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config delete registry</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="7-3-2-2-启动前端项目"><a href="#7-3-2-2-启动前端项目" class="headerlink" title="7.3.2.2 启动前端项目"></a>7.3.2.2 启动前端项目</h4><ol>
<li><p><strong>导入前端项目</strong></p>
<p>将后台管理系统的前端项目（<strong>rentHouseAdmin</strong>）导入<code>vscode</code>或者<code>WebStorm</code>，打开终端，在项目根目录执行以下命令，安装所需依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置后端接口地址</strong></p>
<p>修改项目根目录下的<code>.env.development</code>文件中的<code>VITE_APP_BASE_URL</code>变量的值为后端接口的地址，此处改为<code>http://localhost:8080</code>即可,如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://localhost:8080&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>上述主机名和端口号需要根据实际情况进行修改。</p>
</li>
<li><p><strong>启动前端项目</strong></p>
<p>上述配置完成之后，便可执行以下命令启动前端项目了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问前端项目</strong></p>
<p>在浏览器中访问前端项目，并逐个测试每个页面的相关功能。</p>
</li>
</ol>
<h2 id="7-4-移动端后端开发"><a href="#7-4-移动端后端开发" class="headerlink" title="7.4 移动端后端开发"></a>7.4 移动端后端开发</h2><h3 id="7-4-1-项目初始配置"><a href="#7-4-1-项目初始配置" class="headerlink" title="7.4.1 项目初始配置"></a>7.4.1 项目初始配置</h3><h4 id="7-4-1-1-SpringBoot配置"><a href="#7-4-1-1-SpringBoot配置" class="headerlink" title="7.4.1.1 SpringBoot配置"></a>7.4.1.1 SpringBoot配置</h4><p><strong>1. 创建application.yml文件</strong></p>
<p>在<strong>web-app模块</strong>的<code>src/main/resources</code>目录下创建<code>application.yml</code>配置文件，内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 创建SpringBoot启动类</strong></p>
<p>在<strong>web-app模块</strong>下创建<code>com.atguigu.lease.AppWebApplication</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AppWebApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-4-1-2-Mybatis-Plus配置"><a href="#7-4-1-2-Mybatis-Plus配置" class="headerlink" title="7.4.1.2 Mybatis-Plus配置"></a>7.4.1.2 Mybatis-Plus配置</h4><p>在web-admin模块的application.yml文件增加如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=GMT%2b8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&lt;username&gt;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&lt;password&gt;</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="comment"># 自动检测连接</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span> <span class="comment">#数据库连接超时时间,默认30秒</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span> <span class="comment">#空闲连接存活最大时间，默认600000（10分钟）</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span> <span class="comment">#此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span> <span class="comment">#连接池最大连接数，默认是10</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span> <span class="comment">#最小空闲连接数量</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">SPHHikariPool</span> <span class="comment"># 连接池名称</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">      <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用于打印框架生成的sql语句，便于调试</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：需根据实际情况修改<code>hostname</code>、<code>port</code>、<code>database</code>、<code>username</code>、<code>password</code>。</p>
<h4 id="7-4-1-3-Knife4j配置"><a href="#7-4-1-3-Knife4j配置" class="headerlink" title="7.4.1.3 Knife4j配置"></a>7.4.1.3 Knife4j配置</h4><p><strong>1. 配置类</strong></p>
<p>在<strong>web-app模块</strong>下创建<code>com.atguigu.lease.web.app.custom.config.Knife4jConfiguration</code>类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Knife4jConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">customOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>()</span><br><span class="line">                        .title(<span class="string">&quot;APP接口&quot;</span>)</span><br><span class="line">                        .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;用户端APP接口&quot;</span>)</span><br><span class="line">                        .termsOfService(<span class="string">&quot;http://doc.xiaominfo.com&quot;</span>)</span><br><span class="line">                        .license(<span class="keyword">new</span> <span class="title class_">License</span>().name(<span class="string">&quot;Apache 2.0&quot;</span>)</span><br><span class="line">                                .url(<span class="string">&quot;http://doc.xiaominfo.com&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">loginAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;登录信息&quot;</span>).</span><br><span class="line">                pathsToMatch(<span class="string">&quot;/app/login/**&quot;</span>, <span class="string">&quot;/app/info&quot;</span>).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">personAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;个人信息&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/app/history/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/appointment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/agreement/**&quot;</span></span><br><span class="line">                ).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">lookForRoomAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder().group(<span class="string">&quot;找房信息&quot;</span>).</span><br><span class="line">                pathsToMatch(</span><br><span class="line">                        <span class="string">&quot;/app/apartment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/room/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/payment/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/region/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/app/term/**&quot;</span></span><br><span class="line">                ).</span><br><span class="line">                build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. application.yml配置文件</strong></p>
<p>在application.yml文件中增加如下配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">springdoc:</span></span><br><span class="line">  <span class="attr">default-flat-param-object:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h4 id="7-2-1-4-导入基础代码"><a href="#7-2-1-4-导入基础代码" class="headerlink" title="7.2.1.4 导入基础代码"></a>7.2.1.4 导入基础代码</h4><p>导入的代码和目标位置如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>导入代码</th>
<th>模块</th>
<th>包名/路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>mapper接口</td>
<td>web-app</td>
<td><code>com.atguigu.lease.web.app.mapper</code></td>
<td>略</td>
</tr>
<tr>
<td>mapper xml</td>
<td>web-app</td>
<td>src/main/resources/mapper</td>
<td>略</td>
</tr>
<tr>
<td>service</td>
<td>web-app</td>
<td><code>com.atguigu.lease.web.app.service</code></td>
<td>略</td>
</tr>
<tr>
<td>serviceImpl</td>
<td>web-app</td>
<td><code>com.atguigu.lease.web.app.service.impl</code></td>
<td>略</td>
</tr>
</tbody>
</table>
</div>
<h4 id="7-2-1-5-导入接口定义代码"><a href="#7-2-1-5-导入接口定义代码" class="headerlink" title="7.2.1.5 导入接口定义代码"></a>7.2.1.5 导入接口定义代码</h4><p>需要导入的代码和目标位置如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>导入代码</th>
<th>模块</th>
<th>包名/路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller</td>
<td>web-app</td>
<td><code>com.atguigu.lease.web.app.controller</code></td>
<td>略</td>
</tr>
<tr>
<td>vo</td>
<td>web-app</td>
<td><code>com.atguigu.lease.web.app.vo</code></td>
<td>View Object，用于封装或定义接口接受及返回的数据结构</td>
</tr>
</tbody>
</table>
</div>
<h4 id="7-2-1-6-启动项目"><a href="#7-2-1-6-启动项目" class="headerlink" title="7.2.1.6 启动项目"></a>7.2.1.6 启动项目</h4><p>由于<strong>common模块</strong>中配置了<strong>MinioClient</strong>这个Bean，并且<strong>web-app模块</strong>依赖于<strong>common模块</strong>，因此在启动<strong>AppWebApplication</strong>时，SpringBoot会创建一个MinioClient实例，但是由于<strong>web-app模块</strong>的application.yml文件中并未提供MinioClient所需的参数（<strong>web-app模块</strong>暂时不需要使用MinioClient），因此MinioClient实例的创建会失败。</p>
<p>为解决该问题，可以为MinioClient的配置类增加一个条件注解<code>@ConditionalOnProperty</code>，如下，该注解表达的含义是只有当<code>minio.endpoint</code>属性存在时，该配置类才会生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MinioProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;minio.endpoint&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">minioClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder().endpoint(properties.getEndpoint()).credentials(properties.getAccessKey(), properties.getSecretKey()).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成上述配置后，便可启动SpringBoot项目，并访问接口文档了，Knife4j文档的url为：<a target="_blank" rel="noopener" href="http://localhost:8081/doc.html">http://localhost:8081/doc.html</a></p>
<h3 id="7-4-2-登录管理"><a href="#7-4-2-登录管理" class="headerlink" title="7.4.2 登录管理"></a>7.4.2 登录管理</h3><h4 id="7-4-2-1-登陆流程"><a href="#7-4-2-1-登陆流程" class="headerlink" title="7.4.2.1 登陆流程"></a>7.4.2.1 登陆流程</h4><p>移动端的具体登录流程如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019804.svg" style="zoom:50%;" /></p>
<p>根据上述登录流程，可分析出，登录管理共需三个接口，分别是<strong>获取短信验证码</strong>、<strong>登录</strong>、<strong>查询登录用户的个人信息</strong>。除此之外，同样需要编写<code>HandlerInterceptor</code>来为所有受保护的接口增加验证JWT的逻辑。</p>
<h4 id="7-4-2-2-接口开发"><a href="#7-4-2-2-接口开发" class="headerlink" title="7.4.2.2 接口开发"></a>7.4.2.2 接口开发</h4><p>首先在<code>LoginController</code>中注入<code>LoginService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;登录管理&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-获取短信验证码"><a href="#1-获取短信验证码" class="headerlink" title="1. 获取短信验证码"></a>1. 获取短信验证码</h5><p>该接口需向登录手机号码发送短信验证码，各大云服务厂商都提供短信服务，本项目使用阿里云完成短信验证码功能，下面介绍具体配置。</p>
<ul>
<li><p><strong>配置短信服务</strong></p>
<ul>
<li><p><strong>开通短信服务</strong></p>
<ul>
<li><p>在<a target="_blank" rel="noopener" href="https://www.aliyun.com">阿里云官网</a>，注册阿里云账号，并按照指引，完成实名认证（不认证，无法购买服务）</p>
</li>
<li><p>找到<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/sms">短信服务</a>，选择<strong>免费开通</strong></p>
</li>
<li><p>进入<a target="_blank" rel="noopener" href="https://dysms.console.aliyun.com/overview">短信服务控制台</a>，选择<strong>快速学习和测试</strong></p>
</li>
<li><p>找到<strong>发送测试</strong>下的<strong>API发送测试</strong>，绑定测试用的手机号（只有绑定的手机号码才能收到测试短信），然后配置短信签名和短信模版，这里选择<strong>[专用]测试签名/模版</strong>。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019805.png" alt=""></p>
</li>
</ul>
</li>
<li><p><strong>创建AccessKey</strong></p>
<p>云账号 AccessKey 是访问阿里云 API 的密钥，没有AccessKey无法调用短信服务。点击页面右上角的头像，选择<strong>AccessKey管理</strong>，然后<strong>创建AccessKey</strong>。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019806.png" alt="image-20230808104345383" style="zoom: 45%;" /></p>
</li>
</ul>
</li>
<li><p><strong>配置所需依赖</strong></p>
<p>如需调用阿里云的短信服务，需使用其提供的SDK，具体可参考<a target="_blank" rel="noopener" href="https://next.api.aliyun.com/api-tools/sdk/Dysmsapi?spm=a2c4g.215759.0.0.43e6807dDRAZVz&amp;version=2017-05-25&amp;language=java-tea&amp;tab=primer-doc#doc-summary">官方文档</a>。</p>
<p>在<strong>common模块</strong>的pom.xml文件中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dysmsapi20170525<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置发送短信客户端</strong></p>
<ul>
<li><p>在<code>application.yml</code>中增加如下内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">sms:</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">&lt;access-key-id&gt;</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">&lt;access-key-secret&gt;</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">dysmsapi.aliyuncs.com</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>上述<code>access-key-id</code>、<code>access-key-secret</code>需根据实际情况进行修改。</p>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.sms.AliyunSMSProperties</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun.sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunSMSProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.sms.AliyunSmsConfiguration</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(AliyunSMSProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;aliyun.sms.endpoint&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunSMSConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliyunSMSProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Client <span class="title function_">smsClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.setAccessKeyId(properties.getAccessKeyId());</span><br><span class="line">        config.setAccessKeySecret(properties.getAccessKeySecret());</span><br><span class="line">        config.setEndpoint(properties.getEndpoint());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Client</span>(config);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>配置Redis连接参数</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.101</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;login/getCode&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;获取短信验证码&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getCode</span><span class="params">(<span class="meta">@RequestParam</span> String phone)</span> &#123;</span><br><span class="line">    service.getSMSCode(phone);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>编写发送短信逻辑</p>
<ul>
<li><p>在<code>SmsService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">sendCode</span><span class="params">(String phone, String verifyCode)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>SmsServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCode</span><span class="params">(String phone, String code)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">SendSmsRequest</span> <span class="variable">smsRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">    smsRequest.setPhoneNumbers(phone);</span><br><span class="line">    smsRequest.setSignName(<span class="string">&quot;阿里云短信测试&quot;</span>);</span><br><span class="line">    smsRequest.setTemplateCode(<span class="string">&quot;SMS_154950909&quot;</span>);</span><br><span class="line">    smsRequest.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span> + code + <span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.sendSms(smsRequest);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写生成随机验证码逻辑</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.utils.VerifyCodeUtil</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getVerifyCode</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            builder.append(random.nextInt(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写获取短信验证码逻辑</p>
<ul>
<li><p>在<code>LoginServcie</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">getSMSCode</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getSMSCode</span><span class="params">(String phone)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 检查手机号码是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(phone)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_PHONE_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 检查Redis中是否已经存在该手机号码的key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.APP_LOGIN_PREFIX + phone;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasKey</span> <span class="operator">=</span> redisTemplate.hasKey(key);</span><br><span class="line">    <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">        <span class="comment">//若存在，则检查其存在的时间</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">expire</span> <span class="operator">=</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (RedisConstant.APP_LOGIN_CODE_TTL_SEC - expire &lt; RedisConstant.APP_LOGIN_CODE_RESEND_TIME_SEC) &#123;</span><br><span class="line">            <span class="comment">//若存在时间不足一分钟，响应发送过于频繁</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_SEND_SMS_TOO_OFTEN);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.发送短信，并将验证码存入Redis</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> VerifyCodeUtil.getVerifyCode(<span class="number">6</span>);</span><br><span class="line">    smsService.sendCode(phone, verifyCode);</span><br><span class="line">    redisTemplate.opsForValue().set(key, verifyCode, RedisConstant.APP_LOGIN_CODE_TTL_SEC, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>需要注意防止频繁发送短信。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-登录和注册接口"><a href="#2-登录和注册接口" class="headerlink" title="2. 登录和注册接口"></a>2. 登录和注册接口</h5><ul>
<li><p><strong>登录注册校验逻辑</strong></p>
<ul>
<li>前端发送手机号码<code>phone</code>和接收到的短信验证码<code>code</code>到后端。</li>
<li>首先校验<code>phone</code>和<code>code</code>是否为空，若为空，直接响应<code>手机号码为空</code>或者<code>验证码为空</code>，若不为空则进入下步判断。</li>
<li>根据<code>phone</code>从Redis中查询之前保存的验证码，若查询结果为空，则直接响应<code>验证码已过期</code> ，若不为空则进入下一步判断。</li>
<li>比较前端发送的验证码和从Redis中查询出的验证码，若不同，则直接响应<code>验证码错误</code>，若相同则进入下一步判断。</li>
<li>使用<code>phone</code>从数据库中查询用户信息，若查询结果为空，则创建新用户，并将用户保存至数据库，然后进入下一步判断。</li>
<li>判断用户是否被禁用，若被禁，则直接响应<code>账号被禁用</code>，否则进入下一步。</li>
<li>创建JWT并响应给前端。</li>
</ul>
</li>
<li><p><strong>接口实现</strong></p>
<ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;登录&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> service.login(loginVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LoginService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>总增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.判断手机号码和验证码是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(loginVo.getPhone())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_PHONE_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(loginVo.getCode())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_CODE_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.校验验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.APP_LOGIN_PREFIX + loginVo.getPhone();</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_CODE_EXPIRED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!code.equals(loginVo.getCode())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_CODE_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.判断用户是否存在,不存在则注册（创建用户）</span></span><br><span class="line">    LambdaQueryWrapper&lt;UserInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(UserInfo::getPhone, loginVo.getPhone());</span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> userInfoService.getOne(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (userInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">        userInfo = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line">        userInfo.setPhone(loginVo.getPhone());</span><br><span class="line">        userInfo.setStatus(BaseStatus.ENABLE);</span><br><span class="line">        userInfo.setNickname(<span class="string">&quot;用户-&quot;</span>+loginVo.getPhone().substring(<span class="number">6</span>));</span><br><span class="line">        userInfoService.save(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.判断用户是否被禁</span></span><br><span class="line">    <span class="keyword">if</span> (userInfo.getStatus().equals(BaseStatus.DISABLE)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_ACCOUNT_DISABLED_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.创建并返回TOKEN</span></span><br><span class="line">    <span class="keyword">return</span> JwtUtil.createToken(userInfo.getId(), loginVo.getPhone());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写HandlerInterceptor</strong></p>
<ul>
<li><p><strong>编写AuthenticationInterceptor</strong></p>
<p>在<strong>web-app模块</strong>创建<code>com.atguigu.lease.web.app.custom.interceptor.AuthenticationInterceptor</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;access-token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseToken(token);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> claims.get(<span class="string">&quot;userId&quot;</span>, Long.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> claims.get(<span class="string">&quot;username&quot;</span>, String.class);</span><br><span class="line">        LoginUserHolder.setLoginUser(<span class="keyword">new</span> <span class="title class_">LoginUser</span>(userId, username));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        LoginUserHolder.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注册AuthenticationInterceptor</strong></p>
<p>在<strong>web-app模块</strong>创建<code>com.atguigu.lease.web.app.custom.config.WebMvcConfiguration</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationInterceptor authenticationInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="built_in">this</span>.authenticationInterceptor).addPathPatterns(<span class="string">&quot;/app/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/app/login/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>Knife4j增加认证相关配置</strong></p>
<p>在增加上述拦截器后，为方便继续调试其他接口，可以获取一个长期有效的Token，将其配置到Knife4j的全局参数中。</p>
</li>
</ul>
<h5 id="3-查询登录用户的个人信息"><a href="#3-查询登录用户的个人信息" class="headerlink" title="3.查询登录用户的个人信息"></a>3.查询登录用户的个人信息</h5><ul>
<li><p><strong>查看响应数据结构</strong></p>
<p>查看<strong>web-app模块</strong>下的<code>com.atguigu.lease.web.app.vo.user.UserInfoVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;用户基本信息&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户昵称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;用户头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;获取登录用户信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;UserInfoVo&gt; <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">UserInfoVo</span> <span class="variable">info</span> <span class="operator">=</span> service.getUserInfoById(LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LoginService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserInfoVo <span class="title function_">getUserInfoId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserInfoVo <span class="title function_">getUserInfoId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> userInfoService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserInfoVo</span>(userInfo.getNickname(), userInfo.getAvatarUrl());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="7-4-3-找房"><a href="#7-4-3-找房" class="headerlink" title="7.4.3 找房"></a>7.4.3 找房</h3><h4 id="7-4-3-1-地区信息"><a href="#7-4-3-1-地区信息" class="headerlink" title="7.4.3.1 地区信息"></a>7.4.3.1 地区信息</h4><p>对于找房模块，地区信息共需三个接口，分别是<strong>查询省份列表</strong>、<strong>根据省份ID查询城市列表</strong>、<strong>根据城市ID查询区县列表</strong>，具体实现如下</p>
<p>在<code>RegionController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;地区信息&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/region&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProvinceInfoService provinceInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CityInfoService cityInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DistrictInfoService districtInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary=&quot;查询省份信息列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;province/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;ProvinceInfo&gt;&gt; <span class="title function_">listProvince</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;ProvinceInfo&gt; list = provinceInfoService.list();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary=&quot;根据省份id查询城市信息列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;city/listByProvinceId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;CityInfo&gt;&gt; <span class="title function_">listCityInfoByProvinceId</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;CityInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(CityInfo::getProvinceId,id);</span><br><span class="line">        List&lt;CityInfo&gt; list = cityInfoService.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;district/listByCityId&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary=&quot;根据城市id查询区县信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DistrictInfo&gt;&gt; <span class="title function_">listDistrictInfoByCityId</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;DistrictInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(DistrictInfo::getCityId,id);</span><br><span class="line">        List&lt;DistrictInfo&gt; list = districtInfoService.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-4-3-2-支付方式"><a href="#7-4-3-2-支付方式" class="headerlink" title="7.4.3.2 支付方式"></a>7.4.3.2 支付方式</h4><p>对于找房模块，支付方式共需一个接口，即<strong>获取全部支付方式列表</strong>，具体实现如下</p>
<p>在<code>PaymentTypeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;支付方式接口&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentTypeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentTypeService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取全部支付方式列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;PaymentType&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;PaymentType&gt; list = service.list();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-4-3-4-房间信息"><a href="#7-4-3-4-房间信息" class="headerlink" title="7.4.3.4 房间信息"></a>7.4.3.4 房间信息</h4><p>房间信息共需三个接口，分别是<strong>根据条件分页查询房间列表</strong>、<strong>根据ID查询房间详细信息</strong>、<strong>根据公寓ID分页查询房间列表</strong>，下面逐一实现</p>
<p>首先在<code>RoomController</code>中注入<code>RoomInfoService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;房间信息&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/room&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RoomInfoService roomInfoService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-根据条件分页查询房间列表"><a href="#1-根据条件分页查询房间列表" class="headerlink" title="1. 根据条件分页查询房间列表"></a>1. 根据条件分页查询房间列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求数据结构</strong></p>
<ul>
<li><p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><code>RoomQueryVo</code>为房间的查询条件，详细结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;房间查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomQueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;省份Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long provinceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;城市Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long cityId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;区域Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long districtId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;最小租金&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal minRent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;最大租金&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal maxRent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;支付方式&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long paymentTypeId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;价格排序方式&quot;, allowableValues = &#123;&quot;desc&quot;, &quot;asc&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String orderType;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>响应数据结构</strong></p>
<p>单个房间信息记录可查看<code>com.atguigu.lease.web.app.vo.room.RoomItemVo</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;APP房间列表实体&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomItemVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租金（元/月）&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal rent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间所属公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;分页查询房间列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageItem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;RoomItemVo&gt;&gt; <span class="title function_">pageItem</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, RoomQueryVo queryVo)</span> &#123;</span><br><span class="line">    Page&lt;RoomItemVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;RoomItemVo&gt; list = roomInfoService.pageRoomItemByQuery(page, queryVo);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(Page&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(Page&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> roomInfoMapper.pageRoomItemByQuery(page, queryVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageRoomItemByQuery</span><span class="params">(Page&lt;RoomItemVo&gt; page, RoomQueryVo queryVo)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoMapper</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- result map --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;RoomItemVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.room.RoomItemVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--映射公寓信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;apartmentInfo&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.ApartmentInfo&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--映射图片列表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphVoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;selectGraphVoListByRoomId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--映射标签列表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;labelInfoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;selectLabelInfoListByRoomId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 根据条件查询房间列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageItem&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomItemVoMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        ri.id,</span><br><span class="line">        ri.room_number,</span><br><span class="line">        ri.rent,</span><br><span class="line">        ai.id apartment_id,</span><br><span class="line">        ai.name,</span><br><span class="line">        ai.introduction,</span><br><span class="line">        ai.district_id,</span><br><span class="line">        ai.district_name,</span><br><span class="line">        ai.city_id,</span><br><span class="line">        ai.city_name,</span><br><span class="line">        ai.province_id,</span><br><span class="line">        ai.province_name,</span><br><span class="line">        ai.address_detail,</span><br><span class="line">        ai.latitude,</span><br><span class="line">        ai.longitude,</span><br><span class="line">        ai.phone,</span><br><span class="line">        ai.is_release</span><br><span class="line">    from room_info ri</span><br><span class="line">    left join apartment_info ai on ri.apartment_id = ai.id and ai.is_deleted = 0</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        ri.is_deleted = 0</span><br><span class="line">        and ri.is_release = 1</span><br><span class="line">        and ri.id not in(</span><br><span class="line">            select room_id</span><br><span class="line">            from lease_agreement</span><br><span class="line">            where is_deleted = 0</span><br><span class="line">            and status in(2,5))</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.provinceId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.province_id = #&#123;queryVo.provinceId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.cityId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.city_id = #&#123;queryVo.cityId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.districtId != null&quot;</span>&gt;</span></span><br><span class="line">            and ai.district_id = #&#123;queryVo.districtId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.minRent != null and queryVo.maxRent != null&quot;</span>&gt;</span></span><br><span class="line">            and (ri.rent <span class="symbol">&amp;gt;</span>= #&#123;queryVo.minRent&#125; and ri.rent <span class="symbol">&amp;lt;</span>= #&#123;queryVo.maxRent&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.paymentTypeId != null&quot;</span>&gt;</span></span><br><span class="line">            and ri.id in (</span><br><span class="line">            select</span><br><span class="line">            room_id</span><br><span class="line">            from room_payment_type</span><br><span class="line">            where is_deleted = 0</span><br><span class="line">            and payment_type_id = #&#123;queryVo.paymentTypeId&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;queryVo.orderType == &#x27;desc&#x27; or queryVo.orderType == &#x27;asc&#x27;&quot;</span>&gt;</span></span><br><span class="line">        order by ri.rent $&#123;queryVo.orderType&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 根据房间ID查询图片列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectGraphVoListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           name,</span><br><span class="line">           item_type,</span><br><span class="line">           item_id,</span><br><span class="line">           url</span><br><span class="line">    from graph_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and item_type = 2</span><br><span class="line">      and item_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 根据公寓ID查询标签列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLabelInfoListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name</span><br><span class="line">    from label_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select label_id</span><br><span class="line">                 from room_label</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<ul>
<li><p><strong>xml文件<code>&lt;</code>和<code>&gt;</code>的转义</strong></p>
<p>由于xml文件中的<code>&lt;</code>和<code>&gt;</code>是特殊符号，需要转义处理。</p>
<p>| 原符号 | 转义符号 |<br>| ——— | ———— |<br>| <code>&lt;</code>    | <code>&amp;lt;</code>   |<br>| <code>&gt;</code>    | <code>&amp;gt;</code>   |</p>
</li>
<li><p><strong>Mybatis-Plus分页插件注意事项</strong></p>
<p>使用Mybatis-Plus的分页插件进行分页查询时，如果结果需要使用<code>&lt;collection&gt;</code>进行映射，只能使用<strong><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#nested-select-for-collection">嵌套查询（Nested Select for Collection）</a></strong>，而不能使用<strong><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#nested-results-for-collection">嵌套结果映射（Nested Results for Collection）</a></strong>。</p>
<p><strong>嵌套查询</strong>和<strong>嵌套结果映射</strong>是Collection映射的两种方式，下面通过一个案例进行介绍</p>
<p>例如有<code>room_info</code>和<code>graph_info</code>两张表，其关系为一对多，如下</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019807.svg" style="zoom:50%;" /></p>
<p>现需要查询房间列表及其图片信息，期望返回的结果如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">201</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rent&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">202</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rent&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>为得到上述结果，可使用以下两种方式</p>
<ul>
<li><p><strong>嵌套结果映射</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRoomPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomPageMap&quot;</span>&gt;</span></span><br><span class="line">    select ri.id room_id,</span><br><span class="line">           ri.number,</span><br><span class="line">           ri.rent,</span><br><span class="line">    	   gi.id graph_id,</span><br><span class="line">           gi.url,</span><br><span class="line">           gi.room_id</span><br><span class="line">    from room_info ri</span><br><span class="line">   	left join graph_info gi on ri.id=gi.room_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;RoomPageMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;RoomInfoVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;room_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphInfoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;GraphInfo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;graph_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种方式的执行原理如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019808.svg" style="zoom:50%;" /></p>
</li>
<li><p><strong>嵌套查询</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRoomPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomPageMap&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           number,</span><br><span class="line">           rent</span><br><span class="line">    from room_info</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;RoomPageMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;RoomInfoVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphInfoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;GraphInfo&quot;</span> <span class="attr">select</span>=<span class="string">&quot;selectGraphByRoomId&quot;</span> 				 	<span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectGraphByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;GraphInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           url,</span><br><span class="line">    	   room_id</span><br><span class="line">    from graph_info</span><br><span class="line">    where room_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种方法使用两个独立的查询语句来获取一对多关系的数据。首先，Mybatis会执行主查询来获取<code>room_info</code>列表，然后对于每个<code>room_info</code>，Mybatis都会执行一次子查询来获取其对应的<code>graph_info</code>。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019809.svg" style="zoom:50%;" /></p>
</li>
</ul>
<p>若现在使用MybatisPlus的分页插件进行分页查询，假如查询的内容是第<strong>1</strong>页，每页<strong>2</strong>条记录，则上述两种方式的查询结果分别是</p>
<ul>
<li><p><strong>嵌套结果映射</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019810.svg" style="zoom:50%;" /></p>
</li>
<li><p><strong>嵌套查询</strong></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019811.svg" style="zoom:50%;" /></p>
</li>
</ul>
<p>显然<strong>嵌套结果映射</strong>的分页逻辑是存在问题的。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-根据ID查询房间详细信息"><a href="#2-根据ID查询房间详细信息" class="headerlink" title="2. 根据ID查询房间详细信息"></a>2. 根据ID查询房间详细信息</h5><ul>
<li><p><strong>查看响应数据结构</strong></p>
<p>查看<strong>web-app模块</strong>下的<code>com.atguigu.lease.web.app.vo.room.RoomDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;APP房间详情&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomDetailVo</span> <span class="keyword">extends</span> <span class="title class_">RoomInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;所属公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentItemVo apartmentItemVo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;属性信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrValueVo&gt; attrValueVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;配套信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;FacilityInfo&gt; facilityInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;标签信息列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;支付方式列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PaymentType&gt; paymentTypeList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;杂费列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;FeeValueVo&gt; feeValueVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租期列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LeaseTerm&gt; leaseTermList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id获取房间的详细信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;RoomDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> service.getDetailById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(roomInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写查询房间信息逻辑</strong></p>
<ul>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoomDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> RoomDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//1.查询房间信息</span></span><br><span class="line">    <span class="type">RoomInfo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> roomInfoMapper.selectById(id);</span><br><span class="line">    <span class="keyword">if</span> (roomInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.查询图片</span></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.ROOM, id);</span><br><span class="line">    <span class="comment">//3.查询租期</span></span><br><span class="line">    List&lt;LeaseTerm&gt; leaseTermList = leaseTermMapper.selectListByRoomId(id);</span><br><span class="line">    <span class="comment">//4.查询配套</span></span><br><span class="line">    List&lt;FacilityInfo&gt; facilityInfoList = facilityInfoMapper.selectListByRoomId(id);</span><br><span class="line">    <span class="comment">//5.查询标签</span></span><br><span class="line">    List&lt;LabelInfo&gt; labelInfoList = labelInfoMapper.selectListByRoomId(id);</span><br><span class="line">    <span class="comment">//6.查询支付方式</span></span><br><span class="line">    List&lt;PaymentType&gt; paymentTypeList = paymentTypeMapper.selectListByRoomId(id);</span><br><span class="line">    <span class="comment">//7.查询基本属性</span></span><br><span class="line">    List&lt;AttrValueVo&gt; attrValueVoList = attrValueMapper.selectListByRoomId(id);</span><br><span class="line">    <span class="comment">//8.查询杂费信息</span></span><br><span class="line">    List&lt;FeeValueVo&gt; feeValueVoList = feeValueMapper.selectListByApartmentId(roomInfo.getApartmentId());</span><br><span class="line">    <span class="comment">//9.查询公寓信息</span></span><br><span class="line">    <span class="type">ApartmentItemVo</span> <span class="variable">apartmentItemVo</span> <span class="operator">=</span> apartmentInfoService.selectApartmentItemVoById(roomInfo.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">roomDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoomDetailVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(roomInfo, roomDetailVo);</span><br><span class="line"></span><br><span class="line">    roomDetailVo.setApartmentItemVo(apartmentItemVo);</span><br><span class="line">    roomDetailVo.setGraphVoList(graphVoList);</span><br><span class="line">    roomDetailVo.setAttrValueVoList(attrValueVoList);</span><br><span class="line">    roomDetailVo.setFacilityInfoList(facilityInfoList);</span><br><span class="line">    roomDetailVo.setLabelInfoList(labelInfoList);</span><br><span class="line">    roomDetailVo.setPaymentTypeList(paymentTypeList);</span><br><span class="line">    roomDetailVo.setFeeValueVoList(feeValueVoList);</span><br><span class="line">    roomDetailVo.setLeaseTermList(leaseTermList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> roomDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p><strong>编写查询房间图片逻辑</strong></p>
<ul>
<li><p>在<code>GraphInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;GraphVo&gt; <span class="title function_">selectListByItemTypeAndId</span><span class="params">(ItemType itemType, Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>GraphInfoMapper.xml</code>增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByItemTypeAndId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span>&gt;</span></span><br><span class="line">    select name,</span><br><span class="line">           url</span><br><span class="line">    from graph_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and item_type = #&#123;itemType&#125;</span><br><span class="line">      and item_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间可选租期逻辑</strong></p>
<ul>
<li><p>在<code>LeaseTermMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LeaseTerm&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseTermMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.LeaseTerm&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           month_count,</span><br><span class="line">           unit</span><br><span class="line">    from lease_term</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select lease_term_id</span><br><span class="line">                 from room_lease_term</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间配套逻辑</strong></p>
<ul>
<li><p>在<code>FacilityInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FacilityInfo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FacilityInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.FacilityInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name,</span><br><span class="line">           icon</span><br><span class="line">    from facility_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select facility_id</span><br><span class="line">                 from room_facility</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间标签逻辑</strong></p>
<ul>
<li><p>在<code>LabelInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LabelInfo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LabelInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name</span><br><span class="line">    from label_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select label_id</span><br><span class="line">                 from room_label</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间可选支付方式逻辑</strong></p>
<ul>
<li><p>在<code>PaymentTypeMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;PaymentType&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>PaymentTypeMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.PaymentType&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           name,</span><br><span class="line">           pay_month_count,</span><br><span class="line">           additional_info</span><br><span class="line">    from payment_type</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select payment_type_id</span><br><span class="line">                 from room_payment_type</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间属性逻辑</strong></p>
<ul>
<li><p>在<code>AttrValueMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AttrValueVo&gt; <span class="title function_">selectListByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>AttrValueMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.attr.AttrValueVo&quot;</span>&gt;</span></span><br><span class="line">    select av.id,</span><br><span class="line">           av.name,</span><br><span class="line">           av.attr_key_id,</span><br><span class="line">           ak.name attr_key_name</span><br><span class="line">    from attr_value av</span><br><span class="line">             left join attr_key ak on av.attr_key_id = ak.id and ak.is_deleted = 0</span><br><span class="line">    where av.is_deleted = 0</span><br><span class="line">      and av.id in (select attr_value_id</span><br><span class="line">                    from room_attr_value</span><br><span class="line">                    where is_deleted = 0</span><br><span class="line">                      and room_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写查询房间杂费逻辑</strong></p>
<ul>
<li><p>在<code>FeeValueMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FeeValueVo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FeeValueMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByApartmentId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.fee.FeeValueVo&quot;</span>&gt;</span></span><br><span class="line">    select fv.id,</span><br><span class="line">           fv.name,</span><br><span class="line">           fv.unit,</span><br><span class="line">           fv.fee_key_id,</span><br><span class="line">           fk.name fee_key_name</span><br><span class="line">    from fee_value fv</span><br><span class="line">             left join fee_key fk on fv.fee_key_id = fk.id and fk.is_deleted = 0</span><br><span class="line">    where fv.is_deleted = 0</span><br><span class="line">      and fv.id in (select fee_value_id</span><br><span class="line">                    from apartment_fee_value</span><br><span class="line">                    where is_deleted = 0</span><br><span class="line">                      and apartment_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>编写查询所属公寓信息逻辑</strong></p>
<ul>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApartmentItemVo <span class="title function_">selectApartmentItemVoById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ApartmentItemVo <span class="title function_">selectApartmentItemVoById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> apartmentInfoMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    List&lt;LabelInfo&gt; labelInfoList = labelInfoMapper.selectListByApartmentId(id);</span><br><span class="line"></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.APARTMENT, id);</span><br><span class="line"></span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">minRent</span> <span class="operator">=</span> roomInfoMapper.selectMinRentByApartmentId(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">ApartmentItemVo</span> <span class="variable">apartmentItemVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentItemVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(apartmentInfo, apartmentItemVo);</span><br><span class="line"></span><br><span class="line">    apartmentItemVo.setGraphVoList(graphVoList);</span><br><span class="line">    apartmentItemVo.setLabelInfoList(labelInfoList);</span><br><span class="line">    apartmentItemVo.setMinRent(minRent);</span><br><span class="line">    <span class="keyword">return</span> apartmentItemVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p><strong>编写查询标签信息逻辑</strong></p>
<ul>
<li><p>在<code>LabelInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LabelInfo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LabelInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByApartmentId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.LabelInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           type,</span><br><span class="line">           name</span><br><span class="line">    from label_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and id in (select label_id</span><br><span class="line">                 from apartment_label</span><br><span class="line">                 where is_deleted = 0</span><br><span class="line">                   and apartment_id = #&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写查询公寓最小租金逻辑</strong></p>
<ul>
<li><p>在<code>RoomInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal <span class="title function_">selectMinRentByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>RoomInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMinRentByApartmentId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.math.BigDecimal&quot;</span>&gt;</span></span><br><span class="line">    select min(rent)</span><br><span class="line">    from room_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">    and is_release = 1</span><br><span class="line">    and apartment_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="3-根据公寓ID分页查询房间列表"><a href="#3-根据公寓ID分页查询房间列表" class="headerlink" title="3.根据公寓ID分页查询房间列表"></a>3.根据公寓ID分页查询房间列表</h5><ul>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求的数据结构</strong></p>
<ul>
<li><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</li>
<li><code>id</code>为公寓ID。</li>
</ul>
</li>
<li><p><strong>响应的数据结构</strong></p>
<ul>
<li><p>查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.app.vo.room.RoomItemVo</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Schema(description = &quot;APP房间列表实体&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoomItemVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租金（元/月）&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal rent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间所属公寓信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfo apartmentInfo;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>RoomController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据公寓id分页查询房间列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageItemByApartmentId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;IPage&lt;RoomItemVo&gt;&gt; <span class="title function_">pageItemByApartmentId</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size, <span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    IPage&lt;RoomItemVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;RoomItemVo&gt; result = service.pageItemByApartmentId(page, id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>RoomInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageItemByApartmentId</span><span class="params">(IPage&lt;RoomItemVo&gt; page, Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>RoomInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;RoomItemVo&gt; <span class="title function_">pageItemByApartmentId</span><span class="params">(IPage&lt;RoomItemVo&gt; page, Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> roomInfoMapper.pageItemByApartmentId(page, id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<p>在<code>RoomInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;RoomItemVo&gt; <span class="title function_">pageItemByApartmentId</span><span class="params">(IPage&lt;RoomItemVo&gt; page, Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>RoomInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageItemByApartmentId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomItemVoMap&quot;</span>&gt;</span></span><br><span class="line">    select ri.id,</span><br><span class="line">           ri.room_number,</span><br><span class="line">           ri.rent,</span><br><span class="line">           ai.id apartment_id,</span><br><span class="line">           ai.name,</span><br><span class="line">           ai.introduction,</span><br><span class="line">           ai.district_id,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_id,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_id,</span><br><span class="line">           ai.province_name,</span><br><span class="line">           ai.address_detail,</span><br><span class="line">           ai.latitude,</span><br><span class="line">           ai.longitude,</span><br><span class="line">           ai.phone,</span><br><span class="line">           ai.is_release</span><br><span class="line">    from room_info ri</span><br><span class="line">             left join apartment_info ai on ri.apartment_id = ai.id and ai.is_deleted = 0</span><br><span class="line">    where ri.is_deleted = 0</span><br><span class="line">      and ri.is_release = 1</span><br><span class="line">      and ai.id = #&#123;id&#125;</span><br><span class="line">      and ri.id not in (select room_id</span><br><span class="line">                        from lease_agreement</span><br><span class="line">                        where is_deleted = 0</span><br><span class="line">                          and status in (2, 5))</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="7-4-3-5-公寓信息"><a href="#7-4-3-5-公寓信息" class="headerlink" title="7.4.3.5 公寓信息"></a>7.4.3.5 公寓信息</h4><p>公寓信息只需一个接口，即<strong>根据ID查询公寓详细信息</strong>，具体实现如下</p>
<p>首先在<code>ApartmentController</code>中注入<code>ApartmentInfoService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;公寓信息&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/apartment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentInfoService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-app模块</strong>下的<code>com.atguigu.lease.web.app.vo.apartment.ApartmentDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;APP端公寓信息详情&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApartmentDetailVo</span> <span class="keyword">extends</span> <span class="title class_">ApartmentInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;LabelInfo&gt; labelInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;配套列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;FacilityInfo&gt; facilityInfoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租金最小值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal minRent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ApartmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id获取公寓信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;ApartmentDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">ApartmentDetailVo</span> <span class="variable">apartmentDetailVo</span> <span class="operator">=</span> service.getApartmentDetailById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(apartmentDetailVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ApartmentInfoService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApartmentDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ApartmentInfoServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ApartmentDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//1.查询公寓信息</span></span><br><span class="line">    <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> apartmentInfoMapper.selectById(id);</span><br><span class="line">    <span class="comment">//2.查询图片信息</span></span><br><span class="line">    List&lt;GraphVo&gt; graphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.APARTMENT, id);</span><br><span class="line">    <span class="comment">//3.查询标签信息</span></span><br><span class="line">    List&lt;LabelInfo&gt; labelInfoList = labelInfoMapper.selectListByApartmentId(id);</span><br><span class="line">    <span class="comment">//4.查询配套信息</span></span><br><span class="line">    List&lt;FacilityInfo&gt; facilityInfoList = facilityInfoMapper.selectListByApartmentId(id);</span><br><span class="line">    <span class="comment">//5.查询最小租金</span></span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">minRent</span> <span class="operator">=</span> roomInfoMapper.selectMinRentByApartmentId(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">ApartmentDetailVo</span> <span class="variable">apartmentDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApartmentDetailVo</span>();</span><br><span class="line"></span><br><span class="line">    BeanUtils.copyProperties(apartmentInfo, apartmentDetailVo);</span><br><span class="line">    apartmentDetailVo.setGraphVoList(graphVoList);</span><br><span class="line">    apartmentDetailVo.setLabelInfoList(labelInfoList);</span><br><span class="line">    apartmentDetailVo.setFacilityInfoList(facilityInfoList);</span><br><span class="line">    apartmentDetailVo.setMinRent(minRent);</span><br><span class="line">    <span class="keyword">return</span> apartmentDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p><strong>编写查询公寓配套逻辑</strong></p>
<ul>
<li><p>在<code>FacilityInfoMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FacilityInfo&gt; <span class="title function_">selectListByApartmentId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>FacilityInfoMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByApartmentId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.model.entity.FacilityInfo&quot;</span>&gt;</span></span><br><span class="line">          select id,</span><br><span class="line">                 type,</span><br><span class="line">                 name,</span><br><span class="line">                 icon</span><br><span class="line">          from facility_info</span><br><span class="line">          where is_deleted = 0</span><br><span class="line">            and id in (select facility_id</span><br><span class="line">                       from apartment_facility</span><br><span class="line">                       where is_deleted = 0</span><br><span class="line">                         and apartment_id = #&#123;id&#125;)</span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">### 7.4.4 个人中心</span><br><span class="line"></span><br><span class="line">#### 7.4.4.1 浏览历史</span><br><span class="line"></span><br><span class="line">浏览历史指的是浏览房间详情的历史，关于浏览历史，有两项工作需要完成，一是提供一个查询浏览历史列表的接口，二是在浏览完房间详情后，增加保存浏览历史的逻辑，下面分别实现。</span><br><span class="line"></span><br><span class="line">##### 1.分页查询浏览历史列表</span><br><span class="line"></span><br><span class="line">首先在`BrowsingHistoryController`中注入`BrowsingHistoryService`，如下</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@RestController</span><br><span class="line">@Tag(name = &quot;浏览历史管理&quot;)</span><br><span class="line">@RequestMapping(&quot;/app/history&quot;)</span><br><span class="line">public class BrowsingHistoryController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private BrowsingHistoryService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>查看请求和响应的数据结构</strong></p>
<ul>
<li><p><strong>请求的数据结构</strong></p>
<p><code>current</code>和<code>size</code>为分页相关参数，分别表示<strong>当前所处页面</strong>和<strong>每个页面的记录数</strong>。</p>
</li>
<li><p><strong>响应的数据结构</strong></p>
<p>查看<strong>web-admin模块</strong>下的<code>com.atguigu.lease.web.app.vo.history.HistoryItemVo</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;浏览历史基本信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HistoryItemVo</span> <span class="keyword">extends</span> <span class="title class_">BrowsingHistory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租金&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal rent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; roomGraphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apartmentName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;省份名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String provinceName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;城市名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String cityName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;区县名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String districtName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>BrowsingHistoryController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取浏览历史&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageItem&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Result&lt;IPage&lt;HistoryItemVo&gt;&gt; <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">long</span> current, <span class="meta">@RequestParam</span> <span class="type">long</span> size)</span> &#123;</span><br><span class="line">    Page&lt;HistoryItemVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">    IPage&lt;HistoryItemVo&gt; result = service.pageHistoryItemByUserId(page, LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>BrowsingHistoryService</code>中增加如下逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;HistoryItemVo&gt; <span class="title function_">pageHistoryItemByUserId</span><span class="params">(Page&lt;HistoryItemVo&gt; page, Long userId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>BrowsingHistoryServiceImpl</code>中增加如下逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;HistoryItemVo&gt; <span class="title function_">pageHistoryItemByUserId</span><span class="params">(Page&lt;HistoryItemVo&gt; page, Long userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> browsingHistoryMapper.pageHistoryItemByUserId(page, userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>BrowsingHistoryMapper</code>中增加如下逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;HistoryItemVo&gt; <span class="title function_">pageHistoryItemByUserId</span><span class="params">(Page&lt;HistoryItemVo&gt; page, Long userId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>BrowsingHistoryMapper.xml</code>中增加如下逻辑</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;HistoryItemVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.history.HistoryItemVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;roomId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;room_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roomGraphVoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;selectGraphVoByRoomId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;room_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageHistoryItemByUserId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;HistoryItemVoMap&quot;</span>&gt;</span></span><br><span class="line">    select bh.id,</span><br><span class="line">           bh.user_id,</span><br><span class="line">           bh.room_id,</span><br><span class="line">           bh.browse_time,</span><br><span class="line">           ri.room_number,</span><br><span class="line">           ri.rent,</span><br><span class="line">           ai.name apartment_name,</span><br><span class="line">           ai.district_name,</span><br><span class="line">           ai.city_name,</span><br><span class="line">           ai.province_name</span><br><span class="line">    from browsing_history bh</span><br><span class="line">             left join room_info ri on bh.room_id = ri.id and ri.is_deleted=0</span><br><span class="line">             left join apartment_info ai on ri.apartment_id = ai.id and ai.is_deleted=0</span><br><span class="line">    where bh.is_deleted = 0</span><br><span class="line">      and bh.user_id = #&#123;userId&#125;</span><br><span class="line">    order by browse_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectGraphVoByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span>&gt;</span></span><br><span class="line">    select url,</span><br><span class="line">           name</span><br><span class="line">    from graph_info</span><br><span class="line">    where is_deleted = 0</span><br><span class="line">      and item_type = 2</span><br><span class="line">      and item_id = #&#123;room_id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="2-保存浏览历史"><a href="#2-保存浏览历史" class="headerlink" title="2.保存浏览历史"></a>2.保存浏览历史</h5><ul>
<li><p><strong>触发保存浏览历史</strong></p>
<p>保存浏览历史的动作应该在浏览房间详情时触发，所以在<code>RoomInfoServiceImpl</code>中的<code>getDetailById</code>方法的最后增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browsingHistoryService.saveHistory(LoginUserContext.getLoginUser().getUserId(), id);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>BrowsingHistoryService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">saveHistory</span><span class="params">(Long userId, Long roomId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>BrowsingHistoryServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveHistory</span><span class="params">(Long userId, Long roomId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;BrowsingHistory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getUserId, userId);</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getRoomId, roomId);</span><br><span class="line">    <span class="type">BrowsingHistory</span> <span class="variable">browsingHistory</span> <span class="operator">=</span> browsingHistoryMapper.selectOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (browsingHistory != <span class="literal">null</span>) &#123;</span><br><span class="line">        browsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.updateById(browsingHistory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">BrowsingHistory</span> <span class="variable">newBrowsingHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrowsingHistory</span>();</span><br><span class="line">        newBrowsingHistory.setUserId(userId);</span><br><span class="line">        newBrowsingHistory.setRoomId(roomId);</span><br><span class="line">        newBrowsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.insert(newBrowsingHistory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>知识点</strong>：</p>
<p>保存浏览历史的动作不应影响前端获取房间详情信息，故此处采取异步操作。Spring Boot提供了<code>@Async</code>注解来完成异步操作，具体使用方式为：</p>
<ul>
<li><p>启用Spring Boot异步操作支持</p>
<p>在 Spring Boot 主应用程序类上添加 <code>@EnableAsync</code> 注解，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AppWebApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在要进行异步处理的方法上添加 <code>@Async</code> 注解，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveHistory</span><span class="params">(Long userId, Long roomId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;BrowsingHistory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getUserId, userId);</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getRoomId, roomId);</span><br><span class="line">    <span class="type">BrowsingHistory</span> <span class="variable">browsingHistory</span> <span class="operator">=</span> browsingHistoryMapper.selectOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (browsingHistory != <span class="literal">null</span>) &#123;</span><br><span class="line">        browsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.updateById(browsingHistory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">BrowsingHistory</span> <span class="variable">newBrowsingHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrowsingHistory</span>();</span><br><span class="line">        newBrowsingHistory.setUserId(userId);</span><br><span class="line">        newBrowsingHistory.setRoomId(roomId);</span><br><span class="line">        newBrowsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.insert(newBrowsingHistory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="7-4-4-2-预约看房"><a href="#7-4-4-2-预约看房" class="headerlink" title="7.4.4.2 预约看房"></a>7.4.4.2 预约看房</h4><p>预约看房管理共需三个接口，分别是<strong>保存或更新看房预约</strong>、<strong>查询个人预约列表</strong>和<strong>根据ID查询预约详情信息</strong>，下面逐一实现</p>
<p>首先在<code>ViewAppointmentController</code>中注入<code>ViewAppointmentService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tag(name = &quot;看房预约信息&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/appointment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewAppointmentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ViewAppointmentService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-保存或更新看房预约"><a href="#1-保存或更新看房预约" class="headerlink" title="1. 保存或更新看房预约"></a>1. 保存或更新看房预约</h5><p>在<code>ViewAppointmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新看房预约&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> ViewAppointment viewAppointment)</span> &#123;</span><br><span class="line"></span><br><span class="line">    viewAppointment.setUserId(LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    service.saveOrUpdate(viewAppointment);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-查询个人预约看房列表"><a href="#2-查询个人预约看房列表" class="headerlink" title="2. 查询个人预约看房列表"></a>2. 查询个人预约看房列表</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-app模块</strong>下的<code>com.atguigu.lease.web.app.vo.appointment.AppointmentItemVo</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;APP端预约看房基本信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentItemVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;预约Id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;预约公寓名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apartmentName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; graphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;预约时间&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date appointmentTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;当前预约状态&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> AppointmentStatus appointmentStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ViewAppointmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;查询个人预约看房列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;listItem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;AppointmentItemVo&gt;&gt; <span class="title function_">listItem</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;AppointmentItemVo&gt; list = service.listItemByUserId(LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ViewAppointmentService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AppointmentItemVo&gt; <span class="title function_">listItemByUserId</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ViewAppointmentServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AppointmentItemVo&gt; <span class="title function_">listItemByUserId</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> viewAppointmentMapper.listItemByUserId(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>ViewAppointmentMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AppointmentItemVo&gt; <span class="title function_">listItemByUserId</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ViewAppointmentMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;AppointmentItemVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.appointment.AppointmentItemVo&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphVoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listItemByUserId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AppointmentItemVoMap&quot;</span>&gt;</span></span><br><span class="line">    select va.id,</span><br><span class="line">           va.appointment_time,</span><br><span class="line">           va.appointment_status,</span><br><span class="line">           ai.name apartment_name,</span><br><span class="line">           gi.name,</span><br><span class="line">           gi.url</span><br><span class="line">    from view_appointment va</span><br><span class="line">             left join apartment_info ai on va.apartment_id = ai.id and ai.is_deleted = 0</span><br><span class="line">             left join graph_info gi on gi.item_type = 1 and gi.item_id = ai.id and gi.is_deleted = 0</span><br><span class="line">    where va.is_deleted = 0</span><br><span class="line">      and va.user_id = #&#123;userId&#125;</span><br><span class="line">    order by va.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="3-根据ID查询预约详情信息"><a href="#3-根据ID查询预约详情信息" class="headerlink" title="3. 根据ID查询预约详情信息"></a>3. 根据ID查询预约详情信息</h5><ul>
<li><p><strong>查看相应的数据结构</strong></p>
<p>查看<code>web-app模块</code>下的<code>com.atguigu.lease.web.app.vo.appointment.AppointmentDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;APP端预约看房详情&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppointmentDetailVo</span> <span class="keyword">extends</span> <span class="title class_">ViewAppointment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓基本信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApartmentItemVo apartmentItemVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>ViewAppointmentController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据ID查询预约详情信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;AppointmentDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">AppointmentDetailVo</span> <span class="variable">appointmentDetailVo</span> <span class="operator">=</span> service.getDetailById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(appointmentDetailVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>ViewAppointmentService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AppointmentDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ViewAppointmentServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AppointmentDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ViewAppointment</span> <span class="variable">viewAppointment</span> <span class="operator">=</span> viewAppointmentMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">ApartmentItemVo</span> <span class="variable">apartmentItemVo</span> <span class="operator">=</span> apartmentInfoService.selectApartmentItemVoById(viewAppointment.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="type">AppointmentDetailVo</span> <span class="variable">agreementDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AppointmentDetailVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(viewAppointment, agreementDetailVo);</span><br><span class="line"></span><br><span class="line">    agreementDetailVo.setApartmentItemVo(apartmentItemVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> agreementDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="7-4-4-3-租约管理"><a href="#7-4-4-3-租约管理" class="headerlink" title="7.4.4.3 租约管理"></a>7.4.4.3 租约管理</h4><p>租约管理共有六个接口，分别是<strong>获取个人租约基本信息列表</strong>、<strong>根据ID获取租约详细信息</strong>、<strong>根据ID更新租约状态</strong>、<strong>保存或更新租约</strong>、<strong>根据房间ID获取可选支付方式</strong>和<strong>根据房间ID获取可选租期</strong>，下面逐一实现</p>
<p>首先在<code>LeaseAgreementController</code>中注入<code>LeaseAgreementService</code>，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app/agreement&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;租约信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaseAgreementController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LeaseAgreementService service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-获取个人租约基本信息列表"><a href="#1-获取个人租约基本信息列表" class="headerlink" title="1. 获取个人租约基本信息列表"></a>1. 获取个人租约基本信息列表</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-appp模块</strong>下的<code>com.atguigu.lease.web.app.vo.agreement.AgreementItemVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;租约基本信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgreementItemVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; roomGraphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apartmentName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约状态&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LeaseStatus leaseStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约开始日期&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date leaseStartDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约结束日期&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date leaseEndDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约来源&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LeaseSourceType sourceType;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租金&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal rent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取个人租约基本信息列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;listItem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;AgreementItemVo&gt;&gt; <span class="title function_">listItem</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;AgreementItemVo&gt; result = service.listItemByPhone(LoginUserHolder.getLoginUser().getUsername());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AgreementItemVo&gt; <span class="title function_">listItemByPhone</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AgreementItemVo&gt; <span class="title function_">listItemByPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> leaseAgreementMapper.listItemByPhone(phone);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Mapper层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementMapper</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AgreementItemVo&gt; <span class="title function_">listItemByPhone</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementMapper.xml</code>中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;AgreementItemVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.agreement.AgreementItemVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roomGraphVoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.lease.web.app.vo.graph.GraphVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listItemByPhone&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AgreementItemVoMap&quot;</span>&gt;</span></span><br><span class="line">    select la.id,</span><br><span class="line">           la.lease_start_date,</span><br><span class="line">           la.lease_end_date,</span><br><span class="line">           la.rent,</span><br><span class="line">           la.payment_type_id,</span><br><span class="line">           la.status lease_status,</span><br><span class="line">           la.source_type,</span><br><span class="line">           ai.name apartment_name,</span><br><span class="line">           ri.room_number,</span><br><span class="line">           gi.name,</span><br><span class="line">           gi.url</span><br><span class="line">    from lease_agreement la</span><br><span class="line">             left join apartment_info ai on la.apartment_id = ai.id and ai.is_deleted = 0</span><br><span class="line">             left join room_info ri on la.room_id = ri.id and ri.is_deleted = 0</span><br><span class="line">             left join graph_info gi on gi.item_type = 2 and gi.item_id = ri.id and gi.is_deleted = 0</span><br><span class="line">    where la.is_deleted = 0</span><br><span class="line">      and la.phone = #&#123;phone&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="2-根据ID获取租约详细信息"><a href="#2-根据ID获取租约详细信息" class="headerlink" title="2. 根据ID获取租约详细信息"></a>2. 根据ID获取租约详细信息</h5><ul>
<li><p><strong>查看响应的数据结构</strong></p>
<p>查看<strong>web-app模块</strong>下的<code>com.atguigu.lease.web.app.vo.agreement.AgreementDetailVo</code>，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;租约详细信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgreementDetailVo</span> <span class="keyword">extends</span> <span class="title class_">LeaseAgreement</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租约id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apartmentName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;公寓图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; apartmentGraphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomNumber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;房间图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GraphVo&gt; roomGraphVoList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;支付方式&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String paymentTypeName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租期月数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer leaseTermMonthCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;租期单位&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String leaseTermUnit;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id获取租约详细信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getDetailById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;AgreementDetailVo&gt; <span class="title function_">getDetailById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">AgreementDetailVo</span> <span class="variable">agreementDetailVo</span> <span class="operator">=</span> service.getDetailById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(agreementDetailVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>在<code>LeaseAgreementService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AgreementDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LeaseAgreementServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AgreementDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.查询租约信息</span></span><br><span class="line">    <span class="type">LeaseAgreement</span> <span class="variable">leaseAgreement</span> <span class="operator">=</span> leaseAgreementMapper.selectById(id);</span><br><span class="line">    <span class="keyword">if</span> (leaseAgreement == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.查询公寓信息</span></span><br><span class="line">    <span class="type">ApartmentInfo</span> <span class="variable">apartmentInfo</span> <span class="operator">=</span> apartmentInfoMapper.selectById(leaseAgreement.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.查询房间信息</span></span><br><span class="line">    <span class="type">RoomInfo</span> <span class="variable">roomInfo</span> <span class="operator">=</span> roomInfoMapper.selectById(leaseAgreement.getRoomId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.查询图片信息</span></span><br><span class="line">    List&lt;GraphVo&gt; roomGraphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.ROOM, leaseAgreement.getRoomId());</span><br><span class="line">    List&lt;GraphVo&gt; apartmentGraphVoList = graphInfoMapper.selectListByItemTypeAndId(ItemType.APARTMENT, leaseAgreement.getApartmentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.查询支付方式</span></span><br><span class="line">    <span class="type">PaymentType</span> <span class="variable">paymentType</span> <span class="operator">=</span> paymentTypeMapper.selectById(leaseAgreement.getPaymentTypeId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.查询租期</span></span><br><span class="line">    <span class="type">LeaseTerm</span> <span class="variable">leaseTerm</span> <span class="operator">=</span> leaseTermMapper.selectById(leaseAgreement.getLeaseTermId());</span><br><span class="line"></span><br><span class="line">    <span class="type">AgreementDetailVo</span> <span class="variable">agreementDetailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AgreementDetailVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(leaseAgreement, agreementDetailVo);</span><br><span class="line">    agreementDetailVo.setApartmentName(apartmentInfo.getName());</span><br><span class="line">    agreementDetailVo.setRoomNumber(roomInfo.getRoomNumber());</span><br><span class="line">    agreementDetailVo.setApartmentGraphVoList(apartmentGraphVoList);</span><br><span class="line">    agreementDetailVo.setRoomGraphVoList(roomGraphVoList);</span><br><span class="line">    agreementDetailVo.setPaymentTypeName(paymentType.getName());</span><br><span class="line">    agreementDetailVo.setLeaseTermMonthCount(leaseTerm.getMonthCount());</span><br><span class="line">    agreementDetailVo.setLeaseTermUnit(leaseTerm.getUnit());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> agreementDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="3-根据ID更新租约状态"><a href="#3-根据ID更新租约状态" class="headerlink" title="3. 根据ID更新租约状态"></a>3. 根据ID更新租约状态</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据id更新租约状态&quot;, description = &quot;用于确认租约和提前退租&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateStatusById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateStatusById</span><span class="params">(<span class="meta">@RequestParam</span> Long id, <span class="meta">@RequestParam</span> LeaseStatus leaseStatus)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;LeaseAgreement&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(LeaseAgreement::getId, id);</span><br><span class="line">    updateWrapper.set(LeaseAgreement::getStatus, leaseStatus);</span><br><span class="line">    service.update(updateWrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-保存或更新租约"><a href="#4-保存或更新租约" class="headerlink" title="4. 保存或更新租约"></a>4. 保存或更新租约</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseAgreementController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;保存或更新租约&quot;, description = &quot;用于续约&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;saveOrUpdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> LeaseAgreement leaseAgreement)</span> &#123;</span><br><span class="line">    service.saveOrUpdate(leaseAgreement);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="5-根据房间ID获取可选支付方式"><a href="#5-根据房间ID获取可选支付方式" class="headerlink" title="5. 根据房间ID获取可选支付方式"></a>5. 根据房间ID获取可选支付方式</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>PaymentTypeController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;根据房间id获取可选支付方式列表&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;listByRoomId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;PaymentType&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    List&lt;PaymentType&gt; list = service.listByRoomId(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>PaymentTypeService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;PaymentType&gt; <span class="title function_">listByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>PaymentTypeServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;PaymentType&gt; <span class="title function_">listByRoomId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> paymentTypeMapper.selectListByRoomId(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="6-根据房间ID获取可选租期"><a href="#6-根据房间ID获取可选租期" class="headerlink" title="6.根据房间ID获取可选租期"></a>6.根据房间ID获取可选租期</h5><ul>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LeaseTermController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;listByRoomId&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;根据房间id获取可选获取租期列表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;LeaseTerm&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">    List&lt;LeaseTerm&gt; list = service.listByRoomId(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>LeaseTermServcie</code>中曾加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;LeaseTerm&gt; <span class="title function_">listByRoomId</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>LeaseTermServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;LeaseTerm&gt; <span class="title function_">listByRoomId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> leaseTermMapper.selectListByRoomId(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-5-移动端前后端联调"><a href="#7-5-移动端前后端联调" class="headerlink" title="7.5 移动端前后端联调"></a>7.5 移动端前后端联调</h2><h3 id="7-5-1-启动后端项目"><a href="#7-5-1-启动后端项目" class="headerlink" title="7.5.1 启动后端项目"></a>7.5.1 启动后端项目</h3><p>启动后端项目，供前端调用接口。</p>
<h3 id="7-5-2-启动前端项目"><a href="#7-5-2-启动前端项目" class="headerlink" title="7.5.2 启动前端项目"></a>7.5.2 启动前端项目</h3><ol>
<li><p><strong>导入前端项目</strong></p>
<p>将移动端的前端项目（<strong>rentHouseH5</strong>）导入<code>vscode</code>或者<code>WebStorm</code>，打开终端，在项目根目录执行以下命令，安装所需依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置后端接口地址</strong></p>
<p>修改项目根目录下的<code>.env.development</code>文件中的<code>VITE_APP_BASE_URL</code>变量的值为后端接口的地址，此处改为<code>http://localhost:8081</code>即可,如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://localhost:8081&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>上述主机名和端口号需要根据实际情况进行修改。</p>
</li>
<li><p><strong>启动前端项目</strong></p>
<p>上述配置完成之后，便可执行以下命令启动前端项目了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问前端项目</strong></p>
<p>在浏览器中访问前端项目，并逐个测试每个页面的相关功能。</p>
</li>
</ol>
<h1 id="8-项目优化"><a href="#8-项目优化" class="headerlink" title="8. 项目优化"></a>8. 项目优化</h1><h2 id="8-1-缓存优化"><a href="#8-1-缓存优化" class="headerlink" title="8.1 缓存优化"></a>8.1 缓存优化</h2><h3 id="8-1-1-概述"><a href="#8-1-1-概述" class="headerlink" title="8.1.1 概述"></a>8.1.1 概述</h3><p>缓存优化是一个性价比很高的优化手段，多数情况下，缓存优化可以通过一些简单的操作，换来性能的大幅提升。缓存优化的核心思想就是将一些原本保存在磁盘（例如MySQL）中的、经常访问并且查询开销比较大的数据，临时保存到内存（例如Redis）中。后序再访问相同数据时，就可直接从内存中获取结果，而无需再访问磁盘，由于内存的读写速度远高于磁盘，因此就能极大的提高程序的性能。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019777.svg" style="zoom:50%;" /></p>
<p>在使用缓存优化时，有一个问题不得不提，那就是<strong>数据库和缓存数据的一致性</strong>，当数据库中的数据发生变化时，缓存中的数据也要同步更新，否则就会出现数据不一致的问题，解决该问题的方案有如下几个</p>
<ul>
<li>数据发生变化时，更新数据库的同时也更新缓存</li>
<li>数据发生变化时，更新数据库的同时删除缓存</li>
</ul>
<p>在了解了缓存优化的核心思想后，我们以移动端中的<code>根据ID获取房间详情</code>接口为例，进行缓存优化。该接口涉及多表查询，查询时会多次访问数据库，查询代价较高，故可采取缓存优化，加快查询速度。</p>
<h3 id="8-1-2-编写缓存逻辑"><a href="#8-1-2-编写缓存逻辑" class="headerlink" title="8.1.2 编写缓存逻辑"></a>8.1.2 编写缓存逻辑</h3><p><strong>1.自定义RedisTemplate</strong></p>
<p>本项目使用Reids保存缓存数据，因此我们需要使用RedisTemplate进行读写操作。前文提到过，<code>Spring-data-redis</code>提供了<code>StringRedisTemplate</code>和<code>RedisTemplate&lt;Object,Object&gt;</code>两个实例，但是两个实例均不满足我们当前的需求，所以我们需要自定义RedisTemplate。</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.redis.RedisConfiguration</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">stringObjectRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setValueSerializer(RedisSerializer.java());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.编写缓存逻辑</strong></p>
<p>修改<strong>web-app模块</strong>中的<code>com.atguigu.lease.web.app.service.impl.RoomInfoServiceImpl</code>中的<code>getDetailById</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> RoomDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.APP_ROOM_PREFIX + id;</span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">roomDetailVo</span> <span class="operator">=</span> (RoomDetailVo) redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (roomDetailVo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//1.查询房间信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.查询图片</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.查询租期</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.查询配套</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.查询标签</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.查询支付方式</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.查询基本属性</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//8.查询杂费信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.查询公寓信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        roomDetailVo = <span class="keyword">new</span> <span class="title class_">RoomDetailVo</span>();</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(key, roomDetailVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//10.保存浏览历史</span></span><br><span class="line">    browsingHistoryService.saveHistory(LoginUserHolder.getLoginUser().getUserId(), id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> roomDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.编写删除缓存逻辑</strong></p>
<p>为保证缓存数据的一致性，在房间信息发生变化时，需要删除相关缓存。</p>
<p>修改<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.service.impl.RoomInfoServiceImpl</code>中的<code>saveOrUpdateRoom</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdateRoom</span><span class="params">(RoomSubmitVo roomSubmitVo)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isUpdate</span> <span class="operator">=</span> roomSubmitVo.getId() != <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">super</span>.saveOrUpdate(roomSubmitVo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//若为更新操作，则先删除与Room相关的各项信息列表</span></span><br><span class="line">    <span class="keyword">if</span> (isUpdate) &#123;</span><br><span class="line">        <span class="comment">//1.删除原有graphInfoList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.删除原有roomAttrValueList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.删除原有roomFacilityList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.删除原有roomLabelList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.删除原有paymentTypeList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.删除原有leaseTermList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.删除缓存</span></span><br><span class="line">        redisTemplate.delete(RedisConstant.APP_LOGIN_PREFIX + roomSubmitVo.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.保存新的graphInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.保存新的roomAttrValueList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.保存新的facilityInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.保存新的labelInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.保存新的paymentTypeList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.保存新的leaseTermList</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.service.impl.RoomInfoServiceImpl</code>中的<code>removeRoomById</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeRoomById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.删除RoomInfo</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除graphInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.删除attrValueList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除facilityInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.删除labelInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.删除paymentTypeList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.删除leaseTermList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8.删除缓存</span></span><br><span class="line">    redisTemplate.delete(RedisConstant.APP_ROOM_PREFIX + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-1-3-压力测试"><a href="#8-1-3-压力测试" class="headerlink" title="8.1.3 压力测试"></a>8.1.3 压力测试</h3><p>可使用Postman或者Apifox等工具对<code>根据ID获取房间详情</code>这个接口进行压力测试，下图是增加缓存前后的测试报告</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019812.png" style="border:solid 1px" /></p>
<h1 id="9-部署准备"><a href="#9-部署准备" class="headerlink" title="9. 部署准备"></a>9. 部署准备</h1><h2 id="9-1-部署方案"><a href="#9-1-部署方案" class="headerlink" title="9.1 部署方案"></a>9.1 部署方案</h2><p>本章使用虚拟机模拟服务器，完成前后端项目的部署，我们使用两台虚拟机分别部署前端和后端项目，具体的部署方案如下图所示。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019813.svg" alt=""></p>
<p>上述方案中，<code>server-01</code>用于部署移动端和后台管理系统的两个后端服务。<code>server02</code>部署Nginx，作为移动端和后台管理系统两个前端项目的web服务器，同时也作为两个后端服务的反向代理。也就是说Nginx作为所有请求的入口，若请求内容是静态资源，Nginx便直接返回；若请求的内容为动态资源（后端服务接口），Nginx便代理请求后端服务，然后将结果响应给客户端。</p>
<p><strong>知识点</strong>：</p>
<p><strong>代理</strong></p>
<p>上述方案中提到了<strong>反向代理</strong>，下面系统的介绍一下<strong>代理（Proxy）</strong>这一概念。</p>
<p>这里的<strong>代理</strong>，是指在网络通信中，介于客户端和服务端之间的一个服务，客户端将请求发往代理服务，代理服务将请求转发到服务端，得到服务端响应后，再将结果响应为客户端，这一过程如下图所示。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019814.svg" style="zoom: 80%;" /></p>
<p>下面介绍一下<strong>代理</strong>的两种类型——<strong>正向代理</strong>和<strong>反向代理</strong>，首先需要明确的是，两者的本质是相同的，都是位于客户端和服务端之间的一个”中间人“，只是两者代表的对象不同，正向代理是代表客户端向服务端发送请求，而反向代理是代表服务端接收客户端的请求。</p>
<p>下面是正向代理和反向代理的两个案例：</p>
<ul>
<li><p><strong>正向代理</strong></p>
<p>某校园为了阻止学生沉迷于网络游戏，设计了一个防火墙，封锁了所有的游戏网站。聪明的小明同学，通过一个代理服务器，绕过了防火墙的封锁，这个代理服务器就是一个典型的正向代理。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019815.png" style="zoom:50%;" /></p>
</li>
<li><p><strong>反向代理</strong></p>
<p>某电商平台由于日益增长的访问量，一台单一的后端服务器已经不能满足高并发的要求了，这时需要增设多个后端服务器，来分担压力。但是如何能够将客户端的请求均匀的分发到这多个后端服务器呢？一个最常用的方案便是使用代理服务，具体来讲，就是使用一个代理服务代表后端服务器接收请求，然后由代理服务将请求均匀的转发到多个后端服务器，这个代理服务就是一个典型的反向代理。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019816.png" style="zoom:50%;" /></p>
</li>
</ul>
<h2 id="9-2-Nginx快速入门"><a href="#9-2-Nginx快速入门" class="headerlink" title="9.2 Nginx快速入门"></a>9.2 Nginx快速入门</h2><h3 id="9-2-1-Nginx安装"><a href="#9-2-1-Nginx安装" class="headerlink" title="9.2.1 Nginx安装"></a>9.2.1 Nginx安装</h3><p>根据前文的部署方案，需要在<code>server02</code>部署Nginx。Nginx官网有详细的安装步骤，具体内容可参考<a target="_blank" rel="noopener" href="https://nginx.org/en/linux_packages.html">官方文档</a>。</p>
<ol>
<li><p><strong>配置Nginx yum存储库</strong></p>
<p>创建<code>/etc/yum.repos.d/nginx.repo</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure>
<p>增加如下内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[nginx-stable]</span></span><br><span class="line"><span class="attr">name</span>=nginx stable repo</span><br><span class="line"><span class="attr">baseurl</span>=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=https://nginx.org/keys/nginx_signing.key</span><br><span class="line"><span class="attr">module_hotfixes</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[nginx-mainline]</span></span><br><span class="line"><span class="attr">name</span>=nginx mainline repo</span><br><span class="line"><span class="attr">baseurl</span>=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">gpgkey</span>=https://nginx.org/keys/nginx_signing.key</span><br><span class="line"><span class="attr">module_hotfixes</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在线安装Nginx</strong></p>
<p>执行以下命令，安装Nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动Nginx</strong></p>
<p>执行以下命令启动Nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure>
<p>执行以下命令查看Nginx运行状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure>
<p>执行以下命令设置开机自启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问Nginx服务默认首页</strong></p>
<p>访问<code>http://192.168.10.102</code>，能访问到如下页面，则证明Nginx运行正常。</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019817.png" style="zoom:50%;" /></p>
</li>
</ol>
<h3 id="9-2-2-重要的目录、文件"><a href="#9-2-2-重要的目录、文件" class="headerlink" title="9.2.2 重要的目录、文件"></a>9.2.2 重要的目录、文件</h3><p>Nginx中有很多十分重要的目录或者文件，下面对核心内容进行介绍</p>
<ol>
<li><strong>配置文件相关</strong><ul>
<li><code>/etc/nginx/</code>：主要的Nginx配置文件目录。</li>
<li><code>/etc/nginx/nginx.conf</code>：Nginx的主配置文件，包含全局配置信息。</li>
</ul>
</li>
<li><strong>日志相关</strong><ul>
<li><code>/var/log/nginx/</code>：Nginx的日志文件目录，包括访问日志和错误日志。</li>
<li><code>/var/log/nginx/access.log</code>：访问日志，记录所有进入服务器的请求。</li>
<li><code>/var/log/nginx/error.log</code>：错误日志，记录服务器处理过程中的错误信息。</li>
</ul>
</li>
</ol>
<h3 id="9-2-3-配置文件概述"><a href="#9-2-3-配置文件概述" class="headerlink" title="9.2.3 配置文件概述"></a>9.2.3 配置文件概述</h3><ol>
<li><p><strong>配置文件结构</strong></p>
<p><code>nginx.conf</code>文件层次分明，整个文件分为多个区块（block），每个区块下可配置各种参数，也可包含其子级区块，具体结构如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019819.png" style="zoom:50%;" /></p>
<p><code>nginx.conf</code>通过<code>include /etc/nginx/conf.d/*.conf</code>引入了<code>/etc/nginx/conf.d</code>目录下的所有<code>.conf</code>文件，该目录下的配置文件结构如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019820.png" style="zoom: 50%;" /></p>
</li>
<li><p><strong>重要配置说明</strong></p>
<p>下面分块介绍重要的配置参数</p>
<ul>
<li><p><strong>main block</strong></p>
<p><code>main block</code>位于配置文件的最外层，其包含了影响Nginx服务器整体行为的全局参数，例如</p>
<ul>
<li><code>user</code>：定义Nginx工作进程的用户和用户组。</li>
<li><code>worker_processes</code>：指定Nginx使用的工作进程数。</li>
<li><code>error_log</code>：配置全局错误日志文件路径。</li>
</ul>
</li>
<li><p><strong>events block</strong></p>
<p><code>events block</code>位于<code>main block</code>中，用于配置Nginx服务器的事件处理机制，主要配置Nginx如何处理客户端连接。</p>
</li>
<li><p><strong>http block</strong></p>
<p><code>http block</code>位于<code>main block</code>中，用于配置HTTP服务器相关功能。例如</p>
<ul>
<li><code>access_log</code>：指定访问日志的路径</li>
<li><code>log_format</code>：指定访问日志的格式</li>
</ul>
</li>
<li><p><strong>server block</strong></p>
<p><code>server block</code>位于<code>http block</code>，用于配置虚拟主机，一个Nginx服务可包含多个虚拟主机，每个虚拟主机都可以独立的提供服务，因此借助Nginx，我们可以在一台服务器部署多个独立的网站，如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019821.png" style="zoom:50%;" /></p>
<p>每个虚拟主机使用一个<code>server block</code>进行配置，配置的内容包括</p>
<ul>
<li><code>listen</code>：虚拟主机监听的端口号。</li>
<li><code>server_name</code>：指定虚拟主机的域名或者IP。</li>
</ul>
</li>
<li><p><strong>location block</strong></p>
<p><code>location block</code>位于<code>server block</code>，用于配置请求的处理逻辑，一个<code>server block</code>中可以包含多个<code>location block</code>，例如</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.atguigu.com;</span><br><span class="line">    <span class="section">location</span> /index &#123;</span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /api &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend-api;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="9-2-4-静态资源服务器案例"><a href="#9-2-4-静态资源服务器案例" class="headerlink" title="9.2.4 静态资源服务器案例"></a>9.2.4 静态资源服务器案例</h3><p>下面完成一个简单案例，使用Nginx作为静态资源服务器。</p>
<p>项目资料中有一个简单的前端项目<code>hello-nginx</code>，其中只包含html、css等静态资源，现将其部署在<code>server02</code>上。</p>
<ol>
<li><p><strong>上传静态资源到服务器</strong></p>
<p>将<code>hello-nginx.zip</code>上传到<code>server02</code>服务器任意路径。</p>
</li>
<li><p><strong>解压<code>hello-nginx.zip</code>到<code>/usr/share/nginx/html</code>中</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip hello-nginx.zip -d /usr/share/nginx/html</span><br></pre></td></tr></table></figure>
<p>最终的路径结构如下</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">└── share</span><br><span class="line">    └── nginx</span><br><span class="line">        └── html</span><br><span class="line">            └── hello-nginx</span><br><span class="line">                ├── css</span><br><span class="line">                │   └── style.css</span><br><span class="line">                ├── images</span><br><span class="line">                │   └── img.png</span><br><span class="line">                └── index.html</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置Nginx虚拟主机</strong></p>
<p>虚拟主机的配置应位于<code>/etc/nginx/nginx.conf</code>的<strong>server block</strong>中，由于<code>/etc/nginx/nginx.conf</code>的<strong>http bolck</strong>中引入了<code>/etc/nginx/conf.d/*.conf</code>，所以虚拟主机在<code>/etc/nginx/conf.d/</code>目录下的任意<code>.conf</code>文件配置即可。</p>
<ul>
<li><p>创建<code>/etc/nginx/conf.d/hello-nginx.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/hello-nginx.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加如下内容</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">192.168.10.102</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /hello-nginx &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">        <span class="attribute">index</span>  index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载Nginx的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>访问项目</strong></p>
<p>访问路径为<a target="_blank" rel="noopener" href="http://192.168.10.102:8080/hello-nginx，若部署成功，可见到如下页面">http://192.168.10.102:8080/hello-nginx，若部署成功，可见到如下页面</a></p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019822.png" style="zoom: 67%;" /></p>
</li>
<li><p><strong>案例剖析</strong></p>
<p>下面通过上述案例来了解Ngxin处理请求的逻辑。</p>
<ul>
<li><p><strong>匹配server</strong></p>
<p>由于Nginx中可存在多个虚拟主机的配置，故接收到一个请求后，Nginx首先要确定请求交给哪个虚拟主机进行处理。这很显然是根据<code>server_name</code>和<code>listen</code>进行判断的。例如上述的请求路径<a target="_blank" rel="noopener" href="http://192.168.10.102:8080/hello-nginx，就会匹配到以下的虚拟主机">http://192.168.10.102:8080/hello-nginx，就会匹配到以下的虚拟主机</a></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">192.168.10.102</span>;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>匹配location</strong></p>
<p>由于一个<strong>server block</strong>中可能包含多个<strong>location block</strong>，故Nginx在完成<strong>server</strong>匹配后，还要匹配<strong>location</strong>，<strong>location</strong>的匹配是根据请求路径进行判断的。例如以下写法<code>location</code>关键字后边的<code>/hello-nginx</code>就是匹配规则，它表达的含义是匹配以<code>/hello-nginx</code>为前缀的请求，例如上述的<a target="_blank" rel="noopener" href="http://192.168.10.102:8080/hello-nginx请求就会匹配到该**location**，而">http://192.168.10.102:8080/hello-nginx请求就会匹配到该**location**，而</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.10.102:8080/nginx则不会。">http://192.168.10.102:8080/nginx则不会。</a></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /hello-nginx &#123;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>定位文件</strong></p>
<p>完成<strong>location</strong>的匹配后，Nginx会以<strong>location block</strong>中的<code>root</code>作为根目录，然后查找请求路径对应的资源，例如以下配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /hello-nginx &#123;</span><br><span class="line">    <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">    <span class="attribute">index</span>  index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当请求<a target="_blank" rel="noopener" href="http://192.168.10.102:8080/hello-nginx">http://192.168.10.102:8080/hello-nginx</a> 时，Ngxin会在<code>/usr/share/nginx/html/hello-nginx</code>路径中查找资源，由于该路径为<strong>目录</strong>（而非文件），故Nginx会在该目录下寻找<code>index</code>，也就是上述配置的<code>index.html</code>。然后将<code>index.html</code>响应给客户端。至此，该请求的处理就结束了。</p>
<p><strong>注意</strong>：上述提到的<strong>server_name</strong>和<strong>location</strong>均有多种匹配模式，例如精确匹配、前缀匹配、正则匹配，此处不再展开。</p>
</li>
</ul>
</li>
</ol>
<h3 id="9-2-5-反向代理案例"><a href="#9-2-5-反向代理案例" class="headerlink" title="9.2.5 反向代理案例"></a>9.2.5 反向代理案例</h3><p>下面完成一个简单案例，使用Nginx作为反向代理。</p>
<p>使用Nginx反向代理其他网站，比如<code>http://www.atguigu.com</code>。</p>
<ol>
<li><p><strong>配置虚拟主机</strong></p>
<p>创建<code>/etc/nginx/conf.d/hello-proxy.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/hello-proxy.conf</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">9090</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">192.168.10.102</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://www.atguigu.com;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重新加载Nginx配置文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>观察代理效果</strong></p>
<p>使用浏览器访问<a href="http://192.168.10.102:9090，观察响应结果。">http://192.168.10.102:9090，观察响应结果。</a></p>
</li>
</ol>
<p><strong>注意</strong>：借助反向代理功能，Nginx可以实现负载均衡等高级功能，此处不再展开。</p>
<h2 id="9-3-配置域名映射"><a href="#9-3-配置域名映射" class="headerlink" title="9.3 配置域名映射"></a>9.3 配置域名映射</h2><p>现实生活中，几乎所有的网站都是通过域名去访问。真正的域名需要付费购买，此处在宿主机本地配置一下域名映射，模拟一下域名的效果即可。</p>
<p>我们准备两个域名<code>lease.atguigu.com</code>和<code>admin.lease.atguigu.com</code>，前者用于访问移动端网站，后者用于访问后台管理系统。由于两个前端项目都部署在<code>server02</code>上，所以两个域名均指向<code>server02</code>的IP。</p>
<p>Windows的域名映射配置文件位于<code>C:\Windows\System32\drivers\etc\hosts</code>，需要使用管理员身份修改。使用管理员身份运行任意文本编辑器，然后使用其打开<code>hosts</code>文件，并增加如下内容：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.102 lease.atguigu.com admin.lease.atguigu.com</span><br></pre></td></tr></table></figure>
<p>修改完毕记得保存。</p>
<h1 id="10-项目部署"><a href="#10-项目部署" class="headerlink" title="10. 项目部署"></a>10. 项目部署</h1><h2 id="10-1-部署后端项目"><a href="#10-1-部署后端项目" class="headerlink" title="10.1 部署后端项目"></a>10.1 部署后端项目</h2><h3 id="10-1-1-打包"><a href="#10-1-1-打包" class="headerlink" title="10.1.1 打包"></a>10.1.1 打包</h3><p>使用IDEA的maven插件对项目进行打包，完成后，在<strong>web-admin</strong>和<strong>web-app</strong>模块的<code>target</code>目录下找到<code>web-admin-1.0-SNAPSHOT.jar</code>和<code>web-app-1.0-SNAPSHOT.jar</code>。</p>
<h3 id="10-1-2-安装JDK"><a href="#10-1-2-安装JDK" class="headerlink" title="10.1.2 安装JDK"></a>10.1.2 安装JDK</h3><p>根据前文的部署方案，需要在<code>server01</code>部署后端服务，因此需要在<code>server01</code>中安装JDK，本项目采用JDK17。</p>
<ol>
<li><strong>获取JDK安装包</strong></li>
</ol>
<p>将资料中提前下载好的JDK上传到<code>server01</code>，也在服务器执行以下命令可直接下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/17/archive/jdk-17.0.8_linux-x64_bin.tar.gz</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>解压JDK安装包</strong></li>
</ol>
<p>执行以下命令将jdk解压到<code>/opt</code>目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-17.0.8_linux-x64_bin.tar.gz -C /opt</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>测试JDK安装效果</strong></li>
</ol>
<p>执行以下命令，观察输出是否正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/jdk-17.0.8/bin/java -version</span><br></pre></td></tr></table></figure>
<h3 id="10-1-3-部署"><a href="#10-1-3-部署" class="headerlink" title="10.1.3 部署"></a>10.1.3 部署</h3><ol>
<li><p><strong>上传jar包</strong></p>
<p>将后端项目的两个jar包上传到<code>server01</code>服务器的<code>/opt/lease</code>目录下，若目录不存在，自行创建即可。</p>
</li>
<li><p><strong>集成Systemd</strong></p>
<p>为方便项目的启动、停止或者重启，我们同样使用Systemd来管理后端服务的进程。</p>
<ul>
<li><p><strong>移动端集成Systemd</strong></p>
<p>创建<code>lease-app.service</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/lease-app.service</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=lease-app</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/opt/jdk-17.0.8/bin/java -jar /opt/lease/web-app-1.0-SNAPSHOT.jar 1&gt;/opt/lease/app.log 2&gt;&amp;1</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>后台管理系统集成Systemd</strong></p>
<p>创建<code>lease-admin.service</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/lease-admin.service</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=lease-admin</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/opt/jdk-17.0.8/bin/java -jar /opt/lease/web-admin-1.0-SNAPSHOT.jar 1&gt;/opt/lease/admin.log 2&gt;&amp;1</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p><strong>启动项目</strong></p>
<p>执行以下命令启动两个后端项目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start lease-app</span><br><span class="line">systemctl start lease-admin</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="10-2-部署前端项目"><a href="#10-2-部署前端项目" class="headerlink" title="10.2 部署前端项目"></a>10.2 部署前端项目</h2><h3 id="10-2-1-Nginx配置概述"><a href="#10-2-1-Nginx配置概述" class="headerlink" title="10.2.1 Nginx配置概述"></a>10.2.1 Nginx配置概述</h3><p>移动端和后台管理系统的前端项目均部署在<code>server02</code>的Nginx中，Nginx的配置思路如下图所示</p>
<p><img src="https://gitee.com/NorthCJ/north-img/raw/master/images/202412021019823.png" style="zoom:50%;" /></p>
<h3 id="10-2-1-移动端"><a href="#10-2-1-移动端" class="headerlink" title="10.2.1 移动端"></a>10.2.1 移动端</h3><h4 id="10-2-1-1-打包"><a href="#10-2-1-1-打包" class="headerlink" title="10.2.1.1 打包"></a>10.2.1.1 打包</h4><ol>
<li><p><strong>明确前端请求的后端接口地址</strong></p>
<p>打包之前需要明确前端请求的后台接口地址，根据前文的部署规划，前端请求后台接口时走的是Ngxin反向代理，也就是请求的地址为<code>http://lease.atguigu.com</code>。</p>
<p>所以我们需要修改<code>.env.production</code>文件中<code>VITE_APP_BASE_URL</code>环境变量的值，修改结果如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://lease.atguigu.com&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>构建项目</strong></p>
<p>在项目的根目录执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看打包结果</strong></p>
<p>观察项目的根目录是否出现<code>dist</code>目录</p>
</li>
</ol>
<h4 id="10-2-1-2-部署"><a href="#10-2-1-2-部署" class="headerlink" title="10.2.1.2 部署"></a>10.2.1.2 部署</h4><ol>
<li><p><strong>上传dist文件</strong></p>
<p>将<code>rentHouseH5</code>项目编译得到<code>dist</code>文件上传至<code>server02</code>服务器的<code>/usr/share/nginx/html/app</code>目录下。</p>
<p>最终的目录结构为</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">└── share</span><br><span class="line">    └── nginx</span><br><span class="line">        └── html</span><br><span class="line">            └── app</span><br><span class="line">                ├── static</span><br><span class="line">                └── index.html</span><br><span class="line">                └── ...              </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编辑Nginx配置文件</strong></p>
<p>创建<code>/etc/nginx/conf.d/app.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/app.conf</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  lease.atguigu.com;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html/app;</span><br><span class="line">        <span class="attribute">index</span>  index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /app &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.10.101:8081;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重新加载Nginx配置文件</strong></p>
<p>执行以下命令重新加载配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问项目</strong></p>
<p>访问<a target="_blank" rel="noopener" href="http://lease.atguigu.com">http://lease.atguigu.com</a></p>
</li>
</ol>
<h3 id="10-2-2-后台管理系统"><a href="#10-2-2-后台管理系统" class="headerlink" title="10.2.2 后台管理系统"></a>10.2.2 后台管理系统</h3><h4 id="10-2-2-1-打包"><a href="#10-2-2-1-打包" class="headerlink" title="10.2.2.1 打包"></a>10.2.2.1 打包</h4><ol>
<li><p><strong>明确前端请求的后端接口地址</strong></p>
<p>后台管理系统的前端请求后端接口时，同样会走Nginx反向代理，故其请求的接口地址为<code>http://admin.lease.atguigu.com</code>。</p>
<p>确保<strong>rentHouseAdmin</strong>项目中的<code>.env.production</code>文件中的<code>VITE_APP_BASE_URL</code>环境变量配置为如下内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://admin.lease.atguigu.com&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>打包</strong></p>
<p>在项目根目录执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看打包结果</strong></p>
<p>观察项目的根目录是否出现<code>dist</code>目录</p>
</li>
</ol>
<h4 id="10-2-2-2-部署"><a href="#10-2-2-2-部署" class="headerlink" title="10.2.2.2 部署"></a>10.2.2.2 部署</h4><ol>
<li><p><strong>上传dist文件</strong></p>
<p>将<code>rentHouseAdmin</code>项目编译得到<code>dist</code>文件上传至<code>server02</code>服务器的<code>/usr/share/nginx/html/admin</code>目录下。</p>
<p>最终的目录结构为</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">└── share</span><br><span class="line">    └── nginx</span><br><span class="line">        └── html</span><br><span class="line">            └── admin</span><br><span class="line">                ├── assets</span><br><span class="line">                └── index.html</span><br><span class="line">                └── ...</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编辑Nginx配置文件</strong></p>
<p>创建<code>/etc/nginx/conf.d/admin.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/admin.conf</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  admin.lease.atguigu.com;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html/admin;</span><br><span class="line">        <span class="attribute">index</span>  index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /admin &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.10.101:8080;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重新加载Nginx配置文件</strong></p>
<p>执行以下命令重新加载配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问项目</strong></p>
<p>访问<a target="_blank" rel="noopener" href="http://admin.lease.atguigu.com">http://admin.lease.atguigu.com</a></p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>尚庭公寓学习笔记</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://lunanorth.github.io/posts/12915.html">https://lunanorth.github.io/posts/12915.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>捞月亮の小北</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2024-12-02</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-12-02</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/">项目相关笔记</a></div><div class="post_share"><div class="social-share" data-image="https://s21.ax1x.com/2024/12/02/pAIY7qg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/posts/61071.html" title="Knife4j 快速入门"><img class="cover" src="https://s21.ax1x.com/2024/11/18/pARWib6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Knife4j 快速入门</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/61071.html" title="Knife4j 快速入门"><img class="cover" src="https://s21.ax1x.com/2024/11/18/pARWib6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-18</div><div class="title">Knife4j 快速入门</div></div></a></div><div><a href="/posts/33591.html" title="项目开发流程"><img class="cover" src="https://s21.ax1x.com/2024/10/22/pAdE3Ke.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-22</div><div class="title">项目开发流程</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">捞月亮の小北</div><div class="author-info__description">言念君子 ，温其如玉</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://lunanorth.github.io/"><i class="fab fa-github"></i><span>剑气长安</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">请不要把陌生人的些许善意，视为珍稀的瑰宝，却把身边亲近人的全部付出，当做天经地义的事情，对其视而不见!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-text">1. 项目概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E9%A1%B9%E7%9B%AE%E4%B8%9A%E5%8A%A1%E6%A6%82%E8%BF%B0"><span class="toc-text">1.1 项目业务概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-%E7%A7%BB%E5%8A%A8%E7%AB%AF"><span class="toc-text">1.1.1 移动端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-text">1.1.2 后台管理系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-3-%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-text">1.1.3 核心业务流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0"><span class="toc-text">1.2 项目技术概述</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">2. 项目开发流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E5%8E%9F%E5%9E%8B"><span class="toc-text">3. 项目原型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-text">4. 数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E7%90%86%E8%AE%BA"><span class="toc-text">4.1 数据库设计理论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.1.1 数据库模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-text">4.1.2 数据库设计流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-1-%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.1.2.1 概念模型设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-2-%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.1.2.2 逻辑模型设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-3-%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.1.2.3 物理模型设计</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E5%AE%9E%E6%93%8D"><span class="toc-text">4.2 数据库设计实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.2.1 概念模型设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.2.2 逻辑模型设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-1-%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.1 公寓信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-2-%E6%88%BF%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.2 房间信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-3-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.3 用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-4-%E7%9C%8B%E6%88%BF%E9%A2%84%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.4 看房预约信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-5-%E7%A7%9F%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.5 租约信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-6-%E6%B5%8F%E8%A7%88%E5%8E%86%E5%8F%B2%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.6 浏览历史信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-7-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.2.7 后台管理用户信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.2.3 物理模型设计</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-text">5. 接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-text">5.1 后台管理系统接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.1 公寓信息管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-1-%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.1.1 属性管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-2-%E5%85%AC%E5%AF%93%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.1.2 公寓管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-3-%E6%88%BF%E9%97%B4%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.1.3 房间管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E7%A7%9F%E8%B5%81%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.2 租赁管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-1-%E9%A2%84%E7%BA%A6%E7%9C%8B%E6%88%BF%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.2.1 预约看房管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-2-%E7%A7%9F%E7%BA%A6%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.2.2 租约管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.3 用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-1-%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.1.3.1 用户列表页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-4-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.4 系统管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-1-%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E5%B2%97%E4%BD%8D%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.4.1 系统用户岗位管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-2-%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.4.2 系统用户信息管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-5-%E7%99%BB%E5%BD%95%E7%AE%A1%E7%90%86"><span class="toc-text">5.1.5 登录管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-5-1-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.1.5.1 登录页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-text">5.2 移动端接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-%E7%99%BB%E5%BD%95"><span class="toc-text">5.2.1 登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-1-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.2.1.1 登录页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E6%89%BE%E6%88%BF"><span class="toc-text">5.2.2 找房</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-1-%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.2.2.1 房间列表页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-2-%E6%88%BF%E9%97%B4%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.2.2.2 房间详情页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-3-%E5%85%AC%E5%AF%93%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2"><span class="toc-text">5.2.2.3 公寓详情页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-text">5.2.3 个人中心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-1-%E6%B5%8F%E8%A7%88%E5%8E%86%E5%8F%B2"><span class="toc-text">5.2.3.1 浏览历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-2-%E7%9C%8B%E6%88%BF%E9%A2%84%E7%BA%A6"><span class="toc-text">5.2.3.2 看房预约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-3-%E7%A7%9F%E7%BA%A6%E7%AE%A1%E7%90%86"><span class="toc-text">5.2.3.3 租约管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-%E6%88%91%E7%9A%84%E6%88%BF%E9%97%B4"><span class="toc-text">5.2.4 我的房间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-%E5%9C%88%E5%AD%90"><span class="toc-text">5.2.5 圈子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-6-%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5"><span class="toc-text">5.2.6 消息通知</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="toc-text">6. 开发准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%87%86%E5%A4%87%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">6.1 准备开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E5%87%86%E5%A4%87Linux%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">6.1.1 准备Linux虚拟机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-1-Linux%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.1.1.1 Linux快速入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-2-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><span class="toc-text">6.1.1.2 开发环境要求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E9%83%A8%E7%BD%B2MySQL"><span class="toc-text">6.1.2 部署MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-%E9%83%A8%E7%BD%B2Redis"><span class="toc-text">6.1.3 部署Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-4-%E9%83%A8%E7%BD%B2MinIO"><span class="toc-text">6.1.4 部署MinIO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E6%8A%80%E6%9C%AF%E5%82%A8%E5%A4%87"><span class="toc-text">6.2 技术储备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-MyBatis-Plus%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.2.1 MyBatis Plus快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">6.2.2.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87"><span class="toc-text">6.2.2.2 数据库准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-3-%E4%B8%8ESpringBoot%E9%9B%86%E6%88%90"><span class="toc-text">6.2.2.3 与SpringBoot集成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-4-%E9%80%9A%E7%94%A8Mapper"><span class="toc-text">6.2.2.4 通用Mapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-5-%E9%80%9A%E7%94%A8Service"><span class="toc-text">6.2.2.5 通用Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-6-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-text">6.2.2.6 条件构造器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-7-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text">6.2.2.7 分页插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-8-MyBatisX%E6%8F%92%E4%BB%B6"><span class="toc-text">6.2.2.8 MyBatisX插件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-MinIO%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.2.2 MinIO快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-1-MinIO%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">6.2.2.1 MinIO核心概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-2-MinIO%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C"><span class="toc-text">6.2.2.2 MinIO管理页面操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-3-MinIO-Java-SDK"><span class="toc-text">6.2.2.3 MinIO Java SDK</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-Redis%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.2.3 Redis快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-1-Redis%E6%A6%82%E8%BF%B0"><span class="toc-text">6.2.3.1 Redis概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-2-Reids%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">6.2.3.2 Reids客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-3-Redis%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.3.3 Redis常用数据类型及命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-1-%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.3.3.1 通用命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-2-string%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.2.3.3.2 string类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-3-list%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.2.3.3.3 list类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-4-set%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.2.3.3.4 set类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-5-hash%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.2.3.3.5 hash类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-3-6-zset%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.2.3.3.6 zset类型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-4-SpringBoot%E6%95%B4%E5%90%88Redis"><span class="toc-text">6.2.3.4 SpringBoot整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-4-1-Spring-Data-Redis%E6%A6%82%E8%BF%B0"><span class="toc-text">6.2.3.4.1 Spring Data Redis概述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-3-4-2-Spring-Data-Redis%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.2.3.4.2 Spring Data Redis快速入门</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-Knife4j%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">6.2.4 Knife4j快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-4-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">6.2.4.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-4-2-%E4%B8%8ESpringBoot%E9%9B%86%E6%88%90"><span class="toc-text">6.2.4.2 与SpringBoot集成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-4-3-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">6.2.4.3 基本使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91"><span class="toc-text">7. 项目开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">7.1 项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">7.1.1 数据库初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-text">7.1.2 创建工程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-text">7.2 后台管理系统后端开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE"><span class="toc-text">7.2.1 项目初始配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-1-SpringBoot%E9%85%8D%E7%BD%AE"><span class="toc-text">7.2.1.1 SpringBoot配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-2-Mybatis-Plus%E9%85%8D%E7%BD%AE"><span class="toc-text">7.2.1.2 Mybatis-Plus配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-3-Knife4j%E9%85%8D%E7%BD%AE"><span class="toc-text">7.2.1.3 Knife4j配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-3-%E7%94%9F%E6%88%90%E6%88%96%E5%AF%BC%E5%85%A5%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81"><span class="toc-text">7.2.1.3 生成或导入基础代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-4-%E5%AF%BC%E5%85%A5%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%A0%81"><span class="toc-text">7.2.1.4 导入接口定义代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2 公寓信息管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-1-%E6%88%BF%E9%97%B4%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.1 房间支付方式管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F%E5%88%97%E8%A1%A8"><span class="toc-text">1. 查询全部支付方式列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="toc-text">2. 保存或更新支付方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="toc-text">3. 根据ID删除支付方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-2-%E6%88%BF%E9%97%B4%E7%A7%9F%E6%9C%9F%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.2 房间租期管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-3-%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.3 标签管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E6%9F%A5%E8%AF%A2%E6%A0%87%E7%AD%BE%E5%88%97%E8%A1%A8"><span class="toc-text">1. [根据类型]查询标签列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E6%A0%87%E7%AD%BE%E4%BF%A1%E6%81%AF"><span class="toc-text">2.保存或更新标签信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E6%A0%87%E7%AD%BE"><span class="toc-text">3. 根据ID删除标签</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-4-%E9%85%8D%E5%A5%97%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.4 配套管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-5-%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.5 基本属性管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E5%B1%9E%E6%80%A7%E5%90%8D%E7%A7%B0"><span class="toc-text">1. 保存或更新属性名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-text">2. 保存或更新属性值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8%E5%B1%9E%E6%80%A7%E5%90%8D%E7%A7%B0%E5%92%8C%E5%B1%9E%E6%80%A7%E5%80%BC%E5%88%97%E8%A1%A8"><span class="toc-text">3. 查询全部属性名称和属性值列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7%E5%90%8D%E7%A7%B0"><span class="toc-text">4. 根据ID删除属性名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-text">5. 根据ID删除属性值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-6-%E5%85%AC%E5%AF%93%E6%9D%82%E8%B4%B9%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.6 公寓杂费管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E6%9D%82%E8%B4%B9%E5%90%8D%E7%A7%B0"><span class="toc-text">1. 保存或更新杂费名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E6%9D%82%E8%B4%B9%E5%80%BC"><span class="toc-text">2. 保存或更新杂费值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8%E6%9D%82%E8%B4%B9%E5%90%8D%E7%A7%B0%E5%92%8C%E6%9D%82%E8%B4%B9%E5%80%BC%E5%88%97%E8%A1%A8"><span class="toc-text">3. 查询全部杂费名称和杂费值列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E6%9D%82%E8%B4%B9%E5%90%8D%E7%A7%B0"><span class="toc-text">4. 根据ID删除杂费名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E6%9D%82%E8%B4%B9%E5%80%BC"><span class="toc-text">5. 根据ID删除杂费值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-7-%E5%9C%B0%E5%8C%BA%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.7 地区信息管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-8-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.8 图片上传管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-9-%E5%85%AC%E5%AF%93%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.9 公寓管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 保存或更新公寓信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%85%AC%E5%AF%93%E5%88%97%E8%A1%A8"><span class="toc-text">2. 根据条件分页查询公寓列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E8%8E%B7%E5%8F%96%E5%85%AC%E5%AF%93%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 根据ID获取公寓详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF"><span class="toc-text">4. 根据ID删除公寓信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E4%BF%AE%E6%94%B9%E5%85%AC%E5%AF%93%E5%8F%91%E5%B8%83%E7%8A%B6%E6%80%81"><span class="toc-text">5. 根据ID修改公寓发布状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%A0%B9%E6%8D%AE%E5%8C%BA%E5%8E%BFID%E6%9F%A5%E8%AF%A2%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF%E5%88%97%E8%A1%A8"><span class="toc-text">6. 根据区县ID查询公寓信息列表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-10-%E6%88%BF%E9%97%B4%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.2.10 房间管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E6%88%BF%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 保存或更新房间信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8"><span class="toc-text">2. 根据条件分页查询房间列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E8%8E%B7%E5%8F%96%E6%88%BF%E9%97%B4%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 根据ID获取房间详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E6%88%BF%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="toc-text">4. 根据ID删除房间信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEid%E4%BF%AE%E6%94%B9%E6%88%BF%E9%97%B4%E5%8F%91%E5%B8%83%E7%8A%B6%E6%80%81"><span class="toc-text">5. 根据id修改房间发布状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%A0%B9%E6%8D%AE%E5%85%AC%E5%AF%93ID%E6%9F%A5%E8%AF%A2%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8"><span class="toc-text">6. 根据公寓ID查询房间列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-%E7%A7%9F%E8%B5%81%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.3 租赁管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-1-%E7%9C%8B%E6%88%BF%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.3.1 看房预约管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E9%A2%84%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 根据条件分页查询预约信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEID%E6%9B%B4%E6%96%B0%E9%A2%84%E7%BA%A6%E7%8A%B6%E6%80%81"><span class="toc-text">2. 根据ID更新预约状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-2-%E7%A7%9F%E7%BA%A6%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.3.2 租约管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E8%8E%B7%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 保存获更新租约信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E7%A7%9F%E7%BA%A6%E5%88%97%E8%A1%A8"><span class="toc-text">2. 根据条件分页查询租约列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2%E7%A7%9F%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 根据ID查询租约信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E7%A7%9F%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">4. 根据ID删除租约信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6%E7%8A%B6%E6%80%81"><span class="toc-text">5. 根据ID更新租约状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%AE%9A%E6%97%B6%E6%A3%80%E6%9F%A5%E7%A7%9F%E7%BA%A6%E7%8A%B6%E6%80%81"><span class="toc-text">6. 定时检查租约状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.4 用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-text">1. 根据条件分页查询用户列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEID%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E7%8A%B6%E6%80%81"><span class="toc-text">2. 根据ID更新用户状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.5 系统管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-5-1-%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E5%B2%97%E4%BD%8D%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.5.1 后台用户岗位管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF"><span class="toc-text">1. 分页查询岗位信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF"><span class="toc-text">2. 保存或更新岗位信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 根据ID删除岗位信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E5%85%A8%E9%83%A8%E5%B2%97%E4%BD%8D%E5%88%97%E8%A1%A8"><span class="toc-text">4. 获取全部岗位列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E8%8E%B7%E5%8F%96%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF"><span class="toc-text">5. 根据ID获取岗位信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%A0%B9%E6%8D%AEID%E4%BF%AE%E6%94%B9%E5%B2%97%E4%BD%8D%E7%8A%B6%E6%80%81"><span class="toc-text">6. 根据ID修改岗位状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-5-2-%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.5.2 后台用户信息管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-text">1. 根据条件分页查询后台用户列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">2. 根据ID查询后台用户信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 保存或更新后台用户信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%A4%E6%96%AD%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8"><span class="toc-text">4. 判断后台用户名是否可用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AEID%E5%88%A0%E9%99%A4%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">5. 根据ID删除后台用户信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%A0%B9%E6%8D%AEID%E4%BF%AE%E6%94%B9%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%E7%8A%B6%E6%80%81"><span class="toc-text">6. 根据ID修改后台用户状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-6-%E7%99%BB%E5%BD%95%E7%AE%A1%E7%90%86"><span class="toc-text">7.2.6 登录管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-1-%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-text">7.2.6.1 背景知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-2-%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-text">7.2.6.2 登录流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-3-%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-text">7.2.6.3 接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">1. 获取图形验证码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="toc-text">2. 登录接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 获取登录用户个人信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-2-%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">7.3.2.2 启动前端项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-text">7.4 移动端后端开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E9%85%8D%E7%BD%AE"><span class="toc-text">7.4.1 项目初始配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-1-SpringBoot%E9%85%8D%E7%BD%AE"><span class="toc-text">7.4.1.1 SpringBoot配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-2-Mybatis-Plus%E9%85%8D%E7%BD%AE"><span class="toc-text">7.4.1.2 Mybatis-Plus配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-3-Knife4j%E9%85%8D%E7%BD%AE"><span class="toc-text">7.4.1.3 Knife4j配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-4-%E5%AF%BC%E5%85%A5%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81"><span class="toc-text">7.2.1.4 导入基础代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-5-%E5%AF%BC%E5%85%A5%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%A0%81"><span class="toc-text">7.2.1.5 导入接口定义代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-6-%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE"><span class="toc-text">7.2.1.6 启动项目</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-%E7%99%BB%E5%BD%95%E7%AE%A1%E7%90%86"><span class="toc-text">7.4.2 登录管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-1-%E7%99%BB%E9%99%86%E6%B5%81%E7%A8%8B"><span class="toc-text">7.4.2.1 登陆流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-2-%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-text">7.4.2.2 接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">1. 获取短信验证码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%99%BB%E5%BD%95%E5%92%8C%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3"><span class="toc-text">2. 登录和注册接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">3.查询登录用户的个人信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-3-%E6%89%BE%E6%88%BF"><span class="toc-text">7.4.3 找房</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-1-%E5%9C%B0%E5%8C%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">7.4.3.1 地区信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-2-%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="toc-text">7.4.3.2 支付方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-4-%E6%88%BF%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="toc-text">7.4.3.4 房间信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8"><span class="toc-text">1. 根据条件分页查询房间列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2%E6%88%BF%E9%97%B4%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">2. 根据ID查询房间详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AE%E5%85%AC%E5%AF%93ID%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8"><span class="toc-text">3.根据公寓ID分页查询房间列表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-5-%E5%85%AC%E5%AF%93%E4%BF%A1%E6%81%AF"><span class="toc-text">7.4.3.5 公寓信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%9D%E5%AD%98%E6%B5%8F%E8%A7%88%E5%8E%86%E5%8F%B2"><span class="toc-text">2.保存浏览历史</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-4-2-%E9%A2%84%E7%BA%A6%E7%9C%8B%E6%88%BF"><span class="toc-text">7.4.4.2 预约看房</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E7%9C%8B%E6%88%BF%E9%A2%84%E7%BA%A6"><span class="toc-text">1. 保存或更新看房预约</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E4%B8%AA%E4%BA%BA%E9%A2%84%E7%BA%A6%E7%9C%8B%E6%88%BF%E5%88%97%E8%A1%A8"><span class="toc-text">2. 查询个人预约看房列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2%E9%A2%84%E7%BA%A6%E8%AF%A6%E6%83%85%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 根据ID查询预约详情信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-4-3-%E7%A7%9F%E7%BA%A6%E7%AE%A1%E7%90%86"><span class="toc-text">7.4.4.3 租约管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E4%B8%AA%E4%BA%BA%E7%A7%9F%E7%BA%A6%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%88%97%E8%A1%A8"><span class="toc-text">1. 获取个人租约基本信息列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AEID%E8%8E%B7%E5%8F%96%E7%A7%9F%E7%BA%A6%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">2. 根据ID获取租约详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AEID%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6%E7%8A%B6%E6%80%81"><span class="toc-text">3. 根据ID更新租约状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BF%9D%E5%AD%98%E6%88%96%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6"><span class="toc-text">4. 保存或更新租约</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%A0%B9%E6%8D%AE%E6%88%BF%E9%97%B4ID%E8%8E%B7%E5%8F%96%E5%8F%AF%E9%80%89%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="toc-text">5. 根据房间ID获取可选支付方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%A0%B9%E6%8D%AE%E6%88%BF%E9%97%B4ID%E8%8E%B7%E5%8F%96%E5%8F%AF%E9%80%89%E7%A7%9F%E6%9C%9F"><span class="toc-text">6.根据房间ID获取可选租期</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-text">7.5 移动端前后端联调</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-%E5%90%AF%E5%8A%A8%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">7.5.1 启动后端项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">7.5.2 启动前端项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96"><span class="toc-text">8. 项目优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-text">8.1 缓存优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">8.1.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-%E7%BC%96%E5%86%99%E7%BC%93%E5%AD%98%E9%80%BB%E8%BE%91"><span class="toc-text">8.1.2 编写缓存逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><span class="toc-text">8.1.3 压力测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E9%83%A8%E7%BD%B2%E5%87%86%E5%A4%87"><span class="toc-text">9. 部署准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88"><span class="toc-text">9.1 部署方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Nginx%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">9.2 Nginx快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-1-Nginx%E5%AE%89%E8%A3%85"><span class="toc-text">9.2.1 Nginx安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-2-%E9%87%8D%E8%A6%81%E7%9A%84%E7%9B%AE%E5%BD%95%E3%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">9.2.2 重要的目录、文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A6%82%E8%BF%B0"><span class="toc-text">9.2.3 配置文件概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-4-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">9.2.4 静态资源服务器案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-5-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%A1%88%E4%BE%8B"><span class="toc-text">9.2.5 反向代理案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E9%85%8D%E7%BD%AE%E5%9F%9F%E5%90%8D%E6%98%A0%E5%B0%84"><span class="toc-text">9.3 配置域名映射</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-text">10. 项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">10.1 部署后端项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-%E6%89%93%E5%8C%85"><span class="toc-text">10.1.1 打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-2-%E5%AE%89%E8%A3%85JDK"><span class="toc-text">10.1.2 安装JDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-3-%E9%83%A8%E7%BD%B2"><span class="toc-text">10.1.3 部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">10.2 部署前端项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-Nginx%E9%85%8D%E7%BD%AE%E6%A6%82%E8%BF%B0"><span class="toc-text">10.2.1 Nginx配置概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-%E7%A7%BB%E5%8A%A8%E7%AB%AF"><span class="toc-text">10.2.1 移动端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-1-1-%E6%89%93%E5%8C%85"><span class="toc-text">10.2.1.1 打包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-1-2-%E9%83%A8%E7%BD%B2"><span class="toc-text">10.2.1.2 部署</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-text">10.2.2 后台管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-2-1-%E6%89%93%E5%8C%85"><span class="toc-text">10.2.2.1 打包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-2-2-%E9%83%A8%E7%BD%B2"><span class="toc-text">10.2.2.2 部署</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By 捞月亮の小北</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">言念君子 ，温其如玉<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23livb5sxAzXC5FAOj',
      clientSecret: '901c2a65d4b136d295133e9a8176b8650d782c41',
      repo: 'blog-gitalk',
      owner: 'LunaNorth',
      admin: ['LunaNorth'],
      id: '37280440fbeb7cd7eadb41a3f26f40a4',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><canvas id="universe"></canvas><script async data-pjax src="/js/universe.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = '81efe4afadcd49fc93bcfb1aa5d42b3c';
  var gaud_map_key = 'ea946ee5b69e4a4fe76909e6537b883d';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/8ebfad52.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://s21.ax1x.com/2024/08/08/pkzZNWD.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/8ebfad52.html&quot;);" href="javascript:void(0);" alt="">轻语时光</a><div class="blog-slider__text">我大抵是真的眼花了，竟把一个人的落日，看成了两个人的黄昏</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/8ebfad52.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/56917.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://s21.ax1x.com/2024/09/19/pAKRcZV.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-09-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/56917.html&quot;);" href="javascript:void(0);" alt="">百天打卡</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/56917.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/5413be0e.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://testingcf.jsdelivr.net/gh/LunaNorth/img-cloud/images/sy06.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/5413be0e.html&quot;);" href="javascript:void(0);" alt="">健身日记</a><div class="blog-slider__text">请不要把陌生人的些许善意，视为珍稀的瑰宝，却把身边亲近人的全部付出，当做天经地义的事情，对其视而不见。</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/5413be0e.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/facab7a2.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://s21.ax1x.com/2024/08/11/pASTNY8.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/facab7a2.html&quot;);" href="javascript:void(0);" alt="">我在人间凑数的日子</a><div class="blog-slider__text">什么家国仇恨浩然正气的，都不要急。先挑起清风明月，杨柳依依和草长莺飞</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/facab7a2.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37820.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://testingcf.jsdelivr.net/gh/LunaNorth/img-cloud/images/sy14.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37820.html&quot;);" href="javascript:void(0);" alt="">博客日志</a><div class="blog-slider__text">对该博客进行一个简单的记录</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37820.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/17639.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://testingcf.jsdelivr.net/gh/LunaNorth/img-cloud/images/18.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/17639.html&quot;);" href="javascript:void(0);" alt="">Tag Plugins Plus 的日常使用</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/17639.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>